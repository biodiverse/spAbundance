<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Jeffrey W. Doser" />

<meta name="date" content="2023-01-01" />

<title>Fitting N-mixture models in spAbundance</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Fitting N-mixture models in spAbundance</h1>
<h4 class="author">Jeffrey W. Doser</h4>
<h4 class="date">2023</h4>


<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#example-data-set-simulated-multi-species-count-data">Example data set: Simulated multi-species count data</a></li>
</ul></li>
<li><a href="#single-species-n-mixture-models">Single-species N-mixture models</a>
<ul>
<li><a href="#basic-model-description">Basic model description</a></li>
<li><a href="#fitting-single-species-n-mixture-models-with-nmix">Fitting single-species N-mixture models with <code>NMix()</code></a></li>
<li><a href="#posterior-predictive-checks">Posterior predictive checks</a>
<ul>
<li><a href="#a-brief-note-on-generation-of-fitted-values-for-posterior-predictive-checks">A brief note on generation of fitted values for posterior predictive checks</a></li>
</ul></li>
<li><a href="#model-selection-using-waic">Model selection using WAIC</a></li>
<li><a href="#prediction">Prediction</a></li>
</ul></li>
<li><a href="#spNMix">Single-species spatial N-mixture models</a>
<ul>
<li><a href="#basic-model-description-1">Basic model description</a></li>
<li><a href="#fitting-single-species-spatial-n-mixture-models-with-spnmix">Fitting single-species spatial N-mixture models with <code>spNMix()</code></a></li>
<li><a href="#posterior-predictive-checks-1">Posterior predictive checks</a></li>
<li><a href="#model-selection-using-waic-1">Model selection using WAIC</a></li>
<li><a href="#prediction-1">Prediction</a></li>
</ul></li>
<li><a href="#multi-species-n-mixture-models">Multi-species N-mixture models</a>
<ul>
<li><a href="#basic-model-description-2">Basic model description</a></li>
<li><a href="#fitting-multi-species-n-mixture-models-with-msnmix">Fitting multi-species N-mixture models with <code>msNMix()</code></a></li>
<li><a href="#posterior-predictive-checks-2">Posterior predictive checks</a></li>
<li><a href="#model-selection-using-waic-2">Model selection using WAIC</a></li>
<li><a href="#prediction-2">Prediction</a></li>
</ul></li>
<li><a href="#latent-factor-multi-species-n-mixture-models">Latent factor multi-species N-mixture models</a>
<ul>
<li><a href="#basic-model-description-3">Basic model description</a></li>
<li><a href="#fitting-latent-factor-multi-species-n-mixture-models-with-lfmsnmix">Fitting latent factor multi-species N-mixture models with <code>lfMsNMix()</code></a></li>
<li><a href="#posterior-predictive-checks-3">Posterior predictive checks</a></li>
<li><a href="#model-selection-using-waic-3">Model selection using WAIC</a></li>
<li><a href="#prediction-3">Prediction</a></li>
</ul></li>
<li><a href="#spatial-factor-multi-species-n-mixture-models">Spatial factor multi-species N-mixture models</a>
<ul>
<li><a href="#basic-model-description-4">Basic model description</a></li>
<li><a href="#fitting-spatial-factor-multi-species-n-mixture-models-with-sfmsnmix">Fitting spatial factor multi-species N-mixture models with <code>sfMsNMix()</code></a></li>
<li><a href="#posterior-predictive-checks-4">Posterior predictive checks</a></li>
<li><a href="#model-selection-using-waic-4">Model selection using WAIC</a></li>
<li><a href="#prediction-4">Prediction</a></li>
</ul></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This vignette provides worked examples and explanations for fitting single-species and multi-species N-mixture models in the <code>spAbundance</code> R package. We will provide step by step examples on how to fit the following models:</p>
<ol style="list-style-type: decimal">
<li>N-mixture model using <code>NMix()</code>.</li>
<li>Spatial N-mixture model using <code>spNMix()</code>.</li>
<li>Multi-species N-mixture model using <code>msNMix()</code>.</li>
<li>Multi-species N-mixture model with species correlations using <code>lfMsNMix()</code>.</li>
<li>Spatial multi-species N-mixture with species correlations using <code>sfMsNMix()</code>.</li>
</ol>
<p>In this vignette we are only describing <code>spAbundance</code> functionality to fit N-mixture models, with separate vignettes on fitting hierarchical distance sampling models and generalized linear mixed models. We fit all models in a Bayesian framework using custom Markov chain Monte Carlo (MCMC) samplers written in <code>C/C++</code> and called through <code>R</code>’s foreign language interface. Here we will provide a brief description of each model, with full statistical details provided in a separate vignette. As with all model types in <code>spAbundance</code>, we will show how to perform posterior predictive checks as a Goodness of Fit assessment, model comparison and assessment using the Widely Applicable Information Criterion (WAIC), and out-of-sample predictions using standard R helper functions (e.g., <code>predict()</code>). Note that syntax of N-mixture models in <code>spAbundance</code> closely follows syntax for fitting occupancy models in <code>spOccupancy</code> <span class="citation">(Doser et al. 2022)</span>, and that this vignette closely follows the documentation on the <a href="https://www.jeffdoser.com/files/spoccupancy-web/">spOccupancy website</a>.</p>
<p>To get started, we load the <code>spAbundance</code> package, as well as the <code>coda</code> package, which we will use for some MCMC summary and diagnostics. We will also use the <code>stars</code> and <code>ggplot2</code> packages to create some basic plots of our results. We then set a seed so you can reproduce the same results as we do.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(spAbundance)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(coda)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">library</span>(stars)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">111</span>)</span></code></pre></div>
<div id="example-data-set-simulated-multi-species-count-data" class="section level2">
<h2>Example data set: Simulated multi-species count data</h2>
<p>As an example data set throughout this vignette, we will use a simulated data set comprised of 6 species across 225 sites and 5 repeat surveys. The data are provided as part of the <code>spAbundance</code> package and are loaded with <code>data(dataNMixSim)</code>. The manual page obtained using <code>help(dataNMixSim)</code> contains information on the parameter values used to generate the data set with the <code>simMsNMix()</code> function.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">data</span>(dataNMixSim) <span class="co"># Load the data set.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="kw">str</span>(dataNMixSim) <span class="co"># Get an overview of what&#39;s in the data.</span></span></code></pre></div>
<pre><code>List of 4
 $ y         : int [1:6, 1:225, 1:5] 0 0 1 0 0 0 0 0 0 0 ...
 $ abund.covs: num [1:225, 1:2] 0.2863 -0.0325 -0.9897 0.2118 -0.972 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : NULL
  .. ..$ : chr [1:2] &quot;abund.cov.1&quot; &quot;abund.factor.1&quot;
 $ det.covs  :List of 2
  ..$ det.cov.1: num [1:225, 1:5] 1.577 0.6956 -0.3031 0.107 0.0284 ...
  ..$ det.cov.2: num [1:225, 1:5] -1.235 -0.509 -2.012 -0.899 0.38 ...
 $ coords    : num [1:225, 1:2] 0 0.0714 0.1429 0.2143 0.2857 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : NULL
  .. ..$ : chr [1:2] &quot;X&quot; &quot;Y&quot;</code></pre>
<p>The object <code>dataNMixSim</code> is a list comprised of the count data (<code>y</code>), covariates on the abundance portion of the model (<code>abund.covs</code>), covariates on the detection portion of the model (<code>det.covs</code>), and the spatial coordinates of each site (<code>coords</code>) for use in spatial N-mixture models and in plotting. This list is in the exact format required for input to N-mixture models in <code>spAbundance</code>. <code>dataNMixSim</code> contains data on 6 species in the three-dimensional array <code>y</code>, where the dimensions of <code>y</code> correspond to species (6), sites (225), and replicates (5). For single-species N-mixture models in Section 2 and 3, we will only use data on one species, so we next subset the <code>dataNmixSim</code> list to only include data from the first species in a new object <code>data.one.sp</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>data.one.sp &lt;-<span class="st"> </span>dataNMixSim</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>data.one.sp<span class="op">$</span>y &lt;-<span class="st"> </span>data.one.sp<span class="op">$</span>y[<span class="dv">1</span>, , ]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="kw">table</span>(data.one.sp<span class="op">$</span>y) <span class="co"># Quick summary.</span></span></code></pre></div>
<pre><code>
  0   1   2   3   4   5   7 
534  96  17   9   3   2   3 </code></pre>
<p>We see that our species is fairly rare, with most observations of the species being 0.</p>
</div>
</div>
<div id="single-species-n-mixture-models" class="section level1">
<h1>Single-species N-mixture models</h1>
<div id="basic-model-description" class="section level2">
<h2>Basic model description</h2>
<p>Let <span class="math inline">\(N_j\)</span> denote the true abundance of a species of interest at site <span class="math inline">\(j = 1, \dots, J\)</span>. We model <span class="math inline">\(N_j\)</span> following either a Poisson or negative binomial (NB) distribution according to</p>
<p><span class="math display">\[\begin{align}\label{abundance}
  \begin{split}
  N_j &amp;\sim \text{Poisson}(\mu_j) \text{, or, } \\
  N_j &amp;\sim \text{NB}(\mu_j, \kappa),
  \end{split}
\end{align}\]</span></p>
<p>where <span class="math inline">\(\mu_j\)</span> is the average abundance at site <span class="math inline">\(j\)</span> and <span class="math inline">\(\kappa\)</span> is a positive dispersion parameter. Smaller values of <span class="math inline">\(\kappa\)</span> indicate overdispersion in the latent abundance values, while higher values indicate minimal overdispersion in abundance. We model <span class="math inline">\(\mu_j\)</span> using a log link function following</p>
<p><span class="math display">\[\begin{equation}\label{muAbund}
  \text{log}(\mu_j) = \textbf{x}_j^\top\boldsymbol{\beta},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{\beta}\)</span> is a vector of regression coefficients for a set of covariates <span class="math inline">\(\textbf{X}_j\)</span> (including an intercept). Note that while not shown, unstructured random intercepts and slopes can be included in the equation for expected abundance.</p>
<p>Following the standard N-mixture model of <span class="citation">Royle (2004)</span>, we suppose observers count the number of individuals of the species of interest at each site <span class="math inline">\(j\)</span> over a set of multiple surveys <span class="math inline">\(k = 1, \dots, K_j\)</span>, denoted as <span class="math inline">\(y_{j, k}\)</span>. Note the number of surveys can vary by site, but at least some sites must be surveyed more than once to ensure identifiability without making restrictive parameteric assumptions <span class="citation">(Knape and Korner-Nievergelt 2015)</span>. We model <span class="math inline">\(y_{j, k}\)</span> conditional on the true abundance of the species at site <span class="math inline">\(j\)</span>, <span class="math inline">\(N_j\)</span>, following</p>
<p><span class="math display">\[\begin{equation}\label{y-NMix}
     y_{j, k} \sim \text{Binomial}(N_j, p_{j, k}),
\end{equation}\]</span></p>
<p>where <span class="math inline">\(p_{j, k}\)</span> is the probability of detecting an individual given it is present at the site. We model <span class="math inline">\(p_{j, k}\)</span> using a logit link function in which we can allow detection probability to vary over space and/or surveys. More specifically, we have</p>
<p><span class="math display">\[\begin{equation} \label{p-NMix}
     \text{logit}(p_{j, k}) = \textbf{v}_{j, k}^\top\boldsymbol{\alpha},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{\alpha}\)</span> is a vector of the effects of a set of covariates <span class="math inline">\(\textbf{v}_{j, k}\)</span> (including an intercept).</p>
<p>To complete the Bayesian specification of the model, we assign normal priors for the abundance (<span class="math inline">\(\boldsymbol{\beta}\)</span>) and detection (<span class="math inline">\(\boldsymbol{\alpha}\)</span>) regression coefficients.</p>
</div>
<div id="fitting-single-species-n-mixture-models-with-nmix" class="section level2">
<h2>Fitting single-species N-mixture models with <code>NMix()</code></h2>
<p>The <code>NMix()</code> function fits single-species N-mixture models. <code>NMix()</code> has the following arguments:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">NMix</span>(abund.formula, det.formula, data, inits, priors, tuning,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>     n.batch, batch.length, <span class="dt">accept.rate =</span> <span class="fl">0.43</span>, <span class="dt">family =</span> <span class="st">&#39;Poisson&#39;</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>     <span class="dt">n.omp.threads =</span> <span class="dv">1</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>, <span class="dt">n.report =</span> <span class="dv">100</span>, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>     <span class="dt">n.burn =</span> <span class="kw">round</span>(.<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>n.batch <span class="op">*</span><span class="st"> </span>batch.length), <span class="dt">n.thin =</span> <span class="dv">1</span>, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>     <span class="dt">n.chains =</span> <span class="dv">1</span>, ...)</span></code></pre></div>
<p>The first two arguments, <code>abund.formula</code> and <code>det.formula</code>, use standard R model syntax to denote the covariates to be included in the abundance and detection portions of the model, respectively. Only the right hand side of the formulas are included. Random intercepts and slopes can be included in both the abundance and detection portions of the single-species N-mixture model using <code>lme4</code> syntax <span class="citation">(Bates et al. 2015)</span>. For example, to include a random intercept for different observers in the detection portion of the model, we would include <code>(1 | observer)</code> in the <code>det.formula</code>, where <code>observer</code> indicates the specific observer for each data point. The names of variables given in the formulas should correspond to those found in <code>data</code>, which is a list consisting of the following tags: <code>y</code> (count data), <code>abund.covs</code> (abundance covariates), <code>det.covs</code> (detection covariates). <code>y</code> should be stored as a sites x replicate matrix, <code>abund.covs</code> as a matrix or data frame with site-specific covariate values, and <code>det.covs</code> as a list with each list element corresponding to a covariate to include in the detection portion of the model. Covariates on detection can vary by site and/or survey, and so these covariates may be specified as a site by survey matrix for survey-level covariates or as a one-dimensional vector for survey level covariates. The <code>data.one.sp</code> list is already in the required format. Here we will model abundance as a function of a continuous covariate <code>abund.cov.1</code> as well as a categorical variable <code>abund.factor.1</code>, which we will treat as a random effect. We can imagine this categorical variable corresponding to a management unit, aspect of the experimental design, or some other grouping variable that we want to account for in our model. We model detection probability as a function of two continuous variables that vary across sites and replicates. We standardize all continuous covariates by using the <code>scale()</code> function in our model specification:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>abund.formula &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw">scale</span>(abund.cov<span class="fl">.1</span>) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>abund.factor<span class="fl">.1</span>) </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>det.formula &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw">scale</span>(det.cov<span class="fl">.1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale</span>(det.cov<span class="fl">.2</span>) </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="co"># Check out the format of data.one.sp</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a><span class="kw">str</span>(data.one.sp)</span></code></pre></div>
<pre><code>List of 4
 $ y         : int [1:225, 1:5] 0 0 1 0 0 0 0 0 0 0 ...
 $ abund.covs: num [1:225, 1:2] 0.2863 -0.0325 -0.9897 0.2118 -0.972 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : NULL
  .. ..$ : chr [1:2] &quot;abund.cov.1&quot; &quot;abund.factor.1&quot;
 $ det.covs  :List of 2
  ..$ det.cov.1: num [1:225, 1:5] 1.577 0.6956 -0.3031 0.107 0.0284 ...
  ..$ det.cov.2: num [1:225, 1:5] -1.235 -0.509 -2.012 -0.899 0.38 ...
 $ coords    : num [1:225, 1:2] 0 0.0714 0.1429 0.2143 0.2857 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : NULL
  .. ..$ : chr [1:2] &quot;X&quot; &quot;Y&quot;</code></pre>
<p>Next, we specify the initial values for the MCMC sampler in <code>inits</code>. <code>NMix()</code> (and all other <code>spAbundance</code> model fitting functions) will set initial values by default, but here we will do this explicitly, since in more complicated cases setting initial values close to the presumed solutions can be vital for success of an MCMC-based analysis (this is the case when fitting distance sampling models in <code>spAbundance</code>). For all models described in this vignette (in particular the non-spatial models), choice of the initial values is largely inconsequential, with the exception being that specifying initial values close to the presumed solutions can decrease the amount of samples you need to run to arrive at convergence of the MCMC chains. Thus, when first running a model in <code>spAbundance</code>, we recommend fitting the model using the default initial values that <code>spAbundance</code> provides. The initial values that <code>spAbundance</code> chooses will be reported to the screen when setting <code>verbose = TRUE</code>. After running the model for a reasonable period, if you find the chains are taking a long time to reach convergence, you then may wish to set the initial values to the mean estimates of the parameters from the initial model fit, as this will likely help reduce the amount of time you need to run the model.</p>
<p>The default initial values for abundance and detection regression coefficients (including the intercepts) are random values from a standard normal distribution, while the default initial values for the latent abundance effects are set to the maximum number of individuals observed at a given site over the replicate surveys at that site. When fitting an N-mixture model with a negative binomial distribution, the initial value for the overdispersion parameter is drawn from the prior distribution. Initial values are specified in a list with the following tags: <code>N</code> (latent abundance values), <code>alpha</code> (detection intercept and regression coefficients), <code>beta</code> (abundance intercept and regression coefficients), and <code>kappa</code> (negative binomial overdispersion parameter). Below we set all initial values of the regression coefficients to 0, initial values for the overdispersion parameter to 0.5, and set initial values for <code>N</code> based on the count data matrix. For the abundance (<code>beta</code>) and detection (<code>alpha</code>) regression coefficients, the initial values are passed either as a vector of length equal to the number of estimated parameters (including an intercept, and in the order specified in the model formula), or as a single value if setting the same initial value for all parameters (including the intercept). Below we take the latter approach. For the negative binomial overdispersion parameter, the initial value is simply a single numeric value. To specify the initial values for the latent abundance at each site (<code>N</code>), we must ensure we set the value to at least the maximum number of individuals observed at a site on a given survey, because we know the true abundance must be greater than or equal to the number of individuals observed (i.e., assuming no false positives). If the initial values for <code>N</code> do not meet this criterion, <code>NMix()</code> will fail. <code>spAbundance</code> will provide a clear error message if the supplied initial values for <code>N</code> are invalid. Below we use the raw count data and the <code>apply()</code> function to set the initial values to the largest observed count at each site. For any random effects that are included in the model, we can also specify the initial values for the random effect variances (<code>sigma.sq.mu</code> for abundance and <code>sigma.sq.p</code> for detection. By default, these will be drawn as random values between 0.05 and 2. Here we specify the initial value for the abundance random effect to 0.5.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="co"># Format with explicit specification of inits for alpha and beta</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="co"># with four detection parameters and three occurrence parameters</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="co"># (including the intercept).</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">alpha =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a>              <span class="dt">beta =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>              <span class="dt">kappa =</span> <span class="fl">0.5</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>          <span class="dt">sigma.sq.mu =</span> <span class="fl">0.5</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a>              <span class="dt">N =</span> <span class="kw">apply</span>(data.one.sp<span class="op">$</span>y, <span class="dv">1</span>, max, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a><span class="co"># Format with abbreviated specification of inits for alpha and beta.</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a>inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">alpha =</span> <span class="dv">0</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a>              <span class="dt">beta =</span> <span class="dv">0</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a>              <span class="dt">kappa =</span> <span class="fl">0.5</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a>          <span class="dt">sigma.sq.mu =</span> <span class="fl">0.5</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true"></a>              <span class="dt">N =</span> <span class="kw">apply</span>(data.one.sp<span class="op">$</span>y, <span class="dv">1</span>, max, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<p>We next specify the priors for the abundance and detection regression coefficients, as well as the negative binomial overdispersion parameter. We assume normal priors for both the detection and abundance regression coefficients. These priors are specified in a list with tags <code>beta.normal</code> for abundance and <code>alpha.normal</code> for detection parameters (including intercepts). Each list element is then itself a list, with the first element of the list consisting of the hypermeans for each coefficient and the second element of the list consisting of the hypervariances for each coefficient. Alternatively, the hypermean and hypervariances can be specified as a single value if the same prior is used for all regression coefficients. By default, <code>spOccupancy</code> will set the hypermeans to 0 and the hypervariances to 100 for the abundance coefficients and 2.72 for the detection coefficients. The variance of 2.72 corresponds to a relatively flat prior on the probability scale (0, 1; <span class="citation">Lunn et al. (2013)</span>). For the negative binomial overdispersion parameter, we will use a uniform prior. This prior is specified as a tag in the prior list called <code>kappa.unif</code>, which should be a vector with two values indicating the lower and upper bound of the uniform distribution. The default prior is to set the lower bound to 0 and the upper bound to 100. Recall that lower values of <code>kappa</code> indicate substantial overdispersion and high values of <code>kappa</code> indicate minimal overdispersion. If there is little support for overdispersion when fitting a negative binomial model, we will likely see the estimates of <code>kappa</code> be close to the upper bound of the uniform prior distribution. For the default prior distribution, if the estimates of <code>kappa</code> are very close to 100, this indicates little support for overdispersion in the model, and we can likely switch to using a Poisson distribution (which would also likely be favored by model comparison approaches). For models with random effects in the abundance and/or detection portion of the N-mixture model, we can also specify the prior for the random effect variance parameter (<code>sigma.sq.mu</code> for abundance and <code>sigma.sq.p</code> for detection). We assume an inverse-Gamma prior for these variance parameters and these are specified with the tags <code>sigma.sq.mu.ig</code> and <code>sigma.sq.p.ig</code>, respectively. These priors are set as a list with two components, where the first element is the shape parameter and the second element is the scale parameter. The shape and scale parameters can be specified as a single value or vectors equal to the number of random effects we include in the model. The default prior distribution for random effect variances is 0.1 for both the shape and scale parameters. Below we use default priors for all parameters, but specify them explicitly for clarity.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>priors &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">alpha.normal =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">var =</span> <span class="fl">2.72</span>),</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>               <span class="dt">beta.normal =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">var =</span> <span class="dv">100</span>), </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>               <span class="dt">kappa.unif =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>               <span class="dt">sigma.sq.mu.ig =</span> <span class="kw">list</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>))</span></code></pre></div>
<p>The next four arguments (<code>tuning</code>, <code>n.batch</code>, <code>batch.length</code>, and <code>accept.rate</code>) are all related to the specific type of MCMC sampler we use when we fit N-mixture models in <code>spAbundance</code>. The parameters in N-mixture models are all estimated using a Metropolis-Hastings step, which can often be slow and inefficient, leading to slow mixing and convergence of the MCMC chains. To try and mitigate the slow mixing and convergence issues, we update all parameters in N-mixture models using an algorithm called an adaptive Metropolis-Hastings algorithm (see <span class="citation">Roberts and Rosenthal (2009)</span> for more details on this algorithm). In this approach, we break up the total number of MCMC samples into a set of “batches”, where each batch has a specific number of MCMC samples. Thus, we must specify the total number of batches (<code>n.batch</code>) as well as the number of MCMC samples each batch contains (<code>batch.length</code>) when specifying the function arguments. The total number of MCMC samples is <code>n.batch * batch.length</code>. Typically, we set <code>batch.length = 25</code> and then play around with <code>n.batch</code> until convergence of all model parameters is reached. We generally recommend setting <code>batch.length = 25</code>, but in certain situations this can be increased to a larger number of samples (e.g., 100), which can result in moderate decreases in run time. Here we set <code>n.batch = 800</code> for a total of 20,000 MCMC samples for each MCMC chain we run.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>batch.length &lt;-<span class="st"> </span><span class="dv">25</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>n.batch &lt;-<span class="st"> </span><span class="dv">800</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a><span class="co"># Total number of MCMC samples per chain</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>batch.length <span class="op">*</span><span class="st"> </span>n.batch</span></code></pre></div>
<pre><code>[1] 20000</code></pre>
<p>Importantly, we also need to specify a target acceptance rate and initial tuning parameters for the abundance and detection regression coefficients (and the negative binomial overdispersion parameter and any latent random effects if applicable). These are both features of the adaptive algorithm we use to sample these parameters. In this adaptive Metropolis-Hastings algorithm, we propose new values for the parameters from some proposal distribution, compare them to our previous values, and use a statistical algorithm to determine if we should accept the new proposed value or keep the old one. The <code>accept.rate</code> argument specifies the ideal proportion of times we will accept the newly proposed values for these parameters. <span class="citation">Roberts and Rosenthal (2009)</span> show that if we accept new values around 43% of the time, this will lead to optimal mixing and convergence of the MCMC chains. Following these recommendations, we should strive for an algorithm that accepts new values about 43% of the time. Thus, we recommend setting <code>accept.rate = 0.43</code> unless you have a specific reason not to (this is the default value). The values specified in the <code>tuning</code> argument help control the initial values we will propose for the abundance/detection coefficients and the negative binomial overdispersion parameter. These values are supplied as input in the form of a list with tags <code>beta</code>, <code>alpha</code>, and <code>kappa</code>. The initial tuning value can be any value greater than 0, but we generally recommend starting the value out around 0.5. These tuning values can also be thought of as tuning “variances”, as it is these values that controls the variance of the distribution we use to generate newly proposed values for the parameters we are trying to estimate. In short, the new values that we propose for the parameters <code>beta</code>, <code>alpha</code>, and <code>kappa</code> come from a normal distribution with mean equal to the current value for the given parameter and the variance equal to the tuning parameter. Thus, the smaller this tuning parameter/variance is, the closer our proposed values will be to the current value, and vise versa for large values of the tuning parameter. The “ideal” value of the tuning variance will depend on the data set, the parameter, and how much uncertainty there is in the estimate of the parameter. This initial tuning value that we supply is the first tuning variance that will be used for the given parameter, and our adaptive algorithm will adjust this tuning parameter after each batch to yield acceptance rates of newly proposed values that are close to our target acceptance rate that we specified in the <code>accept.rate</code> argument. Information on the acceptance rates for a few of the parameters in your model will be displayed when setting <code>verbose = TRUE</code>. After some initial runs of the model, if you notice the final acceptance rate is much larger or smaller than the target acceptance rate (<code>accept.rate</code>), you can then change the initial tuning value to get closer to the target rate. While use of this algorithm requires us to specify more arguments than if we didn’t “adaptively tune” our proposal variances, this leads to much shorter run times compared to a more simple approach where we do not have an “adaptive” sampling approach, and it should thus save us time in the long haul when waiting for these models to run. For our example here, we set the initial tuning values to 0.5 for <code>beta</code>, <code>alpha</code>, and <code>kappa</code>. For models with random effects in either the abundance or detection portions of the model, we also need to specify tuning parameters for the latent random effect values (<code>beta.star</code> for abundance and <code>alpha.star</code> for detection). We similarly set these to 0.5.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>tuning &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">beta =</span> <span class="fl">0.5</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">kappa =</span> <span class="fl">0.5</span>, <span class="dt">beta.star =</span> <span class="fl">0.5</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a><span class="co"># accept.rate = 0.43 by default, so we do not specify it.</span></span></code></pre></div>
<p>We also need to specify the length of burn-in (<code>n.burn</code>), the rate at which we want to thin the posterior samples (<code>n.thin</code>), and the number of MCMC chains to run (<code>n.chains</code>). Note that currently <code>spAbundance</code> runs multiple chains sequentially and does not allow chains to be run simultaneously in parallel across multiple threads. Instead, we allow for within-chain parallelization using the <code>n.omp.threads</code> argument. We can set <code>n.omp.threads</code> to a number greater than 1 and smaller than the number of threads on the computer you are using. Generally, setting <code>n.omp.threads &gt; 1</code> will not result in decreased run times for non-spatial models in <code>spAbundance</code>, but can substantially decrease run time when fitting spatial models <span class="citation">(Finley, Datta, and Banerjee 2020)</span>. Here we set <code>n.omp.threads = 1</code>.</p>
<p>For a simple single-species N-mixture model, we shouldn’t need too many samples and will only need a moderate amount of burn-in and thinning. We will run the model using three chains to assess convergence using the Gelman-Rubin diagnostic (Rhat; <span class="citation">Brooks and Gelman (1998)</span>).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a>n.burn &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>n.thin &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>n.chains &lt;-<span class="st"> </span><span class="dv">3</span></span></code></pre></div>
<p>We are now almost set to run the model. The <code>family</code> argument is used to indicate whether we want to model abundance with a Poisson distribution (<code>Poisson</code>) or a negative binomial distribution (<code>NB</code>). Here we will start with a Poisson distribution (the default), which we will compare to a model with a negative binomial distribution later. The <code>verbose</code> argument is a logical value indicating whether or not MCMC sampler progress is reported to the screen. If <code>verbose = TRUE</code>, sampler progress is reported to the screen. The argument <code>n.report</code> specifies the interval to report the Metropolis-Hastings sampler acceptance rate. Note that <code>n.report</code> is specified in terms of batches, not the overall number of samples. Below we set <code>n.report = 200</code>, which will result in information on the acceptance rate and tuning parameters every 200th batch (not sample).</p>
<p>We now are set to fit the model.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a>out &lt;-<span class="st"> </span><span class="kw">NMix</span>(<span class="dt">abund.formula =</span> abund.formula, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a>        <span class="dt">det.formula =</span> det.formula, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a>        <span class="dt">data =</span> data.one.sp, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a>        <span class="dt">inits =</span> inits, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a>        <span class="dt">priors =</span> priors,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>        <span class="dt">n.batch =</span> n.batch,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a>        <span class="dt">batch.length =</span> batch.length, </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a>        <span class="dt">tuning =</span> tuning, </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a>        <span class="dt">n.omp.threads =</span> <span class="dv">1</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a>        <span class="dt">n.report =</span> <span class="dv">200</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a>        <span class="dt">family =</span> <span class="st">&#39;Poisson&#39;</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a>        <span class="dt">verbose =</span> <span class="ot">TRUE</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a>        <span class="dt">n.burn =</span> n.burn,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a>        <span class="dt">n.thin =</span> n.thin, </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true"></a>        <span class="dt">n.chains =</span> n.chains)</span></code></pre></div>
<pre><code>----------------------------------------
    Preparing to run the model
----------------------------------------
----------------------------------------
    Model description
----------------------------------------
Poisson N-mixture model with 225 sites.

Samples per Chain: 20000 (800 batches of length 25)
Burn-in: 10000 
Thinning Rate: 10 
Number of Chains: 3 
Total Posterior Samples: 3000 

Source compiled with OpenMP support and model fit using 1 thread(s).

Adaptive Metropolis with target acceptance rate: 43.0
----------------------------------------
    Chain 1
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Parameter   Acceptance  Tuning
    beta[1]     36.0        0.26102
    beta[2]     40.0        0.26102
    alpha[1]    52.0        0.35946
    alpha[2]    36.0        0.54709
    alpha[3]    32.0        0.37413
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Parameter   Acceptance  Tuning
    beta[1]     40.0        0.25585
    beta[2]     48.0        0.27168
    alpha[1]    36.0        0.36672
    alpha[2]    40.0        0.53625
    alpha[3]    48.0        0.37413
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Parameter   Acceptance  Tuning
    beta[1]     28.0        0.25079
    beta[2]     52.0        0.26630
    alpha[1]    36.0        0.34537
    alpha[2]    40.0        0.53625
    alpha[3]    36.0        0.38169
-------------------------------------------------
Batch: 800 of 800, 100.00%
----------------------------------------
    Chain 2
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Parameter   Acceptance  Tuning
    beta[1]     60.0        0.26102
    beta[2]     48.0        0.26102
    alpha[1]    28.0        0.38940
    alpha[2]    52.0        0.53625
    alpha[3]    28.0        0.33853
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Parameter   Acceptance  Tuning
    beta[1]     48.0        0.26102
    beta[2]     40.0        0.26102
    alpha[1]    48.0        0.38169
    alpha[2]    32.0        0.51523
    alpha[3]    40.0        0.37413
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Parameter   Acceptance  Tuning
    beta[1]     36.0        0.26102
    beta[2]     52.0        0.28276
    alpha[1]    40.0        0.35946
    alpha[2]    40.0        0.56941
    alpha[3]    44.0        0.35234
-------------------------------------------------
Batch: 800 of 800, 100.00%
----------------------------------------
    Chain 3
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Parameter   Acceptance  Tuning
    beta[1]     48.0        0.26630
    beta[2]     44.0        0.25585
    alpha[1]    48.0        0.34537
    alpha[2]    56.0        0.51523
    alpha[3]    32.0        0.37413
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Parameter   Acceptance  Tuning
    beta[1]     36.0        0.26630
    beta[2]     40.0        0.25079
    alpha[1]    40.0        0.38169
    alpha[2]    76.0        0.55814
    alpha[3]    56.0        0.36672
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Parameter   Acceptance  Tuning
    beta[1]     44.0        0.27716
    beta[2]     48.0        0.27168
    alpha[1]    44.0        0.38940
    alpha[2]    44.0        0.52564
    alpha[3]    32.0        0.40529
-------------------------------------------------
Batch: 800 of 800, 100.00%</code></pre>
<p><code>NMix()</code> returns a list of class <code>NMix</code> with a suite of different objects, many of them being <code>coda::mcmc</code> objects of poseterior samples. The “Preparing to run the model” section will print information on default priors or initial values that are used when they are not specified in the function call. Here we specified everything explicitly so no information was reported.</p>
<p>We next use the <code>summary()</code> function on the resulting <code>NMix()</code> object for a concise, informative summary of the regression parameters and convergence of the MCMC chains.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="kw">summary</span>(out)</span></code></pre></div>
<pre><code>
Call:
NMix(abund.formula = abund.formula, det.formula = det.formula, 
    data = data.one.sp, inits = inits, priors = priors, tuning = tuning, 
    n.batch = n.batch, batch.length = batch.length, family = &quot;Poisson&quot;, 
    n.omp.threads = 1, verbose = TRUE, n.report = 200, n.burn = n.burn, 
    n.thin = n.thin, n.chains = n.chains)

Samples per Chain: 20000
Burn-in: 10000
Thinning Rate: 10
Number of Chains: 3
Total Posterior Samples: 3000
Run Time (min): 0.3841

Abundance (log scale): 
                      Mean     SD    2.5%     50%   97.5%   Rhat  ESS
(Intercept)        -0.9963 0.2950 -1.6293 -0.9805 -0.4467 1.0142  408
scale(abund.cov.1)  0.1049 0.1138 -0.1136  0.1038  0.3338 1.0012 2284

Abundance Random Effect Variances (log scale): 
                             Mean     SD   2.5%    50%  97.5%   Rhat  ESS
(Intercept)-abund.factor.1 0.6936 0.5535 0.1555 0.5446 2.1997 1.0128 1976

Detection (logit scale): 
                    Mean     SD    2.5%     50%  97.5%   Rhat  ESS
(Intercept)       0.9400 0.1945  0.5732  0.9364 1.3385 1.0081 1753
scale(det.cov.1)  1.9916 0.2481  1.5273  1.9859 2.4967 1.0115 2108
scale(det.cov.2) -0.0032 0.1539 -0.3097 -0.0064 0.2992 1.0022 2421</code></pre>
<p>Notice that the abundance coefficients are printed on the log scale and the detection coefficients are on the logit scale. We see that our species is quite rare, with an average expected abundance of approximately 0.37 (<code>exp(-1)</code>). There is a slight positive effect of the covariate effect, but its 95% credible interval clearly overlaps 0. The random effect variance mean is approximately 0.69, indicating this is a potentially important source of variability in abundance for the species. Note that we can also change the quantiles that are returned in the summary output if we desire to see additional quantiles. This is controlled with the <code>quantiles</code> argument.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="co"># Return a 50% CI and the median instead of the 95% CI</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a><span class="kw">summary</span>(out, <span class="dt">quantiles =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span></code></pre></div>
<pre><code>
Call:
NMix(abund.formula = abund.formula, det.formula = det.formula, 
    data = data.one.sp, inits = inits, priors = priors, tuning = tuning, 
    n.batch = n.batch, batch.length = batch.length, family = &quot;Poisson&quot;, 
    n.omp.threads = 1, verbose = TRUE, n.report = 200, n.burn = n.burn, 
    n.thin = n.thin, n.chains = n.chains)

Samples per Chain: 20000
Burn-in: 10000
Thinning Rate: 10
Number of Chains: 3
Total Posterior Samples: 3000
Run Time (min): 0.3841

Abundance (log scale): 
                      Mean     SD     25%     50%     75%   Rhat  ESS
(Intercept)        -0.9963 0.2950 -1.1701 -0.9805 -0.8103 1.0142  408
scale(abund.cov.1)  0.1049 0.1138  0.0262  0.1038  0.1818 1.0012 2284

Abundance Random Effect Variances (log scale): 
                             Mean     SD    25%    50%    75%   Rhat  ESS
(Intercept)-abund.factor.1 0.6936 0.5535 0.3578 0.5446 0.8356 1.0128 1976

Detection (logit scale): 
                    Mean     SD     25%     50%    75%   Rhat  ESS
(Intercept)       0.9400 0.1945  0.8106  0.9364 1.0704 1.0081 1753
scale(det.cov.1)  1.9916 0.2481  1.8187  1.9859 2.1560 1.0115 2108
scale(det.cov.2) -0.0032 0.1539 -0.1035 -0.0064 0.1005 1.0022 2421</code></pre>
<p>The model summary also provides information on convergence of the MCMC chains in the form of the Gelman-Rubin diagnostic <span class="citation">(Brooks and Gelman 1998)</span> and the effective sample size (ESS) of the posterior samples. Here we find all Rhat values are less than 1.1 and the ESS values are substantially large for all parameters. The ESS values are also adequately high for all model parameters, indicating adequate mixing of the MCMC chains.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a><span class="co"># Abundance parameters</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a><span class="kw">plot</span>(out<span class="op">$</span>beta.samples, <span class="dt">density =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="co"># Detection parameters</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a><span class="kw">plot</span>(out<span class="op">$</span>alpha.samples, <span class="dt">density =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
</div>
<div id="posterior-predictive-checks" class="section level2">
<h2>Posterior predictive checks</h2>
<p>The function <code>ppcAbund()</code> performs a posterior predictive check on all <code>spAbundance</code> model objects as a Goodness of Fit (GoF) assessment. The fundamental idea of GoF testing is that a good model should generate data that closely align with the observed data. If there are drastic differences in the true data from the model generated data, our model is likely not very useful <span class="citation">(Hobbs and Hooten 2015)</span>. In <code>spAbundance</code>, we perform posterior predictive checks using the following approach:</p>
<ol style="list-style-type: decimal">
<li>Fit the model using any of the model-fitting functions (here <code>NMix()</code>), which will generate replicated values for all observed data points.</li>
<li>Optionally bin both the actual and the replicated count data in some manner, such as by site or replicate.</li>
<li>Compute a fit statistic on both the actual data and also on the model-generated ‘replicate data’.</li>
<li>Compare the fit statistics for the true data and replicate data. If they are widely different, this suggests a lack of fit of the model to the actual data set at hand.</li>
</ol>
<p>To perform a posterior predictive check, we send the resulting <code>NMix</code> model object as input to the <code>ppcAbund()</code> function, along with a fit statistic (<code>fit.stat</code>) and a numeric value indicating how to group, or bin, the data (<code>group</code>). Currently supported fit statistics include the Freeman-Tukey statistic and the Chi-Squared statistic (<code>freeman-tukey</code> or <code>chi-squared</code>, respectively, <span class="citation">Kéry and Royle (2016)</span>). Currently, <code>ppcAbund()</code> allows the user to group the data by row (site; <code>group = 1</code>), column (replicate; <code>group = 2</code>), or not at all (<code>group = 0</code>). <code>ppcAbund()</code> will then return a set of posterior samples for the fit statistic (or discrepancy measure) using the actual data (<code>fit.y</code>) and model generated replicate data set (<code>fit.y.rep</code>), summed across all data points in the chosen manner. We generally recommend performing a posterior predictive check using all forms of grouping, as they may reveal (or fail to reveal) different inadequacies of the model for the specific data set at hand <span class="citation">(Kéry and Royle 2016)</span>. Throughout this vignette, we will display different types of poseterior predictive checks using different combinations of the fit statistic and grouping approach.</p>
<p>The resulting values from a call to <code>ppcAbund()</code> can be used with the <code>summary()</code> function to generate a Bayesian p-value, which is the probability, under the fitted model, to obtain a value of the fit statistic that is more extreme (i.e., larger) than the one observed, i.e., for the actual data. Bayesian p-values are sensitive to individual values, so we may also want to explore the discrepancy measures for each (potentially “grouped”) data point. <code>ppcAbund()</code> returns a matrix of posterior quantiles for the fit statistic for both the observed (<code>fit.y.group.quants</code>) and model generated, replicate data (<code>fit.y.rep.group.quants</code>) for each “grouped” data point.</p>
<p>We next perform a posterior predictive check using the Freeman-Tukey statistic grouping the data by sites. We summarize the posterior predictive check with the <code>summary()</code> function, which reports a Bayesian p-value. A Bayesian p-value that hovers around 0.5 indicates adequate model fit, while values less than 0.1 or greater than 0.9 suggest our model does not fit the data well <span class="citation">(Hobbs and Hooten 2015)</span>. As always with a simulation-based analysis using MCMC, you will get numerically slightly different values.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a>ppc.out &lt;-<span class="st"> </span><span class="kw">ppcAbund</span>(out, <span class="dt">fit.stat =</span> <span class="st">&#39;freeman-tukey&#39;</span>, <span class="dt">group =</span> <span class="dv">1</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a><span class="kw">summary</span>(ppc.out)</span></code></pre></div>
<pre><code>
Call:
ppcAbund(object = out, fit.stat = &quot;freeman-tukey&quot;, group = 1)

Samples per Chain: 20000
Burn-in: 10000
Thinning Rate: 10
Number of Chains: 3
Total Posterior Samples: 3000

Bayesian p-value:  3e-04 
Fit statistic:  freeman-tukey </code></pre>
<p>The Bayesian p-value here is very close to 0, indicating inadequate model fit. In particular, a value close to 0 indicates there is more variability in the observed data points than the replicate data points generated by our model. This could be a result of (1) missing sources of variability in true abundance; (2) missing sources of variability in detection probability; or (3) missing sources of variability in both abundance and detection. We will see later in the vignette that our low Bayesian p-value in this case is a result of additional spatial variability in abundance. See the <a href="https://www.jeffdoser.com/files/spoccupancy-web/">introductory <code>spOccupancy</code> vignette</a> for ways to further explore resulting objects from posterior predictive checks.</p>
<div id="a-brief-note-on-generation-of-fitted-values-for-posterior-predictive-checks" class="section level3">
<h3>A brief note on generation of fitted values for posterior predictive checks</h3>
<p>For N-mixture models, the <code>ppcAbund()</code> function contains an additional argument <code>type</code>, which is used to indicate the specific form of fitted value to generate from the given model. This argument can take two values: <code>marginal</code> and <code>conditional</code>. When <code>type = &#39;conditional&#39;</code>, the fitted values are generated conditional on the observed data points, while when <code>type = &#39;marginal&#39;</code>, the fitted values are not generated conditioanl on the observed data points. More specifically, for the conditional fitted values, the fitted value at site <span class="math inline">\(j\)</span> and replicate <span class="math inline">\(k\)</span>, denoted as <span class="math inline">\(\hat{y}_{j, k}\)</span> is calculated according to</p>
<p><span class="math display">\[\begin{equation}
   \hat{y}_{j, k} \sim \text{Binomial}(N_j, p_{j, k}),
\end{equation}\]</span></p>
<p>where <span class="math inline">\(N_j\)</span> is the estimated abundance at site <span class="math inline">\(j\)</span> and <span class="math inline">\(p_{j, k}\)</span> is the probability of detecting an individual at site <span class="math inline">\(j\)</span> during replicate <span class="math inline">\(k\)</span>. The reason we refer to these as “conditional” fitted values is because the values of <span class="math inline">\(N_j\)</span>, which are estimated directly when fitting the model, are actually conditional on the observed data values. Rrecall that when supplying initial values for <span class="math inline">\(N_j\)</span>, we had to ensure the initial values were greater than or equal to the observed data values. This showcases the conditional nature of the <span class="math inline">\(N_j\)</span> estimates when fitting the model, as the smallest value <span class="math inline">\(N_j\)</span> can take at any given iteration of the MCMC algorithm is the largest observed number of individuals at that site across all <span class="math inline">\(K_j\)</span> replicates. Thus, fitted values generated in this manner are in a sense <em>conditional</em> on the observed data values given the restraints on <span class="math inline">\(N_j\)</span>.</p>
<p>Instead, we can imagine calculating fitted values in a slightly different way that eliminates the conditional nature of the <span class="math inline">\(N_j\)</span> estimates. The second approach, which we refer to as the “marginal” approach, generates fitted values by first predicting a value of latent abundance at site <span class="math inline">\(j\)</span> using the expected abundance at site <span class="math inline">\(j\)</span> (i.e., <span class="math inline">\(\mu_j\)</span>), and then subsequently generating a fitted data point for each replicate <span class="math inline">\(k\)</span> at site <span class="math inline">\(j\)</span>. More specifically, we generate marginal fitted values according to</p>
<p><span class="math display">\[\begin{equation}
\begin{split}
  \hat{N}_{j, k} &amp;\sim \text{Poisson}(\mu_j), \\
  \hat{y}_{j, k} &amp;\sim \text{Binomial}(\hat{N}_j, p_{j, k}).
\end{split}
\end{equation}\]</span></p>
<p>Note that the Poisson distribution would be replaced with a negative binomial distribution if that is used to fit the model. By calculating fitted values in this manner, the <span class="math inline">\(\hat{N}_j\)</span> values are no longer required to be at least as large as the maximum number of individuals ever observed at a site. We believe the marginal approach for generating fitted values will be more sensitive to inadequate model fit. In particular, the marginal approach should be better (i.e., more sensitive) in terms of determining if there is unaccounted for variation in expected abundance compared to the conditional approach. Thus, we recommend using the marginal fitted values to do posterior predictive checks, and this is by default the value of <code>type</code> in <code>ppcAbund()</code>. We also envision situations where using both types of fitted values could provide additional insights into why a model does not adequately fit a data set. Goodness of Fit in hierarchical models like N-mixture models and occupancy models is an active area of research, and so future approaches may be implemented. This discussion applies to all N-mixture models discussed in this vignette.</p>
</div>
</div>
<div id="model-selection-using-waic" class="section level2">
<h2>Model selection using WAIC</h2>
<p>Posterior predictive checks allow us to assess how well our model fits the data, but they are not very useful if we want to compare multiple competing models and ultimately select a final model based on some criterion. Bayesian model selection is very much a constantly changing field. See <span class="citation">Hooten and Hobbs (2015)</span> for an accessible overview of Bayesian model selection for ecologists.</p>
<p>For Bayesian hierarchical models like N-mixture models, the most common Bayesian model selection criterion, the deviance information criterion or DIC, is not applicable <span class="citation">(Hooten and Hobbs 2015)</span>. Instead, the Widely Applicable Information Criterion <span class="citation">(Watanabe 2010)</span> is often recommended to compare a set of models and select the best-performing model for final analysis.</p>
<p>The WAIC is calculated for all <code>spAbundance</code> model objects using the function <code>waicAbund()</code>. We calculate the WAIC as</p>
<p><span class="math display">\[
\text{WAIC} = -2 \times (\text{elpd} - \text{pD}),
\]</span></p>
<p>where elpd is the expected log point-wise predictive density and pD is the effective number of parameters. We calculate elpd by calculating the likelihood for each posterior sample, taking the mean of these likelihood values, taking the log of the mean of the likelihood values, and summing these values across all sites. We calculate the effective number of parameters by calculating the variance of the log likelihood for each site taken over all posterior samples, and then summing these values across all sites. See Appendix S1 from <span class="citation">Broms, Hooten, and Fitzpatrick (2016)</span> for more details.</p>
<p>We calculate the WAIC using <code>waicAbund()</code> for our model below (as always, note some slight differences with your solutions due to Monte Carlo error).</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="kw">waicAbund</span>(out)</span></code></pre></div>
<pre><code>N.max not specified. Setting upper index of integration of N to 10 plus
the largest estimated abundance value at each site in object$N.samples</code></pre>
<pre><code>      elpd         pD       WAIC 
-273.35113   17.14231  580.98690 </code></pre>
<p>Note the somewhat cryptic message that is displayed to the screen when you run the previous line. When calculating WAIC for N-mixture models (and distance sampling models), we need to integrate out the latent abundance values, which requires setting an upper bound to the potential value of the latent abundance values <span class="math inline">\(N_j\)</span> at each spatial location. By default, <code>waicAbund()</code> will set that upper bound to the largest abundance value at each site plus 10 (as indicated by the message). This upper bound can be controlled further with the <code>N.max</code> argument in <code>waicAbund()</code>. See the help page for <code>waicAbund</code> for details.</p>
<p>Now let’s do a bit of model comparison. We will fit the same model as before, except now we will use a negative binomial distribution. We fit the model below, setting <code>verbose = FALSE</code> to hide the messages printed by the model fitting functions.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a><span class="co"># Approx run time: 30 sec</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a>out<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">NMix</span>(<span class="dt">abund.formula =</span> <span class="op">~</span><span class="st"> </span>abund.cov<span class="fl">.1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>abund.factor<span class="fl">.1</span>),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true"></a>          <span class="dt">det.formula =</span> det.formula, <span class="dt">data =</span> data.one.sp, </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true"></a>          <span class="dt">inits =</span> inits, <span class="dt">priors =</span> priors, <span class="dt">n.batch =</span> n.batch, </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true"></a>          <span class="dt">batch.length =</span> batch.length, <span class="dt">tuning =</span> tuning, </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true"></a>          <span class="dt">n.omp.threads =</span> <span class="dv">1</span>, <span class="dt">family =</span> <span class="st">&#39;NB&#39;</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>, </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true"></a>          <span class="dt">n.burn =</span> n.burn, <span class="dt">n.thin =</span> n.thin, <span class="dt">n.chains =</span> n.chains)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true"></a><span class="co"># Compare models with WAIC</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true"></a><span class="co"># Poisson</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true"></a><span class="kw">waicAbund</span>(out)</span></code></pre></div>
<pre><code>N.max not specified. Setting upper index of integration of N to 10 plus
the largest estimated abundance value at each site in object$N.samples</code></pre>
<pre><code>      elpd         pD       WAIC 
-273.35113   17.14231  580.98690 </code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a><span class="co"># Negative binomial</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true"></a><span class="kw">waicAbund</span>(out<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>N.max not specified. Setting upper index of integration of N to 10 plus
the largest estimated abundance value at each site in object$N.samples</code></pre>
<pre><code>      elpd         pD       WAIC 
-266.01629   11.84066  555.71389 </code></pre>
<p>From this simple model comparison exercise, we see the negative binomial model outperforms the Poisson models, indicating there is substantial overdispersion in latent abundance that is not captured by the covariate/random effect included in the model.</p>
</div>
<div id="prediction" class="section level2">
<h2>Prediction</h2>
<p>All model objects from a call to <code>spAbundance</code> model-fitting functions can be used with <code>predict()</code> to generate a series of posterior predictive samples at new locations, given the values of all covariates used in the model fitting process. Given that we standardized the covariate values when we fit the model, we need to standardize the covariate values for prediction using the exact same values of the mean and standard deviation of the covariate values used to fit the data.</p>
<p>We envision the <code>predict()</code> functions can be used for two purposes: (1) generating marginal effects plots; and (2) predicting across some region of interest. The approach to do the prediction is the same for both purposes. In this vignette, we will use the <code>predict()</code> function to generate a marginal effects plot for the effect of the covariate on abundance. See the distance sampling vignette for an example of how to do prediction with the purpose of creating a map of abudance across space (the syntax is exactly the same for N-mixture models).</p>
<p>First, we create a set of evenly-spaced values of the covariate across the range of observed values, and subsequently standardize them by the mean and standard deviation of the covariate used to fit the model.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a>cov.pred.vals &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(dataNMixSim<span class="op">$</span>abund.covs[, <span class="st">&#39;abund.cov.1&#39;</span>]), </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true"></a>             <span class="kw">max</span>(dataNMixSim<span class="op">$</span>abund.covs[, <span class="st">&#39;abund.cov.1&#39;</span>]), </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true"></a>                     <span class="dt">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true"></a><span class="co"># Scale predicted values by mean and sd used to fit the model</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true"></a>cov.pred.vals.s &lt;-<span class="st"> </span>(cov.pred.vals <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(dataNMixSim<span class="op">$</span>abund.covs[, <span class="st">&#39;abund.cov.1&#39;</span>])) <span class="op">/</span><span class="st"> </span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true"></a><span class="st">                   </span><span class="kw">sd</span>(dataNMixSim<span class="op">$</span>abund.covs[, <span class="st">&#39;abund.cov.1&#39;</span>])</span></code></pre></div>
<p>For <code>NMix()</code>, the <code>predict()</code> function takes four arguments:</p>
<ol style="list-style-type: decimal">
<li><code>object</code>: the <code>NMix</code> fitted model object.</li>
<li><code>X.0</code>: a matrix or data frame consisting of the design matrix for the prediction locations (which must include an intercept if our model contained one).</li>
<li><code>ignore.RE</code>: a logical value indicating whether or not to remove random effects from the predicted values. By default, this is set to <code>FALSE</code>, and so prediction will include the random effects.</li>
<li><code>type</code>: a quoted keyword indicating whether we want to predict <code>abundance</code> or <code>detection</code>. This is by default set to <code>abundance</code>.</li>
</ol>
<p>Here, we only seek to predict to visualize the relationship between the covariate and abundance, and so we will predict without the random effect and set <code>ignore.RE = TRUE</code>. Thus, our design matrix that we form below only consists of the intercept and covariate value. If we were to predict with the random effect, the random effect values at the prediction location would be included as another column in <code>X.0</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a>X<span class="fl">.0</span> &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">data.frame</span>(<span class="dt">intercept =</span> <span class="dv">1</span>, <span class="dt">abund.cov.1 =</span> cov.pred.vals.s))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a>out.pred &lt;-<span class="st"> </span><span class="kw">predict</span>(out<span class="fl">.2</span>, X<span class="fl">.0</span>, <span class="dt">ignore.RE =</span> <span class="ot">TRUE</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true"></a><span class="kw">str</span>(out.pred)</span></code></pre></div>
<pre><code>List of 3
 $ mu.0.samples: &#39;mcmc&#39; num [1:3000, 1:100] 0.462 0.367 0.42 0.197 0.272 ...
  ..- attr(*, &quot;mcpar&quot;)= num [1:3] 1 3000 1
 $ N.0.samples : &#39;mcmc&#39; num [1:3000, 1:100] 0 0 0 0 0 0 0 0 0 1 ...
  ..- attr(*, &quot;mcpar&quot;)= num [1:3] 1 3000 1
 $ call        : language predict.NMix(object = out.2, X.0 = X.0, ignore.RE = TRUE)
 - attr(*, &quot;class&quot;)= chr &quot;predict.NMix&quot;</code></pre>
<p>The resulting object consists of posterior predictive samples for the expected abundances (<code>mu.0.samples</code>) and latent abundance values (<code>N.0.samples</code>). The beauty of the Bayesian paradigm, and the MCMC computing machinery, is that these predictions all have fully propagated uncertainty. Below, we produce a plot showing the relationship between expected abundance and the covariate, with the 95% credible interval shown in grey and the posterior median shown with the black line.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true"></a><span class="co"># Get the lower bound, median, and 95% credible interval</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true"></a>mu.<span class="fl">0.</span>quants &lt;-<span class="st"> </span><span class="kw">apply</span>(out.pred<span class="op">$</span>mu.<span class="fl">0.</span>samples, <span class="dv">2</span>, quantile, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true"></a>                          <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true"></a>mu.plot.dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">mu.med =</span> mu.<span class="fl">0.</span>quants[<span class="dv">2</span>, ], </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true"></a>                                 <span class="dt">mu.low =</span> mu.<span class="fl">0.</span>quants[<span class="dv">1</span>, ], </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true"></a>                                 <span class="dt">mu.high =</span> mu.<span class="fl">0.</span>quants[<span class="dv">3</span>, ], </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true"></a>                          <span class="dt">abund.cov.1 =</span> cov.pred.vals)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true"></a><span class="kw">ggplot</span>(mu.plot.dat, <span class="kw">aes</span>(<span class="dt">x =</span> abund.cov<span class="fl">.1</span>, <span class="dt">y =</span> mu.med)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> mu.low, <span class="dt">ymax =</span> mu.high), <span class="dt">fill =</span> <span class="st">&#39;grey70&#39;</span>) <span class="op">+</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Covariate&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;Expected abundance&#39;</span>) </span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAAHgCAMAAABKCk6nAAAC+lBMVEUAAAABAQECAgIDAwMEBAQFBQUGBgYHBwcICAgJCQkKCgoLCwsMDAwNDQ0ODg4PDw8QEBARERESEhITExMUFBQVFRUWFhYXFxcYGBgZGRkaGhobGxscHBwdHR0eHh4fHx8gICAhISEiIiIjIyMkJCQlJSUmJiYnJycoKCgpKSkqKiorKyssLCwtLS0uLi4vLy8wMDAxMTEyMjIzMzM0NDQ1NTU2NjY3Nzc4ODg5OTk6Ojo7Ozs8PDw9PT0+Pj4/Pz9AQEBBQUFCQkJDQ0NERERFRUVGRkZHR0dISEhJSUlKSkpLS0tMTExNTU1OTk5PT09QUFBRUVFSUlJTU1NUVFRVVVVWVlZXV1dYWFhZWVlaWlpbW1tcXFxdXV1eXl5fX19gYGBhYWFiYmJjY2NkZGRlZWVmZmZnZ2doaGhpaWlqampra2tsbGxtbW1ubm5vb29wcHBxcXFycnJzc3N0dHR1dXV2dnZ3d3d4eHh5eXl6enp7e3t8fHx9fX1+fn5/f3+AgICBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmKioqLi4uMjIyNjY2Ojo6Pj4+QkJCRkZGSkpKTk5OUlJSVlZWWlpaXl5eYmJiZmZmampqbm5ucnJydnZ2enp6fn5+goKChoaGioqKjo6OkpKSlpaWmpqanp6eoqKipqamqqqqrq6usrKytra2urq6vr6+wsLCxsbGysrKzs7O0tLS1tbW2tra3t7e4uLi5ubm6urq7u7u8vLy9vb2+vr6/v7/AwMDBwcHCwsLDw8PExMTFxcXGxsbHx8fIyMjJycnKysrMzMzNzc3Ozs7Pz8/Q0NDR0dHT09PU1NTV1dXW1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/g4ODh4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7///9Onm6aAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAaW0lEQVR4nO3de3gU5b3A8UEiyt1LhAByPVEKKHiEQEWMBgRy1AgCDRqCOVzK/VZukioEjYClCIVEDhJi0IOVIuG2FdoqBuRSDtKWUjBVlKN4LCywSSAEc3uf58y72d2EzOzuO/PO7HuZ3/ePze6yO/O+7+fZzW4ybBQESZ3CegCQvQGw5AGw5AGw5AGw5AGw5JkGPvASUQsWkt0uaAvnUW7AiiFQb2EB5QZemmd0C+/SAm8+QXSzaxVmd+DrhruKcgtlP1JuoMJdTrmF8uuUG6h23zB2h8pf+M4AcPgAOEQAjAPg4AEwDoBDBMCmAmADAXDwABgHwCECYFMBsIEAOHgAjAPgEAGwqQDYQAAcPADGAXCIANhUAGwgAA4eAOMAOEQAbCoANhC3wEd8Mzs148WcqsAXbwBsIF6Bz48urbn1uJNlCwv8X2oCYAPZDezSXEME/MaopBrgEwsQOpTh/1ITABvIZmCXSWCERtYA71uH0Llp/i81AbCBeAfeloPQhVT/F4Qupaamzj7oIenyFaKbhdiAm3ID9EO44qbewmXKDXhCDcHlcmmuuzTLCPDeLPWhO8X/BaHiZcuWvXz4KkmeYqKbBa/IXUK7BdohFLupt+Ch3MBVd1HQf1J9XZori2YbAT6xCKGjGf4vNcFTtIFsfYrGwJorjTxFF16vTDtbtWQ/8n2pCYANZCewixp4+Gl0Ztbk3Grk/+INgA1kI7CLCjhEAGwgAA4eAOOCArsAGIDNBcAGsg3YBcBSA7sAGMkM7AJgnLTALgD2JiuwC4BrkhTYBcC+ANhUAGwgG4BdAOwPgE0FwAayHtgFwIFkBHYBcG0SAtf3BWCquAPW+AIwVQAcIgDGWQus9QVgqjgD1vEFYKoAOEQAjLMSWM8XgKkC4BABMM5CYF1fAKYKgEMEwDjrgPV9AZgqjoCD+AIwVQAcIgDGWQUczBeAqeIGOKgvAFPFC3BwXwCmCoBDBMA4S4BD+AIwVXwAh/IFYKq4AA7pC8BUAXCIABhHDxzaF4Cp4gA4jC8AU8UeOJwvAFPFHDisLwBTBcAhAmAcHXB4XwCmijEwgW+EgLW7AeCaaIBJfCMFrCMMwDgKYCLfiAFrdwTAOPPAZL6RA9bsCYBxpoEJfSMIXH9XAIwzC0zqG0ngevsCYJxJYGLfiALfvDMAxskFfNPeABhnDpjc1w7gd47dqF9gd3WuKy7V3MxYV91ltFu4RrmBUjftJEpLTNzJgK9Lc+dSsr+6YhK4zv4A2LsFE8BGfO0ADvEUXfcpA56icSaeog35Rvh7cN09AjBOQmD/LgEYZxzYmC8LYN9OARhnGNigLxtg714BGGcU2KgvI2C8WwDGyQrsAuCaDAIb9mUG7HIBMM4YsHFfhsAuAEYGgU34sgTWO47HSADMOzClsOOAzfiyBaYTdhqwKV/GwFTEDgM258scmELYWcAmfdkDmxd2FLBZXw6ATQsDMACHSRxg0748AJsVdhCweV8ugE0KOwaYgpcTYHPCAAzAYRIDmMqXE2BTwg4BpvPlBdiMsDOAKX25ATYh7AhgWl8Apsp2YGpffoCNC8sPTM/LE7BhYdmBreDlCtiosNzA1vDyBWxQWGpgq3z5AjYmLDOwZb6cARsilhjYOl/ugA0IA7CQwOTC8gJb6MshMLGwtMBW+vIITCoMwKICEwrLCmypL5/AZMIADMBh4hLYWl9OgYmEAVhgYBJhOYEt9uUWmEAYgIUGDi8sJbDVvhwDhyWWEdhaXN1F5Ag4jLCEwJbSBllDnoBDE8sHbKFr8BXkCzgUsXTAlqGGXD/egIMLywZsFWmY5eMOOCixZMDWeIZfPA6BgxDLBWwFJtHScQmsKywTsAWSpCtHBHxqxos53tXdnoQrQvPU0w2+f7QDWI9YHmALlod83UiAK8edLFtYgM9VlZeXn3gNodSS8vJK37/aA6wdqjTAlqwO6aoRAZ9YgNChDP8d5l5AZal1/tUu4PpjlQXYmsUhXDQy4H3rEDo3zXfh93kIfZM6MyXzinrB85LaoZL6WTTYmzfqcRdrdmQsTxHlBordtFsosmhpCNdMzTMrPPC2HIQu+B60FZM9CH2x/HLlmyvUS5dSU1NnH/TUz6rR3rTRy27Nfgx2+QrlBq64qbdg1dIQLRnuEgHw3iz1ETyl5vyBTN+VhaN9Z2x7inbd/IQjxVO0ZStDsmLeiL4HL0LoqO97cMZH6klhIUJn/d+H7QSuO2AZgC1cmLDr5YvoVXTa2aol+1XX6+jG8B/UKw6Pu1C1Ntv3r/YC1w5ZAmBL1yX0agUieh98Ztbk3GqEhp9Gf5vkvSJ/YtqaUt8/2g3sH7T4wBYvS4i1qhOfP8nSG7bowJYvStCVuikxgPHABQe2YU3016leogC7BAe2Y0l0l6l+wgCriQts04LopNm1SMC0f9aDFbBty0GyQmIB682APEbAdq5G+OURDphCmAmwrWtBsDriAZsnZgFs81KEXxtdYM+mTHSyUnNb/SIPbFY48sB2LwTB0ugBf9u9tYL69ThHNgkGwCaJIw1s/zIQLIwe8NNjKqPQ+cefI5sGE2BTxBEGjsQqhF8WPeDmx1EUQp/cQTYPRsAmhCMKHJE1IFgVPeB7P8PAe9uTzYQVsHHhSAJHZgkIFkUPeFKCJwqdvm862VSYARsWjiBwhFaAYE30gIsSblViGowo1dxYN3bA+jMKXuSAI7kAYZZD/33wsbwd/ySdNWNgA8SRAo7s9MMshh5wxdzxCMXNLyObNXPgIDPTFiFgFrMPvgx6wOmtNyO0sd0vNDfWjRNgvcnVKyLAjOYedA30gDu/j08/aEs2a36AwwlHApjV1IMugR5w9FF8evxusllzBBxGOALAzGYedAX0gJOHehAqSRpBNmuegEML2w/MbuJBF0AP+GKvpv36t+j6PdmsuQIOKWw3MMNpB9IMSvdtUtVHb2TmVxDOmi/gUMS2AjOdc22acekCl33ljWzWvAEHF7YTmO2Ua9MMTA/4w9sVb2Sz5g44KLGNwKxnHEgzMj3gLs8XXsKRzZpD4CDEtgGznm2dNGPTA779H0ZmzSVwoLrDsgmY9RRvSjM6PeDu+UZmzTewq86crQdmPTVtmjHrAe9ot/yPB9TIZs09sMs/bYuBWU9KN82Y9YCjfJHNWgTgmolbCsx6QkHSjFnEw2ZNZikw68kESzPm4MDuOLJZCwPsj1BTJx8w6wmESjNmPeC/xUWrNelONmvhgH0Z5vUCsx51uIiA4x9/747NWzp+ITewi9SY9SgNRQTcrACN/D3a/jPpgTUJrusiBL5nP/rlSvStgL8PtjBBJ0IEnJTw9e/iPDltHA0saETAX3ZbVdarkbIMgMWLCBihanR1zxEyXwDmqvDAn9QGwOIVHriZWgNFaag0eQCAxSs8sNru9rtLKw7ctwOAxYsIuKeX1tUTgMWLCLjlZ/j0MOf/PxjSiwh4yOAShEqGDAVg8SIC/rLNnUOH3tn2SwAWLyJgVJozZ94mzR8jB2ABIgMW+7hoR0cELPxx0Q6OCNjYcdF5xyvqx3qWDk5jcWOOFtjYcdG5R67Vj/UsHZzGoni2Fliy46IdlcbCGcdFOyciYBmPi3ZKRMDGAmCeIgIu8gXA4kUErCjwPljUiIC/UPv7lg5vA7B4EQHX9ElUCQALlwHgU7fcAGDhIgI+hTv8dDciXwDmKiLgmpdYrf4AwOJFBFzzQ0wyXgDmKyJgdGnVhKnrSYUBmKeIgP/aotXwkTEx8At/ASMCfuzp6whdf2YIAIsXEXBz72GzR1oCsHgRAT/s/X3wrh4ALF5EwAdidxUV7WqXDcDiFR5YCSTeR/pDBMDHagNg8QoPHEjaz8mSOiJgZ3xOlpwRATvmc7IkjAjYuZ+TJX5EwPA5WeJGBAyfkyVuRMDwOVniRgQMn5MlboTARgJgngJgyQNgyQNgyQsPDJ9VKXThgeGzKoUuPDCCz6oUOSJg+KxKcSMChs+qFDciYPisSnEjAobPqhQ3ImD4rEpxIwP2bMpEJysBWMCIgL/t3lpB/XqcA2DxIgJ+ekxlFDr/+HMALF5EwM2PoyiEPoG3SQJGBHzvZxh4b3sAFi8i4EkJnih0+r7pACxeRMBFCbcqMQ1GlAKweBEBI3Qsb8c/yXgBmK+IgBO9p56RACxe4YGvrlqlrMJNgwPfBSw88MUBA5QBuPhNgRudmvFiTpX33LykpKQNda8AYL4KD6zWp/5txp0sW1jgPZtaUl5eWfcKAOYrIuCKueMRiptf5r98YgFChzLwubLUelcAMGcRAae33ozQxnb+f0H71iF0bho+903qzJTMK7VXXNu8eXPm0ev1Yz1LB6exuKrzV1c6v49PPwh8Rse2HIQueB+7Xyy/XPnmitorLiQkJEwuuFQ/1rN0cBqLCzO1wNFH8enxwKvovVnqA3aK/1Lh6JuvgKdoniJ6ik4e6kGoJGmE//KJRQgd9X7LLSxE6GxqnSsAmLOIgC/2atqvf4uu3wduk3a2asl+lff64XEXqtZmB64AYO4iAkZVH72RmV9Re/nMrMm51QgNP43yJ6atKQ1cAcDcRQYMh+wIGxEwHLIjbkTAcMiOuBEBwyE74kYEDIfsiBsRMByyI25EwHDIjrgRAcMhO+JGBly8bsrE1R4AFjAi4H/c3Wr4yDZ3nQJg8SICTsB/Vqfs2QQAFi8i4GaH8OnRFgAsXkTAMdvx6c5eACxeRMAb226/dGl7+72VlSS/cABgniICjr7F/5d1OgGwYBEB1/5hnb8CsGARAad7/7b7lQkEugDMWUTAPXscR2h7DPzdJAEjAq5Y3nTBc83XVWluDMDcRwSM0GJF+YCMF4D5igj47JOttmU1m1wEwOJFBNx47GWEvoqHvz4qYETA+7yn1WsBWLyIgI0FwMzbsnLOC4l9YzvGxg4KD5x4BqH/W6qe+TwKgDluS1bG7LHDBvZ54N9imiqK0rzDQwMTExPHhAdWjqm2+MLnhI9pAI5sW15NG9SrbSP8k+Tb7ol9eMCQYSnzV2/1/ysAi9x7S1L63q0ojTr3fWbcvBUbtuvcBICFbNem16c/26ulojR+YNjc7F0hbgnA4rTjzSkjEuP7PRTb4Z4oRWnQKm7U/PV7wt0JgIUof9W0obFRyi2tOnV9qH9C4siJr2R9SHZPAuCEUaMGKqPwCQBHup3r01Of6NmhZQOlQbv4iW8QotYtPPDw2gA4cuWvXTC6f3v1qbjxfT/9j+en/mqbye2EBzYcANO1c+38n/Vrc4uiNOs2dMKruZRbA2CO+jDrlfEDO6uP2hYPPjV12XuWbBOAuWj3xkXJve9SFCWq86CJr2+xcMsAzLi8FbOSH+2oPmqb93puxuubQr2lNRUAs2lH3trlL09/ujv+sXHLboPHLaH9XhssAI5o76+YPvqpAT07tPAehNwgpn9K+jqzr4/JAuCI9MGq2c8PjrtPdW3Qsn33fokvTHtlRVae3s+OrQ6A7Wt37or5P09+sl+PDi3xE3Gnhwcmz1tj4mcVVAGwlW1dt2bNmuWZmZmvTHjq4TbqKyel4V2dej6aOHrOqq3h721LAEzf1tULxiQlJg7o1lIJFNWu9zMTfrnWyjc85gJgs324LC2pf7c20c1uVT2bxnSK7Togec7KNd425O1mPTx/AGyiHb+ZM+z+hkqjdj3ik0alps1Zyf6BGjQANtbWFRMTOjRUlOhHf77G8h9K2BEAE7ZrQ/rYhK7q+5yGnZ+ctPy3rIdDHACHKH/jylempw5L6POTe+9UXxLfHvtY8pzV+axHZSwA1m3n26+O9z4VK0rjVvf3jn8qeeLS3LCHx/AYAN/czrVzxzzZs7VKG9Vl8KSMNXk7WI+IMhuA8z6vrh/rWZL02zULxw7soj4TN+nU79lJGRt2sh6QNWksKqiBcw+V1I/1LIO2e8Oi5xOHDhjwUPvb8LNxl4ETlr3PekzWprHwzKIFFuMpeudbC1Me69JIUZp2iY3tEffU2Lkr/5v1mOxIYyH99+CdOa/PTH6sk/pc3PT+QWkZ77Aej805Bjg/99fpPx/+WLe7GuDf7HQdPCHzXdZDikjSA29dv3zuC/GxzfA7nobR3eJHTllMesy4FMkLvO2tpROHdG2MYZvdnzBmxuLVm7n5DUAEkw14z7trM+akJsZ1wgc7RXUYkDo38y1xfq5oQ3IA73nvN4tnpT03qJf3l+xK4/YPD06Z87osb2WpEht4z7sr540d3LO1l7VRdJe+SeMXrdwYiUOdhElM4D15y2aOSnigDf5d++0d+yZNXLgyF1h1Ewl4T86S6ZPSkoc81BbD3tW1f9L4l1Zz/Lt2LhIDeFf2S2Piu3g/hqJJ8w5xT49Pz4IHLFm8A29dv+IXw7rdpsLePyjtlbdF/91O5OMWeMd/Bd7G3v3Ii5l5ls/cIfEI/OGyMb3xTxSjOj42dm5mtqPfxlLHEfCuDaszl8xN7t+uoXL7gyOmLoW3sVbEBfCuDb9MS+hyq/eI8ebdEyetFuJ4RTFiCbzz7V+lT04e2LNtlKI0ih00fumat3Lg+djimADnr18yeXhcW3xMW4M7Y/sljV+6ScgD2kQossD5Welpgx+MVl9ANbin11OTMta9C0/GNhcZ4Hk//Ul0MzVVtlGnR0ZMf+1teAEVoSIDPOmBJ55LU5v2+jvwXBzZIgPMepYODoAlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlD4AlzxzwqRkv5lR5z/15RsriiwjNS0pK2gDAHGYKuHLcybKFBfjchdGFZdmvIpRaUl5eCcAcZgr4xAKEDmXgcwXLEPouBZWl1vlXAOYpU8D71iF0bho+V3YVoQOL0TepM1Myr+DLH3/88a+P3agf61k6OI1F6ezwwNty1Cdn/4P2s7Qz6IvllyvfXKFe+KF3794TPnXXj/UsHZzG4l8zwwPvzVIfwVO8Z0syZ5+rubJwtHpSVVxcnCPmH8aSNFN/GOvEIoSOer8Hl8/Jrca4hQid9T+k4XswT2ksiF5Fp52tWrJfdb1+MN17xeFxF6rWZgMwh5kCRmdmTcaP3OGnc9X3v0ljEMqfmLamFIA5zBxwyACYpwBY8gBY8gBY8gBY8gBY8gBY8gBY8gDYbHheFe5y3ucGwAbSzAsDE8TVmAFYW9CpEgKzXAbNIAA4UPipGgTWKfKTAGASWV/0wOXXbV4jzR4dC2xmqlYC27Ramq07ENjsRO0C9mXT5BwF/KPZOfqyFdgb9RQ1W3QIsHdYZfwDI9rF02zOAcCBYYkBXBvVZP3JDXzzsEQD9kUxYyQzsHakggLXZHbWkgLrjlRoYES2rJo7yQYcaqSiA+Oq3TdCrq/mDhIBhx2pNMA40kWQBJhopFIB1+QIYOKRSghck7zAxkYqLXBNkgGbGKnkwDhZgM2N1AHA2sQDNjtOADZZxIDdVWaH6AuATRUBYO9GbwAwkhLYv1EAxkkGXHejAIyTCLj+RgEYJwuwzn4AGCcDcJD9ADBOdOAQ+wFgnMjAYfYDwDhRgQn2A8A4EYEJ9wPAOOGAyfcDwDiRgA3uB4BxwgAb3w8A44QANrcfAMbxDmx2JwiAa+IX+FqF2R34AmAcl8De6wAYJx9w4DoAxskFfNN1AIyTB1hzHQDjRATOPVRC0pUiopsFz+Mupt0C7RCK3dRb8FBuoMToEDyzaIF1HsF6wSMYJ+IjGIANBMDBA2AcAIcIgE0FwAYC4OABMA6AQwTApgJgAwFw8AAYB8AhAmBTAbCBADh4AIwD4BABsKkA2EAAHDwAxgFwiADYVABsICGBt/wPSQePEt0seIf/dIxyC4eOUG7g6J9ot3DkM8oNHPvTYWN3OEoN/PfNROXmkd0uaKsmbKTcwjvvUG4ga8I61kPImbDS4D320wJHqv293ayHcKb3SdZDKO691+Q9ATh8AGxnAIyTGPj6edpX0dT9eJ72dTh1VedLTd6Te2CILgCWPP6B/zwjZfFFlgM4NePFHMbfJijWgHvgC6MLy7JfZTiAynEnyxYWMBwA3RpwD1ywDKHvUhgO4MQChA5lMBwA3RpwD1x2FaEDixkOYN86hM5NYzgAujXgHljts7QzDPe+LUd9jkxlOABvpteAa+A/TJ36F1SSOfscy0HszVIfwVNYjgDRrAHXwLjyObnVTAdwYhFCR9l+D6ZZA+6BD6YzHkBl2tmqJfuZDoFmDbgHzk1SG8NyBGdmTWb8JEKzBtwDQ3QBsOQBsOQBsOQBsOQBsOQBsOQ5Crgs/d+bdJ7yr9A3uqH8LXD+4lWbR2R/TgK+/mCX7E9yfvJg6MObKuZ/Hzg/YJXdY7I9JwFndLysnl5slhPqRjfpA7BIVTfL9n798I8IXUqNaTPGjZ4dpV7Oji7/clir5o+rz8zKsSHP4qdo3+U+ipKIiid3aPHMd2yHTpGDgL9W/uI/Wx3Xt6Cgbxx6v2kZQo/PQt0S9n8aH6euxiNbvsPA/sv4ETzwiYPHU7p7WI6cJgcBf6r84D9b0PB/ETrX8GDJ7bvRD7ecqF71NULvRaursdz7IitwWQU+dqtqW9l6E8uR0+Qg4K98j2D3l2h9LD7TZQMa8Z8ou4f68vp3L4+8EwP/oeZVtP+yCpynRKkprzEdOkUOAq5qnOX9OvxR9JYXODYbbb27In4luvpQn5WuzRj4sBc4cFkF3hHDdNDUOQgYzWuH/5vT101fQ59Gqa+avo0qQNeabLn1e7Sn0RWEttQCBy6rwIUNTiN0vh/z/51kNicBX41tn/1pdsfYa6i6zyOHDz3Spxqhn0UPReiIsunb/I5N3H7gwOX46R404v59+x/vUcl68GZzEjAqmd29cewU/DB2p7SOGYPPbFfeV0+Xxdw16otucX7gwOVNd49ApVPvvWM408P+qHIUsBMDYMkDYMkDYMkDYMkDYMkDYMkDYMkDYMkDYMkDYMn7fx9OGiLGYVhoAAAAAElFTkSuQmCC" style="display: block; margin: auto;" /></p>
<p>Here we see a moderately positive relationship between the covariate and expected abundance, although there is fairly substantial uncertainty associated with this relationship.</p>
</div>
</div>
<div id="spNMix" class="section level1">
<h1>Single-species spatial N-mixture models</h1>
<div id="basic-model-description-1" class="section level2">
<h2>Basic model description</h2>
<p>When working across large spatial domains, accounting for residual spatial autocorrelation in species distributions can often improve predictive performance of a model, leading to more accurate predictions of species abundance patterns <span class="citation">(Guélat and Kéry 2018)</span>. We here extend the basic single-species N-mixture model to incorporate a spatial random effect that accounts for unexplained spatial variation in species abundance across a region of interest. Let <span class="math inline">\(\boldsymbol{s}_j\)</span> denote the geographical coordinates of site <span class="math inline">\(j\)</span> for <span class="math inline">\(j = 1, \dots, J\)</span>. In all spatially-explicit models, we include <span class="math inline">\(\boldsymbol{s}_j\)</span> directly in the notation of spatially-indexed variables to indicate the model is spatially-explicit. More specifically, the expected abundance at site <span class="math inline">\(j\)</span> with coordinates <span class="math inline">\(\boldsymbol{s}_j\)</span>, <span class="math inline">\(\mu(\boldsymbol{s}_j)\)</span>, now takes the form</p>
<p><span class="math display">\[\begin{equation}
\text{log}(\mu(\boldsymbol{s}_j) = \textbf{x}(\boldsymbol{s}_j)^{\top}\boldsymbol{\beta} + \text{w}(\boldsymbol{s}_j),
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\text{w}(\boldsymbol{s}_j)\)</span> is a spatial random effect modeled with a Nearest Neighbor Gaussian Process (NNGP; <span class="citation">Datta et al. (2016)</span>). More specifically, we have</p>
<p><span class="math display">\[\begin{equation}
\textbf{w}(\boldsymbol{s}) \sim N(\boldsymbol{0}, \boldsymbol{\tilde{\Sigma}}(\boldsymbol{s}, \boldsymbol{s}&#39;, \boldsymbol{\theta})),
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{\tilde{\Sigma}}(\boldsymbol{s}, \boldsymbol{s}&#39;, \boldsymbol{\theta})\)</span> is the NNGP-derived spatial covariance matrix that originates from the full <span class="math inline">\(J \times J\)</span> covariance matrix <span class="math inline">\(\boldsymbol{\Sigma}(\boldsymbol{s}, \boldsymbol{s}&#39;, \boldsymbol{\theta})\)</span> that is a function of the distances between any pair of site coordinates <span class="math inline">\(\boldsymbol{s}\)</span> and <span class="math inline">\(\boldsymbol{s}&#39;\)</span> and a set of parameters <span class="math inline">\((\boldsymbol{\theta})\)</span> that govern the spatial process. The vector <span class="math inline">\(\boldsymbol{\theta}\)</span> is equal to <span class="math inline">\(\boldsymbol{\theta} = \{\sigma^2, \phi, \nu\}\)</span>, where <span class="math inline">\(\sigma^2\)</span> is a spatial variance parameter, <span class="math inline">\(\phi\)</span> is a spatial decay parameter, and <span class="math inline">\(\nu\)</span> is a spatial smoothness parameter. <span class="math inline">\(\nu\)</span> is only specified when using a Matern correlation function. The detection portion of the N-mixture model remains unchanged from the non-spatial N-mixture model. The NNGP is a computationally efficient alternative to working with a full Gaussian process model, which is notoriously slow for even moderately large data sets. See <span class="citation">Datta et al. (2016)</span> and <span class="citation">Finley et al. (2019)</span> for complete statistical details on the NNGP.</p>
</div>
<div id="fitting-single-species-spatial-n-mixture-models-with-spnmix" class="section level2">
<h2>Fitting single-species spatial N-mixture models with <code>spNMix()</code></h2>
<p>We will fit the same N-mixture model that we fit previously using <code>NMix()</code>, but we will now make the model spatially-explicit by incorporating a spatial process with <code>spNMix()</code>. The <code>spNMix()</code> function fits single-species spatial N-mixture models.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true"></a><span class="kw">spNMix</span>(abund.formula, det.formula, data, inits, priors, tuning,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true"></a>       <span class="dt">cov.model =</span> <span class="st">&#39;exponential&#39;</span>, <span class="dt">NNGP =</span> <span class="ot">TRUE</span>, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true"></a>       <span class="dt">n.neighbors =</span> <span class="dv">15</span>, <span class="dt">search.type =</span> <span class="st">&#39;cb&#39;</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true"></a>       n.batch, batch.length, <span class="dt">accept.rate =</span> <span class="fl">0.43</span>, <span class="dt">family =</span> <span class="st">&#39;Poisson&#39;</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true"></a>       <span class="dt">n.omp.threads =</span> <span class="dv">1</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>, <span class="dt">n.report =</span> <span class="dv">100</span>, </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true"></a>       <span class="dt">n.burn =</span> <span class="kw">round</span>(.<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>n.batch <span class="op">*</span><span class="st"> </span>batch.length), <span class="dt">n.thin =</span> <span class="dv">1</span>, </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true"></a>       <span class="dt">n.chains =</span> <span class="dv">1</span>, ...)</span></code></pre></div>
<p>The arguments to <code>spNMix()</code> are very similar to those we saw with <code>NMix()</code>, with a few additional components. The abundance (<code>abund.formula</code>) and detection (<code>det.formula</code>) formmulas, as well as the list of data (<code>data</code>), take the same form as we saw in <code>NMix()</code>, with random slopes and intercepts allowed in both the abundance and detection models. Notice the <code>coords</code> matrix in the <code>data.one.sp</code> list of data. We did not use this for <code>NMix()</code>, but specifying the spatial coordinates in <code>data</code> is necessary for all spatially explicit models in <code>spAbundance</code>.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true"></a>abund.formula &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw">scale</span>(abund.cov<span class="fl">.1</span>) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>abund.factor<span class="fl">.1</span>) </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true"></a>det.formula &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw">scale</span>(det.cov<span class="fl">.1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale</span>(det.cov<span class="fl">.2</span>) </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true"></a><span class="kw">str</span>(data.one.sp) <span class="co"># coords is required for spNMix()</span></span></code></pre></div>
<pre><code>List of 4
 $ y         : int [1:225, 1:5] 0 0 1 0 0 0 0 0 0 0 ...
 $ abund.covs: num [1:225, 1:2] 0.2863 -0.0325 -0.9897 0.2118 -0.972 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : NULL
  .. ..$ : chr [1:2] &quot;abund.cov.1&quot; &quot;abund.factor.1&quot;
 $ det.covs  :List of 2
  ..$ det.cov.1: num [1:225, 1:5] 1.577 0.6956 -0.3031 0.107 0.0284 ...
  ..$ det.cov.2: num [1:225, 1:5] -1.235 -0.509 -2.012 -0.899 0.38 ...
 $ coords    : num [1:225, 1:2] 0 0.0714 0.1429 0.2143 0.2857 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : NULL
  .. ..$ : chr [1:2] &quot;X&quot; &quot;Y&quot;</code></pre>
<p>The initial values (<code>inits</code>) are again specified in a list. Valid tags for initial values now additionally include the parameters associated with the spatial random effects. These include: <code>sigma.sq</code> (spatial variance parameter), <code>phi</code> (spatial decay parameter), <code>w</code> (the latent spatial random effects at each site), and <code>nu</code> (spatial smoothness parameter), where the latter is only specified if adopting a Matern covariance function (i.e., <code>cov.model = &#39;matern&#39;</code>). <code>spAbundance</code> supports four spatial covariance models (<code>exponential</code>, <code>spherical</code>, <code>gaussian</code>, and <code>matern</code>), which are specified in the <code>cov.model</code> argument. Throughout this vignette, we will use an exponential covariance model, which we often use as our default covariance model when fitting spatially-explicit models and is commonly used throughout ecology. To determine which covariance function to use, we can fit models with the different covariance functions and compare them using WAIC to select the best performing function. We will note that the Matern covariance function has the additional spatial smoothness parameter <span class="math inline">\(\nu\)</span> and thus can often be more flexible than the other functions. However, because we need to estimate an additional parameter, this also tends to require more data (i.e., a larger number of sites) than the other covariance functions, and so we encourage use of the three simpler functions if your data set is sparse. We note that model estimates are generally fairly robust to the different covariance functions, although certain functions may provide substantially better estimates depending on the specific form of the underlying spatial autocorrelation in the data. For example, the Gaussian covariance function is often useful for accounting for spatial autocorrelation that is very smooth (i.e., long range spatial dependence). See Chapter 2 in <span class="citation">Banerjee, Carlin, and Gelfand (2003)</span> for a more thorough discussion of these functions and their mathematical properties.</p>
<p>The default initial values for <code>phi</code>, and <code>nu</code> are set to random values from the prior distribution, while the default initial value for <code>sigma.sq</code> is set to a random value between 0.05 and 3. In all spatially-explicit models described in this vignette, the spatial decay parameter <code>phi</code> is often the most sensitive to initial values. In general, the spatial decay parameter will often have poor mixing and take longer to converge than the rest of the parameters in the model, so specifying an initial value that is reasonably close to the resulting value can really help decrease run times for complicated models. As an initial value for the spatial decay parameter <code>phi</code>, we compute the mean distance between points in our coordinates matrix and then set it equal to 3 divided by this mean distance. When using an exponential covariance function, <span class="math inline">\(\frac{3}{\phi}\)</span> is the effective range, or the distance at which the residual spatial correlation between two sites drops to 0.05 <span class="citation">(Banerjee, Carlin, and Gelfand 2003)</span>. Thus our initial guess for this effective range is the average distance between sites across the simulated region. As with all other parameters, we generally recommend using the default initial values for an initial model run, and if the model is taking a very long time to converge you can rerun the model with initial values based on the posterior means of estimated parameters from the initial model fit. For the spatial variance parameter <code>sigma.sq</code>, we set the initial value to 1. This corresponds to a moderate amount of spatial variance. Further, we set the initial values of the latent spatial random effects at each site to 0. The initial values for these random effects has an extremely small influence on the model results, so we generally recommend setting their initial values to 0 as we have done here (this is also the default). However, if you are running your model for a very long time and are seeing very slow convergence of the MCMC chains, setting the initial values of the spatial random effects to the mean estimates from a previous run of the model could help reach convergence faster.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true"></a><span class="co"># Pair-wise distances between all sites</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true"></a>dist.mat &lt;-<span class="st"> </span><span class="kw">dist</span>(data.one.sp<span class="op">$</span>coords)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true"></a><span class="co"># Exponential covariance model</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true"></a>cov.model &lt;-<span class="st"> &#39;exponential&#39;</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true"></a><span class="co"># Specify list of inits</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true"></a>inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">alpha =</span> <span class="dv">0</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true"></a>              <span class="dt">beta =</span> <span class="dv">0</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true"></a>              <span class="dt">kappa =</span> <span class="fl">0.5</span>,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true"></a>          <span class="dt">sigma.sq.mu =</span> <span class="fl">0.5</span>,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true"></a>              <span class="dt">N =</span> <span class="kw">apply</span>(data.one.sp<span class="op">$</span>y, <span class="dv">1</span>, max, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true"></a>              <span class="dt">sigma.sq =</span> <span class="dv">1</span>, </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true"></a>          <span class="dt">phi =</span> <span class="dv">3</span> <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(dist.mat),</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true"></a>          <span class="dt">w =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">nrow</span>(data.one.sp<span class="op">$</span>y)))</span></code></pre></div>
<p>The parameter <code>NNGP</code> is a logical value that specifies whether we want to use an NNGP to fit the model. Currently, only <code>NNGP = TRUE</code> is supported, but we may eventually add functionality to fit full Gaussian Process models. The arguments <code>n.neighbors</code> and <code>search.type</code> specify the number of neighbors used in the NNGP and the nearest neighbor search algorithm, respectively, to use for the NNGP model. Generally, the default values of these arguments will be adequate. <span class="citation">Datta et al. (2016)</span> showed that setting <code>n.neighbors = 15</code> is usually sufficient, although for certain data sets a good approximation can be achieved with as few as five neighbors, which could substantially decrease run time for the model. We generally recommend leaving <code>search.type = &quot;cb&quot;</code>, as this results in a fast code book nearest neighbor search algorithm. However, details on when you may want to change this are described in <span class="citation">Finley, Datta, and Banerjee (2020)</span>. We will run an NNGP model using the default value for <code>search.type</code> and setting <code>n.neighbors = 15</code> (both the defaults).</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true"></a>NNGP &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true"></a>n.neighbors &lt;-<span class="st"> </span><span class="dv">15</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true"></a>search.type &lt;-<span class="st"> &#39;cb&#39;</span></span></code></pre></div>
<p>Priors are again specified in a list in the argument <code>priors</code>. We follow standard recommendations for prior distributions from the spatial statistics literature <span class="citation">(Banerjee, Carlin, and Gelfand 2003)</span>. We assume an inverse gamma prior for the spatial variance parameter <code>sigma.sq</code> (the tag of which is <code>sigma.sq.ig</code>), and uniform priors for the spatial decay parameter <code>phi</code> and smoothness parameter <code>nu</code> (if using the Matern correlation function), with the associated tags <code>phi.unif</code> and <code>nu.unif</code>. The hyperparameters of the inverse Gamma are passed as a vector of length two, with the first and second elements corresponding to the shape and scale, respectively. The lower and upper bounds of the uniform distribution are passed as a two-element vector for the uniform priors. We also allow users to restrict the spatial variance further by specifying a uniform prior (with the tag <code>sigma.sq.unif</code>), which can potentially be useful to place a more informative prior on the spatial parameters. Generally, we use an inverse-Gamma prior.</p>
<p>Note that the priors for the spatial parameters in a spatially-explicit model must be at least weakly informative for the model to converge <span class="citation">(Banerjee, Carlin, and Gelfand 2003)</span>. For the inverse-Gamma prior on the spatial variance, we typically set the shape parameter to 2 and the scale parameter equal to our best guess of the spatial variance. The default prior hyperparameter values for the spatial variance <span class="math inline">\(\sigma^2\)</span> are a shape parameter of 2 and a scale parameter of 1. This weakly informative prior suggests a prior mean of 1 for the spatial variance, which is a moderately small amount of spatial variation. Here we will use this default prior. For the spatial decay parameter, our default approach is to set the lower and upper bounds of the uniform prior based on the minimum and maximum distances between sites in the data. More specifically, by default we set the lower bound to <code>3 / max</code> and the upper bound to <code>3 / min</code>, where <code>min</code> and <code>max</code> are the minimum and maximum distances between sites in the data set, respectively. This equates to a vague prior that states the spatial autocorrelation in the data could only exist between sites that are very close together, or could span across the entire observed study area. If additional information is known on the extent of the spatial autocorrelation in the data, you may place more restrictive bounds on the uniform prior, which would reduce the amount of time needed for adequate mixing and convergence of the MCMC chains. Here we use this default approach, but will explicitly set the values for transparency.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true"></a>min.dist &lt;-<span class="st"> </span><span class="kw">min</span>(dist.mat)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true"></a>max.dist &lt;-<span class="st"> </span><span class="kw">max</span>(dist.mat)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true"></a>priors &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">alpha.normal =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">var =</span> <span class="fl">2.72</span>),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true"></a>               <span class="dt">beta.normal =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">var =</span> <span class="dv">100</span>), </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true"></a>               <span class="dt">kappa.unif =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true"></a>               <span class="dt">sigma.sq.mu.ig =</span> <span class="kw">list</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>), </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true"></a>           <span class="dt">sigma.sq.ig =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true"></a>           <span class="dt">phi.unif =</span> <span class="kw">c</span>(<span class="dv">3</span> <span class="op">/</span><span class="st"> </span>max.dist, <span class="dv">3</span> <span class="op">/</span><span class="st"> </span>min.dist))</span></code></pre></div>
<p>We again split our MCMC algorithm up into a set of batches and use an adaptive sampler to adaptively tune the variances that we propose new values from. We specify the initial tuning values again in the <code>tuning</code> argument, and now need to add <code>phi</code> and <code>w</code> to the parameters that must be tuned. Note that we do not need to add <code>sigma.sq</code>, as this parameter can be sampled with a more efficient approach (i.e., it’s full conditional distribution is available in closed form).</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true"></a>tuning &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">beta =</span> <span class="fl">0.5</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">kappa =</span> <span class="fl">0.5</span>, <span class="dt">beta.star =</span> <span class="fl">0.5</span>, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true"></a>               <span class="dt">w =</span> <span class="fl">0.5</span>, <span class="dt">phi =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p>The argument <code>n.omp.threads</code> specifies the number of threads to use for within-chain parallelization, while <code>verbose</code> specifies whether or not to print the progress of the sampler. As before, the argument <code>n.report</code> specifies the interval to report the Metropolis-Hastings sampler acceptance rate. Below we set <code>n.report = 100</code>, which will result in information on the acceptance rate and tuning parameters every 100th batch.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true"></a>verbose &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true"></a>batch.length &lt;-<span class="st"> </span><span class="dv">25</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true"></a>n.batch &lt;-<span class="st"> </span><span class="dv">800</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true"></a><span class="co"># Total number of MCMC samples per chain</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true"></a>batch.length <span class="op">*</span><span class="st"> </span>n.batch</span></code></pre></div>
<pre><code>[1] 20000</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true"></a>n.report &lt;-<span class="st"> </span><span class="dv">100</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true"></a>n.omp.threads &lt;-<span class="st"> </span><span class="dv">1</span></span></code></pre></div>
<p>We will use the same amount of burn-in and thinning as we did with the non-spatial model, and we’ll also first fit a model with a Poisson distribution for abundance. We next fit the model and summarize the results using the <code>summary()</code> function.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true"></a>n.burn &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true"></a>n.thin &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true"></a>n.chains &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true"></a>out.sp &lt;-<span class="st"> </span><span class="kw">spNMix</span>(<span class="dt">abund.formula =</span> abund.formula, </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true"></a>             <span class="dt">det.formula =</span> det.formula, </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true"></a>             <span class="dt">data =</span> data.one.sp, </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true"></a>             <span class="dt">inits =</span> inits, </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true"></a>             <span class="dt">priors =</span> priors,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true"></a>             <span class="dt">n.batch =</span> n.batch,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true"></a>             <span class="dt">batch.length =</span> batch.length, </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true"></a>             <span class="dt">tuning =</span> tuning, </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true"></a>         <span class="dt">cov.model =</span> cov.model,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true"></a>         <span class="dt">NNGP =</span> NNGP, </span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true"></a>         <span class="dt">n.neighbors =</span> n.neighbors,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true"></a>         <span class="dt">search.type =</span> search.type,</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true"></a>             <span class="dt">n.omp.threads =</span> n.omp.threads,</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true"></a>             <span class="dt">n.report =</span> n.report,</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true"></a>             <span class="dt">family =</span> <span class="st">&#39;Poisson&#39;</span>,</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true"></a>             <span class="dt">verbose =</span> <span class="ot">TRUE</span>,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true"></a>             <span class="dt">n.burn =</span> n.burn,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true"></a>             <span class="dt">n.thin =</span> n.thin, </span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true"></a>             <span class="dt">n.chains =</span> n.chains)</span></code></pre></div>
<pre><code>----------------------------------------
    Preparing to run the model
----------------------------------------
----------------------------------------
    Building the neighbor list
----------------------------------------
----------------------------------------
Building the neighbors of neighbors list
----------------------------------------
----------------------------------------
    Model description
----------------------------------------
Spatial NNGP Poisson N-mixture model with 225 sites.

Samples per Chain: 20000 (800 batches of length 25)
Burn-in: 10000 
Thinning Rate: 10 
Number of Chains: 3 
Total Posterior Samples: 3000 

Using the exponential spatial correlation model.

Using 15 nearest neighbors.

Source compiled with OpenMP support and model fit using 1 thread(s).

Adaptive Metropolis with target acceptance rate: 43.0
----------------------------------------
    Chain 1
----------------------------------------
Sampling ... 
Batch: 100 of 800, 12.50%
    Parameter   Acceptance  Tuning
    beta[1]     44.0        0.28276
    beta[2]     48.0        0.28276
    alpha[1]    36.0        0.36672
    alpha[2]    60.0        0.53625
    alpha[3]    40.0        0.32525
    phi     48.0        0.60462
-------------------------------------------------
Batch: 200 of 800, 25.00%
    Parameter   Acceptance  Tuning
    beta[1]     44.0        0.25079
    beta[2]     44.0        0.25585
    alpha[1]    52.0        0.33853
    alpha[2]    48.0        0.51523
    alpha[3]    40.0        0.33853
    phi     52.0        0.51523
-------------------------------------------------
Batch: 300 of 800, 37.50%
    Parameter   Acceptance  Tuning
    beta[1]     40.0        0.24582
    beta[2]     44.0        0.26102
    alpha[1]    36.0        0.35946
    alpha[2]    56.0        0.52564
    alpha[3]    48.0        0.34537
    phi     48.0        0.53625
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Parameter   Acceptance  Tuning
    beta[1]     28.0        0.23618
    beta[2]     44.0        0.26102
    alpha[1]    48.0        0.35946
    alpha[2]    36.0        0.54709
    alpha[3]    28.0        0.36672
    phi     56.0        0.53625
-------------------------------------------------
Batch: 500 of 800, 62.50%
    Parameter   Acceptance  Tuning
    beta[1]     48.0        0.27168
    beta[2]     44.0        0.24582
    alpha[1]    32.0        0.35234
    alpha[2]    52.0        0.49502
    alpha[3]    32.0        0.35234
    phi     24.0        0.52564
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Parameter   Acceptance  Tuning
    beta[1]     28.0        0.25585
    beta[2]     40.0        0.25585
    alpha[1]    32.0        0.36672
    alpha[2]    48.0        0.52564
    alpha[3]    40.0        0.33853
    phi     56.0        0.60462
-------------------------------------------------
Batch: 700 of 800, 87.50%
    Parameter   Acceptance  Tuning
    beta[1]     48.0        0.26102
    beta[2]     36.0        0.24582
    alpha[1]    56.0        0.35946
    alpha[2]    28.0        0.54709
    alpha[3]    56.0        0.35234
    phi     52.0        0.55814
-------------------------------------------------
Batch: 800 of 800, 100.00%
----------------------------------------
    Chain 2
----------------------------------------
Sampling ... 
Batch: 100 of 800, 12.50%
    Parameter   Acceptance  Tuning
    beta[1]     48.0        0.24582
    beta[2]     12.0        0.26102
    alpha[1]    32.0        0.36672
    alpha[2]    40.0        0.52564
    alpha[3]    48.0        0.35234
    phi     48.0        0.52564
-------------------------------------------------
Batch: 200 of 800, 25.00%
    Parameter   Acceptance  Tuning
    beta[1]     60.0        0.24582
    beta[2]     36.0        0.26630
    alpha[1]    40.0        0.35946
    alpha[2]    64.0        0.54709
    alpha[3]    44.0        0.36672
    phi     32.0        0.56941
-------------------------------------------------
Batch: 300 of 800, 37.50%
    Parameter   Acceptance  Tuning
    beta[1]     32.0        0.25079
    beta[2]     48.0        0.26630
    alpha[1]    48.0        0.36672
    alpha[2]    28.0        0.55814
    alpha[3]    40.0        0.34537
    phi     88.0        0.64201
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Parameter   Acceptance  Tuning
    beta[1]     60.0        0.25585
    beta[2]     28.0        0.26102
    alpha[1]    56.0        0.38169
    alpha[2]    36.0        0.55814
    alpha[3]    40.0        0.35234
    phi     32.0        0.54709
-------------------------------------------------
Batch: 500 of 800, 62.50%
    Parameter   Acceptance  Tuning
    beta[1]     52.0        0.26102
    beta[2]     36.0        0.24582
    alpha[1]    44.0        0.35234
    alpha[2]    40.0        0.52564
    alpha[3]    32.0        0.34537
    phi     24.0        0.54709
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Parameter   Acceptance  Tuning
    beta[1]     28.0        0.24095
    beta[2]     56.0        0.27168
    alpha[1]    44.0        0.35234
    alpha[2]    40.0        0.53625
    alpha[3]    28.0        0.35946
    phi     36.0        0.61684
-------------------------------------------------
Batch: 700 of 800, 87.50%
    Parameter   Acceptance  Tuning
    beta[1]     48.0        0.25079
    beta[2]     48.0        0.25079
    alpha[1]    44.0        0.36672
    alpha[2]    36.0        0.52564
    alpha[3]    52.0        0.36672
    phi     52.0        0.54709
-------------------------------------------------
Batch: 800 of 800, 100.00%
----------------------------------------
    Chain 3
----------------------------------------
Sampling ... 
Batch: 100 of 800, 12.50%
    Parameter   Acceptance  Tuning
    beta[1]     52.0        0.25079
    beta[2]     24.0        0.24095
    alpha[1]    36.0        0.33183
    alpha[2]    44.0        0.53625
    alpha[3]    28.0        0.36672
    phi     68.0        0.54709
-------------------------------------------------
Batch: 200 of 800, 25.00%
    Parameter   Acceptance  Tuning
    beta[1]     36.0        0.23618
    beta[2]     68.0        0.26102
    alpha[1]    44.0        0.34537
    alpha[2]    28.0        0.53625
    alpha[3]    48.0        0.33183
    phi     44.0        0.49502
-------------------------------------------------
Batch: 300 of 800, 37.50%
    Parameter   Acceptance  Tuning
    beta[1]     44.0        0.24095
    beta[2]     28.0        0.25079
    alpha[1]    40.0        0.34537
    alpha[2]    40.0        0.50503
    alpha[3]    32.0        0.33853
    phi     36.0        0.53625
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Parameter   Acceptance  Tuning
    beta[1]     48.0        0.25079
    beta[2]     28.0        0.27716
    alpha[1]    44.0        0.37413
    alpha[2]    48.0        0.53625
    alpha[3]    36.0        0.35234
    phi     36.0        0.52564
-------------------------------------------------
Batch: 500 of 800, 62.50%
    Parameter   Acceptance  Tuning
    beta[1]     32.0        0.24582
    beta[2]     24.0        0.26102
    alpha[1]    40.0        0.34537
    alpha[2]    40.0        0.52564
    alpha[3]    44.0        0.35946
    phi     32.0        0.59265
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Parameter   Acceptance  Tuning
    beta[1]     20.0        0.25079
    beta[2]     36.0        0.27168
    alpha[1]    44.0        0.36672
    alpha[2]    48.0        0.51523
    alpha[3]    52.0        0.37413
    phi     32.0        0.59265
-------------------------------------------------
Batch: 700 of 800, 87.50%
    Parameter   Acceptance  Tuning
    beta[1]     44.0        0.26630
    beta[2]     64.0        0.26630
    alpha[1]    32.0        0.35946
    alpha[2]    32.0        0.51523
    alpha[3]    40.0        0.37413
    phi     32.0        0.56941
-------------------------------------------------
Batch: 800 of 800, 100.00%</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true"></a><span class="kw">summary</span>(out.sp)</span></code></pre></div>
<pre><code>
Call:
spNMix(abund.formula = abund.formula, det.formula = det.formula, 
    data = data.one.sp, inits = inits, priors = priors, tuning = tuning, 
    cov.model = cov.model, NNGP = NNGP, n.neighbors = n.neighbors, 
    search.type = search.type, n.batch = n.batch, batch.length = batch.length, 
    family = &quot;Poisson&quot;, n.omp.threads = n.omp.threads, verbose = TRUE, 
    n.report = n.report, n.burn = n.burn, n.thin = n.thin, n.chains = n.chains)

Samples per Chain: 20000
Burn-in: 10000
Thinning Rate: 10
Number of Chains: 3
Total Posterior Samples: 3000
Run Time (min): 3.8005

Abundance (log scale): 
                      Mean     SD    2.5%     50%   97.5%   Rhat  ESS
(Intercept)        -1.4729 0.3840 -2.3201 -1.4461 -0.7495 1.0685  175
scale(abund.cov.1)  0.0338 0.1342 -0.2283  0.0334  0.3024 1.0014 2017

Abundance Random Effect Variances (log scale): 
                             Mean     SD   2.5%    50%  97.5%   Rhat  ESS
(Intercept)-abund.factor.1 0.4665 0.4817 0.0733 0.3469 1.5379 1.0652 1087

Detection (logit scale): 
                    Mean     SD    2.5%     50%  97.5%   Rhat  ESS
(Intercept)       0.8177 0.2045  0.4346  0.8150 1.2288 1.0020 1316
scale(det.cov.1)  1.9387 0.2540  1.4754  1.9289 2.4718 1.0013 1895
scale(det.cov.2) -0.0339 0.1523 -0.3279 -0.0341 0.2610 1.0009 2406

Spatial Covariance: 
            Mean     SD   2.5%    50%   97.5%   Rhat ESS
sigma.sq  1.2259 0.5106 0.5314 1.1222  2.5052 1.0132 282
phi      11.5513 7.1397 2.9319 9.6549 32.0606 1.0120 188</code></pre>
<p>Looking at the model summary we see adequate convergence of all model parameters. The <code>summary()</code> output looks the same as what we saw previously, with the additional section titled “Spatial Covariance”. There we see the estimate of the spatial variance (<code>sigma.sq</code>) and spatial decay (<code>phi</code>) parameters. The spatial variance is near 1, which indicates substantial spatial variability in abundance across space. Interpretation of the spatial variance parameter can follow interpretation of variance parameters in “regular” (i.e., unstructured) random effect variances: when the variance is close to 0, that indicates little support for inclusion of the spatial random effect. When the variance is large, it indicates substantial support for the spatial random effect. What indicates “large” vs. “small” isn’t necessarily straightforward, but here the estimate is clearly above 1, which is a substantially large variance parameter on the log scale. We can also look at the magnitude of the spatial random effect estimates themselves to give an indication as to how much residual spatial autocorrelation there is in the abundance estimates. The posterior samples for the spatial random effects are stored in the <code>w.samples</code> tag of the resulting model fit list. Here we calculate the means of the spatial random effects and plot a histogram of their values.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true"></a>w.means &lt;-<span class="st"> </span><span class="kw">apply</span>(out.sp<span class="op">$</span>w.samples, <span class="dv">2</span>, mean)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true"></a><span class="kw">hist</span>(w.means)</span></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
<p>We see a fair amount of large magnitude random effect values, both above and below zero. If there was limited support for spatial autocorrelation, these values would all be very close to zero.</p>
</div>
<div id="posterior-predictive-checks-1" class="section level2">
<h2>Posterior predictive checks</h2>
<p>Posterior predictive checks proceed exactly before using the <code>ppcAbund()</code> function.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true"></a>ppc.out.sp &lt;-<span class="st"> </span><span class="kw">ppcAbund</span>(out.sp, <span class="dt">fit.stat =</span> <span class="st">&#39;freeman-tukey&#39;</span>, <span class="dt">group =</span> <span class="dv">1</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true"></a><span class="kw">summary</span>(ppc.out.sp)</span></code></pre></div>
<pre><code>
Call:
ppcAbund(object = out.sp, fit.stat = &quot;freeman-tukey&quot;, group = 1)

Samples per Chain: 20000
Burn-in: 10000
Thinning Rate: 10
Number of Chains: 3
Total Posterior Samples: 3000

Bayesian p-value:  0.5023 
Fit statistic:  freeman-tukey </code></pre>
<p>Here we see a striking contrast to the Bayesian p-value from the non-spatial Poisson N-mixture model, which was essentially 0. Here, our estimate is almost exactly 0.5, indicating our model is adequately representing the variability in the data with the addition of the spatial random effect in abundance. If you take a look at the manual page for <code>dataNMixSim</code>, you can see how we simulated this data set and why the above result makes sense.</p>
</div>
<div id="model-selection-using-waic-1" class="section level2">
<h2>Model selection using WAIC</h2>
<p>We next compare the spatial Poisson N-mixture model to the best performing non-spatial N-mixture model, which used a negative binomial distribution (stored in <code>out.3</code>).</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true"></a><span class="co"># Negative binomial non-spatial model</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true"></a><span class="kw">waicAbund</span>(out<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>N.max not specified. Setting upper index of integration of N to 10 plus
the largest estimated abundance value at each site in object$N.samples</code></pre>
<pre><code>      elpd         pD       WAIC 
-266.01629   11.84066  555.71389 </code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true"></a><span class="co"># Poisson spatial model</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true"></a><span class="kw">waicAbund</span>(out.sp)</span></code></pre></div>
<pre><code>N.max not specified. Setting upper index of integration of N to 10 plus
the largest estimated abundance value at each site in object$N.samples</code></pre>
<pre><code>      elpd         pD       WAIC 
-222.61675   41.59007  528.41364 </code></pre>
<p>Here we see the spatial Poisson model outperforms the negative binomial non-spatial model. Both of these models can be viewed as a “standard” N-mixture model that account for overdispersion in two different ways: the negative binomial model has a parameter <code>kappa</code> that controls the amount of overdispersion, which is not assumed to have any spatial structure, while the spatial Poisson model can be thought of as a Poisson-lognormal model, where the log-normal random effects are assigned a spatial structure. Here, the latter model does a more adequate job of accounting for overdispersion in the latent abundance values. We could also fit a spatial negative binomial model, which essentially includes two mechanisms to account for overdispersion. We leave this to the interested reader to fit this model and see how it compares for this data set. We will note that spatial negative binomial models can often be quite difficult to successfully fit. This is particularly the case when there is no medium to large range spatial autocorrelation in the abundance values. When this is the case, the spatial random effects will be very difficult to identify from the negative binomial overdispersion parameter, and we may seem some unidentifiability occurring between the negative binomial overdispersion parameter and the parameters controlling the spatial dependence. In such a case, a spatial Poisson model or a negative binomial non-spatial model will usually suffice. Alternatively, we could set an informative prior on the spatial range to only allow the spatial random effects to explain long-range (i.e., broad-scale) spatial autocorrelation (if any exists) and let the negative binomial overdispersion parameter account for short-range (i.e., fine-scale) overdispersion. We could then compare that model to simpler versions of the model using WAIC.</p>
</div>
<div id="prediction-1" class="section level2">
<h2>Prediction</h2>
<p>We can similarly predict across a region of interest using the <code>predict()</code> function as we saw with the non-spatial N-mixture model. Here we again generate a marginal effects plot for the effect of the covariate on abundance. When generating a marginal effects plot, we set the <code>include.sp</code> argument to <code>FALSE</code>, which means that we will generate predictions only using the covariates, their effects, and any unstructured random effects included in the model. We only recommend doing this if the goal is to produce a marginal effects plot, as the inclusion of the spatial random effects often drastically improves model predictive performance when interest lies in predicting at new regions. See <code>?predict.spNMix</code> for an example of predicting abundance at a set of new locations.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true"></a><span class="co"># Recall what the prediction design matrix looks like</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true"></a><span class="kw">str</span>(X<span class="fl">.0</span>)</span></code></pre></div>
<pre><code> num [1:100, 1:2] 1 1 1 1 1 1 1 1 1 1 ...
 - attr(*, &quot;dimnames&quot;)=List of 2
  ..$ : NULL
  ..$ : chr [1:2] &quot;intercept&quot; &quot;abund.cov.1&quot;</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true"></a>out.pred &lt;-<span class="st"> </span><span class="kw">predict</span>(out.sp, X<span class="fl">.0</span>, <span class="dt">ignore.RE =</span> <span class="ot">TRUE</span>, <span class="dt">include.sp =</span> <span class="ot">FALSE</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true"></a><span class="kw">str</span>(out.pred)</span></code></pre></div>
<pre><code>List of 3
 $ mu.0.samples: &#39;mcmc&#39; num [1:3000, 1:100] 0.244 0.152 0.169 0.253 0.21 ...
  ..- attr(*, &quot;mcpar&quot;)= num [1:3] 1 3000 1
 $ N.0.samples : &#39;mcmc&#39; int [1:3000, 1:100] 0 0 0 0 2 1 2 0 0 0 ...
  ..- attr(*, &quot;mcpar&quot;)= num [1:3] 1 3000 1
 $ call        : language predict.spNMix(object = out.sp, X.0 = X.0, ignore.RE = TRUE, include.sp = FALSE)
 - attr(*, &quot;class&quot;)= chr &quot;predict.spNMix&quot;</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true"></a><span class="co"># Get the lower bound, median, and 95% credible interval</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true"></a>mu.<span class="fl">0.</span>quants &lt;-<span class="st"> </span><span class="kw">apply</span>(out.pred<span class="op">$</span>mu.<span class="fl">0.</span>samples, <span class="dv">2</span>, quantile,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true"></a>                          <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true"></a>mu.plot.dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">mu.med =</span> mu.<span class="fl">0.</span>quants[<span class="dv">2</span>, ],</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true"></a>                                 <span class="dt">mu.low =</span> mu.<span class="fl">0.</span>quants[<span class="dv">1</span>, ],</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true"></a>                                 <span class="dt">mu.high =</span> mu.<span class="fl">0.</span>quants[<span class="dv">3</span>, ],</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true"></a>                          <span class="dt">abund.cov.1 =</span> cov.pred.vals)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true"></a><span class="kw">ggplot</span>(mu.plot.dat, <span class="kw">aes</span>(<span class="dt">x =</span> abund.cov<span class="fl">.1</span>, <span class="dt">y =</span> mu.med)) <span class="op">+</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> mu.low, <span class="dt">ymax =</span> mu.high), <span class="dt">fill =</span> <span class="st">&#39;grey70&#39;</span>) <span class="op">+</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Covariate&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;Expected abundance&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="multi-species-n-mixture-models" class="section level1">
<h1>Multi-species N-mixture models</h1>
<div id="basic-model-description-2" class="section level2">
<h2>Basic model description</h2>
<p>Now consider the case where repeated count data, <span class="math inline">\(y_{i, j, k}\)</span>, are collected for multiple species <span class="math inline">\(i = 1, \dots, I\)</span> at each survey location <span class="math inline">\(j\)</span> during survey <span class="math inline">\(k\)</span>. We are now interested in estimating the abundance of each species <span class="math inline">\(i\)</span> at each location <span class="math inline">\(j\)</span>, denoted as <span class="math inline">\(N_{i, j}\)</span>. We model <span class="math inline">\(N_{i, j}\)</span> analogous to the single-species N-mixture model, with expected abundance now varying by species and site according to</p>
<p><span class="math display">\[\begin{equation}\label{mu-msNMix}
     \text{log}(\mu_{i, j}) = \textbf{x}_j)^\top\boldsymbol{\beta}_i,
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{\beta}_i\)</span> are the species-specific effects of covariates <span class="math inline">\(\textbf{x}_j\)</span> (including an intercept) . When <span class="math inline">\(N_i(\boldsymbol{s}_j)\)</span> is modeled using a negative binomial distribution, we estimate a separate dispersion parameter <span class="math inline">\(\kappa_i\)</span> for each species. We model <span class="math inline">\(\boldsymbol{\beta}_i\)</span> as random effects arising from a common, community-level normal distribution, which leads to increased precision of species-specific effects compared to single-species models <span class="citation">(Yamaura et al. 2012)</span>. For example, the species-specific abundance intercept <span class="math inline">\(\beta0_i\)</span> is modeled according to</p>
<p><span class="math display">\[\begin{equation}\label{betaComm}
     \beta0_i \sim \text{Normal}(\mu_{\beta0}, \tau^2_{\beta0}),
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\mu_{\beta0}\)</span> is the community-level abundance intercept, and <span class="math inline">\(\tau^2_{\beta0}\)</span> is the variance of the intercept across all <span class="math inline">\(I\)</span> species. The observation portion of the multi-species N-mixture model is identical to the single-species model, with all parameters indexed by species, and the species-specific coefficients <span class="math inline">\(\boldsymbol{\alpha}_i\)</span> are modeled hierarchically, analogous to the species-specific abundance coefficients just described.</p>
<p>We assign normal priors to the community-level abundance (<span class="math inline">\(\boldsymbol{\mu}_{\beta}\)</span>) and detection (<span class="math inline">\(\boldsymbol{\mu}_{\alpha}\)</span>) mean parameters and inverse-Gamma priors to the community-level variance parameters (<span class="math inline">\(\boldsymbol{\tau^2}_{\beta}\)</span> and <span class="math inline">\(\boldsymbol{\tau^2}_{\alpha}\)</span>).</p>
</div>
<div id="fitting-multi-species-n-mixture-models-with-msnmix" class="section level2">
<h2>Fitting multi-species N-mixture models with <code>msNMix()</code></h2>
<p><code>spAbundance</code> uses nearly identical syntax for fitting multi-species N-mixture models as it does for single-species models and provides the same functionality for posterior predictive checks, model assessment and selection using WAIC, and prediction. The <code>msNMix()</code> function fits the multi-species N-mixture model first introduced by <span class="citation">Yamaura et al. (2012)</span>. <code>msNMix()</code> has the following syntax</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true"></a><span class="kw">msNMix</span>(abund.formula, det.formula, data, inits, priors,  </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true"></a>       tuning, n.batch, batch.length, <span class="dt">accept.rate =</span> <span class="fl">0.43</span>, </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true"></a>       <span class="dt">family =</span> <span class="st">&#39;Poisson&#39;</span>, <span class="dt">n.omp.threads =</span> <span class="dv">1</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>, <span class="dt">n.report =</span> <span class="dv">100</span>, </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true"></a>       <span class="dt">n.burn =</span> <span class="kw">round</span>(.<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>n.samples), <span class="dt">n.thin =</span> <span class="dv">1</span>, </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true"></a>       <span class="dt">n.chains =</span> <span class="dv">1</span>, ...)</span></code></pre></div>
<p>Notice these are the exact same arguments we saw with <code>NMix()</code>. We will again use our simulated data set contained in <code>dataNMixSim</code>, but now we will use data from all 6 species in the simulated community. Below we reload the <code>dataNMixSim</code> data set to get a fresh copy.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true"></a><span class="kw">data</span>(dataNMixSim)</span></code></pre></div>
<p>We will model abundance for all species as a function of the continuous covariate and a random effect of the categorical variable, as well as the two continuous covariates for detection probability. For multi-species models, the multi-species detection-nondetection data <code>y</code> is now a three-dimensional array with dimensions corresponding to species, sites, and replicates. This is how the data are provided in the <code>dataNMixSim</code> object, so we don’t need to do any additional preparations. For guidance on preparing raw data into such a three-dimensional array format, please see <a href="https://www.jeffdoser.com/files/spoccupancy-web/articles/dataformatting">this vignette on the <code>spOccupancy</code> website</a>, which while providing guidance for fitting multi-species models in <code>spOccupancy</code>, the format for <code>spAbundance</code> is exactly the same and all the same guidance applies here.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true"></a>abund.ms.formula &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw">scale</span>(abund.cov<span class="fl">.1</span>) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>abund.factor<span class="fl">.1</span>) </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true"></a>det.ms.formula &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw">scale</span>(det.cov<span class="fl">.1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale</span>(det.cov<span class="fl">.2</span>) </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true"></a><span class="kw">str</span>(dataNMixSim)</span></code></pre></div>
<pre><code>List of 4
 $ y         : int [1:6, 1:225, 1:5] 0 0 1 0 0 0 0 0 0 0 ...
 $ abund.covs: num [1:225, 1:2] 0.2863 -0.0325 -0.9897 0.2118 -0.972 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : NULL
  .. ..$ : chr [1:2] &quot;abund.cov.1&quot; &quot;abund.factor.1&quot;
 $ det.covs  :List of 2
  ..$ det.cov.1: num [1:225, 1:5] 1.577 0.6956 -0.3031 0.107 0.0284 ...
  ..$ det.cov.2: num [1:225, 1:5] -1.235 -0.509 -2.012 -0.899 0.38 ...
 $ coords    : num [1:225, 1:2] 0 0.0714 0.1429 0.2143 0.2857 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : NULL
  .. ..$ : chr [1:2] &quot;X&quot; &quot;Y&quot;</code></pre>
<p>Next we specify the initial values in <code>inits</code>. For multi-species N-mixture models, we supply initial values for community-level and species-level parameters. In <code>msNMix()</code>, we will supply initial values for the following parameters: <code>alpha.comm</code> (community-level detection coefficients), <code>beta.comm</code> (community-level abundance coefficients), <code>alpha</code> (species-level detection coefficients), <code>beta</code> (species-level abundance coefficients), <code>tau.sq.beta</code> (community-level abundance variance parameters), <code>tau.sq.alpha</code> (community-level detection variance parameters), <code>N</code> (latent abundance variables for all species), <code>kappa</code> (species-level negative binomial overdispersion parameters), <code>sigma.sq.mu</code> (random effect variances for abundance), and <code>sigma.sq.p</code> (random effect variances for detection). These are all specified in a single list. Initial values for community-level parameters (including the random effect variances) are either vectors of length corresponding to the number of community-level detection or occurrence parameters in the model (including the intercepts) or a single value if all parameters are assigned the same initial values. Initial values for species level parameters are either matrices with the number of rows indicating the number of species, and each column corresponding to a different regression parameter, or a single value if the same initial value is used for all species and parameters. The initial values for the latent abundance matrix are specified as a matrix with <span class="math inline">\(I\)</span> rows corresponding to the number of species and <span class="math inline">\(J\)</span> columns corresponding to the number of sites.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true"></a><span class="co"># Number of species</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true"></a>n.sp &lt;-<span class="st"> </span><span class="kw">dim</span>(dataNMixSim<span class="op">$</span>y)[<span class="dv">1</span>]</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true"></a>ms.inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">alpha.comm =</span> <span class="dv">0</span>,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true"></a>                 <span class="dt">beta.comm =</span> <span class="dv">0</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true"></a>                 <span class="dt">beta =</span> <span class="dv">0</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true"></a>                 <span class="dt">alpha =</span> <span class="dv">0</span>,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true"></a>                 <span class="dt">tau.sq.beta =</span> <span class="dv">1</span>,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true"></a>         <span class="dt">kappa =</span> <span class="dv">1</span>,</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true"></a>                 <span class="dt">tau.sq.alpha =</span> <span class="dv">1</span>,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true"></a>         <span class="dt">sigma.sq.mu =</span> <span class="fl">0.5</span>,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true"></a>                 <span class="dt">N =</span> <span class="kw">apply</span>(dataNMixSim<span class="op">$</span>y, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), max, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<p>In multi-species models, we specify priors on the community-level coefficients (or hyperparameters) rather than the species-level effects, with the exception that we still assign uniform priors for the negative binomial overdispersion parameter. For nonspatial models, these priors are specified with the following tags: <code>beta.comm.normal</code> (normal prior on the community-level abundance mean effects), <code>alpha.comm.normal</code> (normal prior on the community-level detection mean effects), <code>tau.sq.beta.ig</code> (inverse-Gamma prior on the community-level abundance variance parameters), <code>tau.sq.alpha.ig</code> (inverse-Gamma prior on the community-level detection variance parameters), <code>sigma.sq.mu.ig</code> (inverse-Gamma prior on the abundance random effect variances), <code>sigma.sq.p.ig</code> (inverse-Gamma prior on the detection random effect variances), <code>kappa.unif</code> (uniform prior on the species-specific overdispersion parameters). For all parameters except the species-specific overdispersion parameters, each tag consists of a list with elements corresponding to the mean and variance for normal priors and scale and shape for inverse-Gamma priors. Values can be specified individually for each parameter or as a single value if the same prior is assigned to all parameters of a given type. For the species-specific overdispersion parameters, the prior is specified as a list with two elements representing the lower and upper bound of the uniform distribution, where each of the elements can be a single value if the same prior is used for all species, or a vector of values for each species if specifying a different prior for each species.</p>
<p>By default, we set the prior hyperparameter values for the community-level means to a mean of 0 and a variance of 100 for abundance and 2.72 for detection, which results in a vague prior on the probability scale as we discussed for the single-species N-mixture model. Below we specify these priors explicitly. For the community-level variance parameters, by default we set the scale and shape parameters to 0.1 following the recommendations of <span class="citation">(Lunn et al. 2013)</span>, which results in a weakly informative prior on the community-level variances. This may lead to shrinkage of the community-level variance towards zero under certain circumstances so that all species will have fairly similar values for the species-specific covariate effect <span class="citation">(Gelman 2006)</span>, although we have found multi-species models to be relatively robust to this prior specification. We are in the process of implementing half-Cauchy and half-t priors for the variance parameters in all multi-species models in <code>spAbundance</code> (and <code>spOccupancy</code>), which generally result in less shrinkage toward zero than the inverse-Gamma <span class="citation">(Gelman 2006)</span>. For the negative binomial overdispersion parameters, we by default use a lower bound of 0 and upper bound of 100 for the uniform priors for each species, as we did in the single-species (univariate) models. Below we explicitly set these default prior values for our example.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true"></a>ms.priors &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">beta.comm.normal =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">var =</span> <span class="dv">100</span>),</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true"></a>                  <span class="dt">alpha.comm.normal =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">var =</span> <span class="fl">2.72</span>),</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true"></a>                  <span class="dt">tau.sq.beta.ig =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="fl">0.1</span>, <span class="dt">b =</span> <span class="fl">0.1</span>),</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true"></a>                  <span class="dt">tau.sq.alpha.ig =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="fl">0.1</span>, <span class="dt">b =</span> <span class="fl">0.1</span>), </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true"></a>          <span class="dt">sigma.sq.mu.ig =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="fl">0.1</span>, <span class="dt">b =</span> <span class="fl">0.1</span>),</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true"></a>                  <span class="dt">kappa.unif =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">0</span>, <span class="dt">b =</span> <span class="dv">100</span>))</span></code></pre></div>
<p>All that’s now left to do is specify the number of threads to use (<code>n.omp.threads</code>), the number of MCMC samples (which we do by specifying the number of batches <code>n.batch</code> and batch length <code>batch.length</code>), the initial tuning variances (<code>tuning</code>), the amount of samples to discard as burn-in (<code>n.burn</code>), the thinning rate (<code>n.thin</code>), and arguments to control the display of sampler progress (<code>verbose</code>, <code>n.report</code>). Note for the tuning variances, we do not need to specify initial tuning values for any of the community-level parameters, as those parameters can be sampled with an efficient Gibbs update. We will also run the model with a Poisson distribution for abundance, which later we will shortly compare to a negative binomial.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true"></a><span class="co"># Specify initial tuning values</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true"></a>ms.tuning &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">beta =</span> <span class="fl">0.3</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">beta.star =</span> <span class="fl">0.5</span>, <span class="dt">kappa =</span> <span class="fl">0.5</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true"></a><span class="co"># Approx. run time:  2.5 min</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true"></a>out.ms &lt;-<span class="st"> </span><span class="kw">msNMix</span>(<span class="dt">abund.formula =</span> abund.ms.formula,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true"></a>                  <span class="dt">det.formula =</span> det.ms.formula,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true"></a>                  <span class="dt">data =</span> dataNMixSim,</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true"></a>                  <span class="dt">inits =</span> ms.inits,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true"></a>          <span class="dt">n.batch =</span> <span class="dv">800</span>,</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true"></a>          <span class="dt">tuning =</span> ms.tuning,</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true"></a>          <span class="dt">batch.length =</span> <span class="dv">25</span>,</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true"></a>                  <span class="dt">priors =</span> ms.priors,</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true"></a>                  <span class="dt">n.omp.threads =</span> <span class="dv">1</span>,</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true"></a>                  <span class="dt">verbose =</span> <span class="ot">TRUE</span>,</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true"></a>                  <span class="dt">n.report =</span> <span class="dv">200</span>,</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true"></a>                  <span class="dt">n.burn =</span> <span class="dv">10000</span>,</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true"></a>                  <span class="dt">n.thin =</span> <span class="dv">10</span>,</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true"></a>                  <span class="dt">n.chains =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>----------------------------------------
    Preparing to run the model
----------------------------------------
----------------------------------------
    Model description
----------------------------------------
Multi-species Poisson N-Mixture model fit with 225 sites and 6 species.

Samples per Chain: 20000 
Burn-in: 10000 
Thinning Rate: 10 
Number of Chains: 3 
Total Posterior Samples: 3000 

Source compiled with OpenMP support and model fit using 1 thread(s).

Adaptive Metropolis with target acceptance rate: 43.0
----------------------------------------
    Chain 1
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     40.0        0.23364
    1   alpha[1]    28.0        0.36277
    2   beta[1]     44.0        0.21141
    2   alpha[1]    40.0        0.36277
    3   beta[1]     24.0        0.23836
    3   alpha[1]    32.0        0.36277
    4   beta[1]     36.0        0.15661
    4   alpha[1]    44.0        0.21568
    5   beta[1]     32.0        0.17658
    5   alpha[1]    32.0        0.27972
    6   beta[1]     36.0        0.16630
    6   alpha[1]    52.0        0.26343
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     44.0        0.25821
    1   alpha[1]    36.0        0.34855
    2   beta[1]     36.0        0.21141
    2   alpha[1]    36.0        0.39299
    3   beta[1]     44.0        0.26875
    3   alpha[1]    36.0        0.37758
    4   beta[1]     60.0        0.15351
    4   alpha[1]    40.0        0.18379
    5   beta[1]     20.0        0.19910
    5   alpha[1]    48.0        0.25310
    6   beta[1]     48.0        0.15978
    6   alpha[1]    36.0        0.23836
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     52.0        0.25310
    1   alpha[1]    48.0        0.34855
    2   beta[1]     48.0        0.22448
    2   alpha[1]    56.0        0.33488
    3   beta[1]     56.0        0.25821
    3   alpha[1]    36.0        0.37758
    4   beta[1]     40.0        0.15661
    4   alpha[1]    48.0        0.21141
    5   beta[1]     40.0        0.19910
    5   alpha[1]    56.0        0.27418
    6   beta[1]     40.0        0.15978
    6   alpha[1]    56.0        0.27418
-------------------------------------------------
Batch: 800 of 800, 100.00%
----------------------------------------
    Chain 2
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     44.0        0.24809
    1   alpha[1]    44.0        0.34165
    2   beta[1]     48.0        0.23836
    2   alpha[1]    40.0        0.36277
    3   beta[1]     48.0        0.25821
    3   alpha[1]    48.0        0.34165
    4   beta[1]     56.0        0.17658
    4   alpha[1]    28.0        0.21141
    5   beta[1]     28.0        0.20312
    5   alpha[1]    40.0        0.24809
    6   beta[1]     44.0        0.15351
    6   alpha[1]    64.0        0.27418
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     52.0        0.22901
    1   alpha[1]    28.0        0.36277
    2   beta[1]     44.0        0.22901
    2   alpha[1]    48.0        0.37010
    3   beta[1]     40.0        0.25821
    3   alpha[1]    24.0        0.39299
    4   beta[1]     48.0        0.15661
    4   alpha[1]    48.0        0.22003
    5   beta[1]     48.0        0.18750
    5   alpha[1]    52.0        0.26343
    6   beta[1]     36.0        0.16301
    6   alpha[1]    52.0        0.25310
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     44.0        0.24809
    1   alpha[1]    56.0        0.34855
    2   beta[1]     24.0        0.21568
    2   alpha[1]    36.0        0.36277
    3   beta[1]     40.0        0.25821
    3   alpha[1]    36.0        0.40093
    4   beta[1]     44.0        0.16301
    4   alpha[1]    28.0        0.21568
    5   beta[1]     28.0        0.18379
    5   alpha[1]    36.0        0.26875
    6   beta[1]     32.0        0.15661
    6   alpha[1]    52.0        0.24809
-------------------------------------------------
Batch: 800 of 800, 100.00%
----------------------------------------
    Chain 3
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     24.0        0.23364
    1   alpha[1]    64.0        0.35559
    2   beta[1]     36.0        0.21141
    2   alpha[1]    32.0        0.37010
    3   beta[1]     28.0        0.25821
    3   alpha[1]    44.0        0.36277
    4   beta[1]     40.0        0.13890
    4   alpha[1]    36.0        0.21568
    5   beta[1]     28.0        0.18015
    5   alpha[1]    40.0        0.27418
    6   beta[1]     36.0        0.15661
    6   alpha[1]    60.0        0.26875
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     40.0        0.24318
    1   alpha[1]    56.0        0.34165
    2   beta[1]     44.0        0.23836
    2   alpha[1]    40.0        0.36277
    3   beta[1]     20.0        0.26875
    3   alpha[1]    40.0        0.34855
    4   beta[1]     48.0        0.15661
    4   alpha[1]    44.0        0.22003
    5   beta[1]     24.0        0.19515
    5   alpha[1]    32.0        0.25310
    6   beta[1]     44.0        0.16966
    6   alpha[1]    56.0        0.25821
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     44.0        0.24809
    1   alpha[1]    56.0        0.37010
    2   beta[1]     36.0        0.23364
    2   alpha[1]    48.0        0.38521
    3   beta[1]     36.0        0.25310
    3   alpha[1]    32.0        0.35559
    4   beta[1]     36.0        0.15661
    4   alpha[1]    48.0        0.20722
    5   beta[1]     28.0        0.19129
    5   alpha[1]    48.0        0.27418
    6   beta[1]     44.0        0.16630
    6   alpha[1]    40.0        0.23364
-------------------------------------------------
Batch: 800 of 800, 100.00%</code></pre>
<p>The resulting object <code>out.ms</code> is a list of class <code>msNMix</code> consisting primarily of posterior samples of all community and species-level parameters, as well as some additional objects that are used for summaries, prediction, and model fit evaluation. We can display a nice summary of these results using the <code>summary()</code> function as before. For multi-species objects, when using summary we need to specify the level of parameters we want to summarize. We do this using the argument <code>level</code>, which takes values <code>community</code>, <code>species</code>, or <code>both</code> to print results for community-level parameters, species-level parameters, or all parameters. By default, <code>level</code> is set to <code>both</code> to display both species and community-level parameters.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true"></a><span class="kw">summary</span>(out.ms)</span></code></pre></div>
<pre><code>
Call:
msNMix(abund.formula = abund.ms.formula, det.formula = det.ms.formula, 
    data = dataNMixSim, inits = ms.inits, priors = ms.priors, 
    tuning = ms.tuning, n.batch = 800, batch.length = 25, n.omp.threads = 1, 
    verbose = TRUE, n.report = 200, n.burn = 10000, n.thin = 10, 
    n.chains = 3)

Samples per Chain: 20000
Burn-in: 10000
Thinning Rate: 10
Number of Chains: 3
Total Posterior Samples: 3000
Run Time (min): 2.5109

----------------------------------------
    Community Level
----------------------------------------
Abundance Means (log scale): 
                      Mean     SD    2.5%     50%   97.5%   Rhat  ESS
(Intercept)        -0.7179 0.2199 -1.1562 -0.7152 -0.2872 1.0085  694
scale(abund.cov.1)  0.0090 0.3608 -0.6899  0.0156  0.7153 1.0002 2701

Abundance Variances (log scale): 
                     Mean     SD   2.5%    50%  97.5%   Rhat  ESS
(Intercept)        0.2334 0.5476 0.0358 0.1417 0.9582 1.1671 2795
scale(abund.cov.1) 0.7206 0.8858 0.1631 0.4868 2.5665 1.0018 3000

Abundance Random Effect Variances (log scale): 
                             Mean     SD   2.5%    50%  97.5%   Rhat  ESS
(Intercept)-abund.factor.1 0.5014 0.1391 0.2946 0.4806 0.8308 1.0147 1236

Detection Means (logit scale): 
                    Mean     SD    2.5%     50%  97.5%   Rhat  ESS
(Intercept)      -0.0134 0.3775 -0.7811 -0.0119 0.7436 1.0004 3000
scale(det.cov.1)  0.4535 0.4354 -0.4199  0.4541 1.3503 1.0000 3000
scale(det.cov.2)  1.1125 0.4728  0.0809  1.1289 2.0038 1.0015 3202
Detection Variances (logit scale): 
                   Mean     SD   2.5%    50%  97.5%   Rhat  ESS
(Intercept)      0.9154 1.1383 0.1936 0.6319 3.3778 1.0305 2746
scale(det.cov.1) 1.2411 1.5741 0.2767 0.8599 4.3580 1.0669 2786
scale(det.cov.2) 1.5211 1.7935 0.3424 1.0577 5.5056 1.0218 3000

----------------------------------------
    Species Level
----------------------------------------
Abundance (log scale): 
                          Mean     SD    2.5%     50%   97.5%   Rhat  ESS
(Intercept)-sp1        -0.9125 0.2257 -1.3736 -0.9059 -0.5121 1.0012  482
(Intercept)-sp2        -0.7233 0.2181 -1.1702 -0.7212 -0.3077 1.0188  615
(Intercept)-sp3        -1.0523 0.2387 -1.5351 -1.0489 -0.6086 1.0012  659
(Intercept)-sp4        -0.4486 0.2254 -0.9047 -0.4486 -0.0146 1.0227  326
(Intercept)-sp5        -0.6282 0.2254 -1.0602 -0.6313 -0.1750 1.0101  350
(Intercept)-sp6        -0.5265 0.2166 -0.9514 -0.5265 -0.1094 1.0295  312
scale(abund.cov.1)-sp1  0.1049 0.1080 -0.0985  0.1022  0.3184 1.0042 3058
scale(abund.cov.1)-sp2  0.4822 0.1096  0.2642  0.4811  0.6972 0.9999 2075
scale(abund.cov.1)-sp3  0.2796 0.1381  0.0125  0.2779  0.5532 1.0038 1674
scale(abund.cov.1)-sp4  0.6950 0.0892  0.5218  0.6960  0.8712 1.0109 1365
scale(abund.cov.1)-sp5 -0.5271 0.1113 -0.7541 -0.5249 -0.3132 1.0016 1263
scale(abund.cov.1)-sp6 -0.9499 0.0657 -1.0779 -0.9504 -0.8207 1.0000 1551

Detection (logit scale): 
                        Mean     SD    2.5%     50%   97.5%   Rhat  ESS
(Intercept)-sp1       0.8601 0.1920  0.4970  0.8572  1.2408 1.0039 1562
(Intercept)-sp2       0.2491 0.1731 -0.0984  0.2510  0.5820 1.0101 1874
(Intercept)-sp3      -0.5484 0.2071 -0.9646 -0.5428 -0.1471 1.0090 1132
(Intercept)-sp4      -0.3331 0.1379 -0.6199 -0.3271 -0.0740 1.0111  621
(Intercept)-sp5      -0.9548 0.1977 -1.3647 -0.9485 -0.6040 1.0139  398
(Intercept)-sp6       0.6819 0.1365  0.4187  0.6805  0.9519 0.9998 1451
scale(det.cov.1)-sp1  1.8886 0.2397  1.4351  1.8843  2.3909 1.0007 2536
scale(det.cov.1)-sp2  0.2998 0.1766 -0.0483  0.2958  0.6466 0.9999 2175
scale(det.cov.1)-sp3  1.1298 0.2098  0.7477  1.1203  1.5710 1.0047 1930
scale(det.cov.1)-sp4 -0.0420 0.0850 -0.2079 -0.0416  0.1233 1.0098 2547
scale(det.cov.1)-sp5  0.1052 0.1133 -0.1135  0.1050  0.3289 1.0022 2188
scale(det.cov.1)-sp6 -0.4398 0.1246 -0.6879 -0.4388 -0.2014 1.0011 2272
scale(det.cov.2)-sp1  0.0163 0.1495 -0.2752  0.0144  0.3045 1.0155 2327
scale(det.cov.2)-sp2  2.5866 0.2904  2.0676  2.5730  3.1818 1.0055 2279
scale(det.cov.2)-sp3  0.6704 0.1776  0.3283  0.6677  1.0215 1.0013 2039
scale(det.cov.2)-sp4  1.0007 0.1079  0.7918  0.9994  1.2136 1.0008 1654
scale(det.cov.2)-sp5  0.8824 0.1342  0.6298  0.8799  1.1574 1.0034 1971
scale(det.cov.2)-sp6  2.1544 0.1752  1.8281  2.1483  2.5076 1.0011 1918</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true"></a><span class="co"># Or more explicitly</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true"></a><span class="co"># summary(out.ms, level = &#39;both&#39;)</span></span></code></pre></div>
<p>We see adequate convergence and mixing of all model parameters, with ESS values fairly large and Rhat values less (or very close to) 1.1. Looking at the community-level variance parameters, we can see there is fairly minimal variation among average abundance of each species (i.e., the intercept), with larger variable in the effect of the covariate on abundance, which is further seen by looking at the species-specific effects of the covariate, which range from highly positive to highly negative.</p>
</div>
<div id="posterior-predictive-checks-2" class="section level2">
<h2>Posterior predictive checks</h2>
<p>As with single-species models, we can use the <code>ppcAbund()</code> function to perform posterior predictive checks, and summarize the check with a Bayesian p-value using the <code>summary()</code> function. The <code>summary()</code> function again requires the <code>level</code> argument to specify if you want an overall Bayesian p-value for the entire community (<code>level = &#39;community&#39;</code>), each individual species (<code>level = &#39;species&#39;</code>), or for both (<code>level = &#39;both&#39;</code>). By default, we set `level = ‘both’. This time, we use a chi-squared test statistic, grouping the data by replicates (again, we just do this to display the different ways of performing posterior predictive checks, and for a full analysis we would explore multiple fit statistics and ways of grouping the data).</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true"></a>ppc.ms.out &lt;-<span class="st"> </span><span class="kw">ppcAbund</span>(out.ms, <span class="dt">fit.stat =</span> <span class="st">&#39;chi-squared&#39;</span>, <span class="dt">group =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>Currently on species 1 out of 6</code></pre>
<pre><code>Currently on species 2 out of 6</code></pre>
<pre><code>Currently on species 3 out of 6</code></pre>
<pre><code>Currently on species 4 out of 6</code></pre>
<pre><code>Currently on species 5 out of 6</code></pre>
<pre><code>Currently on species 6 out of 6</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true"></a><span class="kw">summary</span>(ppc.ms.out)</span></code></pre></div>
<pre><code>
Call:
ppcAbund(object = out.ms, fit.stat = &quot;chi-squared&quot;, group = 2)

Samples per Chain: 20000
Burn-in: 10000
Thinning Rate: 10
Number of Chains: 3
Total Posterior Samples: 3000

----------------------------------------
    Community Level
----------------------------------------
Bayesian p-value:  0.4283 

----------------------------------------
    Species Level
----------------------------------------
sp1 Bayesian p-value: 0.0887
sp2 Bayesian p-value: 0.6973
sp3 Bayesian p-value: 0.6973
sp4 Bayesian p-value: 0.1263
sp5 Bayesian p-value: 0.4163
sp6 Bayesian p-value: 0.544
Fit statistic:  chi-squared </code></pre>
<p>Here we see mixed results of the posterior predictive check, with the first and fourth species having a fairly small Bayesian p-value, suggesting the model does not fit very well for those species, which as with the single-species case, is likely related to additional spatial variation in abundance that we are not accounting for.</p>
</div>
<div id="model-selection-using-waic-2" class="section level2">
<h2>Model selection using WAIC</h2>
<p>We can compute the WAIC for comparison with alternative models using the <code>waicAbund()</code> function. For multi-species models, we can calculate the WAIC for the entire data set, or we can calculate it separately for each species. This is done by using the logical <code>by.sp</code> argument. Note that the WAIC for the entire data set is simply the sum of all the WAIC values for the individual responses. Below we calculate the WAIC by species for the multi-species model and compare the WAIC for species 1 to the corresponding WAIC for the non-spatial single-species model we fit for that species.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true"></a><span class="co"># Multi-species Poisson N-mixture model</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true"></a><span class="kw">waicAbund</span>(out.ms, <span class="dt">by.sp =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>N.max not specified. Setting upper index of integration of N to 10 plus
the largest estimated abundance value at each site in object$N.samples</code></pre>
<pre><code>Currently on species 1 out of 6</code></pre>
<pre><code>Currently on species 2 out of 6</code></pre>
<pre><code>Currently on species 3 out of 6</code></pre>
<pre><code>Currently on species 4 out of 6</code></pre>
<pre><code>Currently on species 5 out of 6</code></pre>
<pre><code>Currently on species 6 out of 6</code></pre>
<pre><code>       elpd       pD     WAIC
1 -273.8085 16.23702 580.0911
2 -282.7745 20.90850 607.3660
3 -216.6119 13.34573 459.9153
4 -433.5625 10.35532 887.8356
5 -300.7362 11.48360 624.4396
6 -362.0260 10.38845 744.8290</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true"></a><span class="co"># Single-species Poisson N-mixture model for species 1</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true"></a><span class="kw">waicAbund</span>(out)</span></code></pre></div>
<pre><code>N.max not specified. Setting upper index of integration of N to 10 plus
the largest estimated abundance value at each site in object$N.samples</code></pre>
<pre><code>      elpd         pD       WAIC 
-273.35113   17.14231  580.98690 </code></pre>
<p>Here we see nearly identical WAIC values for species 1 across a single-species model vs. a multi-species model. Next, we fit a multi-species negative binomial N-mixture model for comparison with the Poisson multi-species model</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true"></a><span class="co"># Approx. run time:  2.7 min</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true"></a>out.ms.nb &lt;-<span class="st"> </span><span class="kw">msNMix</span>(<span class="dt">abund.formula =</span> abund.ms.formula,</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true"></a>                  <span class="dt">det.formula =</span> det.ms.formula,</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true"></a>                  <span class="dt">data =</span> dataNMixSim,</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true"></a>                  <span class="dt">inits =</span> ms.inits,</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true"></a>          <span class="dt">n.batch =</span> <span class="dv">800</span>,</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true"></a>          <span class="dt">tuning =</span> ms.tuning,</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true"></a>          <span class="dt">batch.length =</span> <span class="dv">25</span>,</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true"></a>                  <span class="dt">priors =</span> ms.priors,</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true"></a>                  <span class="dt">n.omp.threads =</span> <span class="dv">1</span>,</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true"></a>                  <span class="dt">verbose =</span> <span class="ot">TRUE</span>,</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true"></a>          <span class="dt">family =</span> <span class="st">&#39;NB&#39;</span>,</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true"></a>                  <span class="dt">n.report =</span> <span class="dv">200</span>,</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true"></a>                  <span class="dt">n.burn =</span> <span class="dv">10000</span>,</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true"></a>                  <span class="dt">n.thin =</span> <span class="dv">10</span>,</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true"></a>                  <span class="dt">n.chains =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>----------------------------------------
    Preparing to run the model
----------------------------------------
----------------------------------------
    Model description
----------------------------------------
Multi-species Negative Binomial N-Mixture model fit with 225 sites and 6 species.

Samples per Chain: 20000 
Burn-in: 10000 
Thinning Rate: 10 
Number of Chains: 3 
Total Posterior Samples: 3000 

Source compiled with OpenMP support and model fit using 1 thread(s).

Adaptive Metropolis with target acceptance rate: 43.0
----------------------------------------
    Chain 1
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     44.0        0.33488
    1   alpha[1]    48.0        0.34855
    2   beta[1]     48.0        0.25310
    2   alpha[1]    40.0        0.35559
    3   beta[1]     52.0        0.29113
    3   alpha[1]    40.0        0.36277
    4   beta[1]     36.0        0.16630
    4   alpha[1]    44.0        0.21141
    5   beta[1]     28.0        0.21141
    5   alpha[1]    44.0        0.24809
    6   beta[1]     48.0        0.15978
    6   alpha[1]    44.0        0.25310
    1   kappa       56.0        0.90199
    2   kappa       32.0        1.07988
    3   kappa       20.0        2.82033
    4   kappa       32.0        3.05522
    5   kappa       52.0        3.17991
    6   kappa       68.0        2.93543
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     40.0        0.29701
    1   alpha[1]    52.0        0.30914
    2   beta[1]     28.0        0.25821
    2   alpha[1]    28.0        0.38521
    3   beta[1]     40.0        0.26343
    3   alpha[1]    28.0        0.37758
    4   beta[1]     56.0        0.16301
    4   alpha[1]    32.0        0.21141
    5   beta[1]     48.0        0.19129
    5   alpha[1]    68.0        0.27972
    6   beta[1]     48.0        0.17658
    6   alpha[1]    32.0        0.23836
    1   kappa       44.0        0.88413
    2   kappa       52.0        1.05850
    3   kappa       48.0        3.96241
    4   kappa       40.0        3.44476
    5   kappa       32.0        3.80704
    6   kappa       40.0        3.11694
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     48.0        0.32175
    1   alpha[1]    28.0        0.32175
    2   beta[1]     36.0        0.26343
    2   alpha[1]    28.0        0.35559
    3   beta[1]     24.0        0.26343
    3   alpha[1]    36.0        0.37010
    4   beta[1]     64.0        0.16301
    4   alpha[1]    68.0        0.20722
    5   beta[1]     32.0        0.17308
    5   alpha[1]    60.0        0.25310
    6   beta[1]     36.0        0.16630
    6   alpha[1]    48.0        0.23364
    1   kappa       44.0        0.86663
    2   kappa       40.0        1.01700
    3   kappa       36.0        4.12412
    4   kappa       32.0        3.58534
    5   kappa       44.0        3.73166
    6   kappa       40.0        3.58534
-------------------------------------------------
Batch: 800 of 800, 100.00%
----------------------------------------
    Chain 2
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     40.0        0.32175
    1   alpha[1]    48.0        0.34165
    2   beta[1]     64.0        0.26343
    2   alpha[1]    44.0        0.36277
    3   beta[1]     28.0        0.27418
    3   alpha[1]    52.0        0.36277
    4   beta[1]     56.0        0.15978
    4   alpha[1]    44.0        0.20722
    5   beta[1]     48.0        0.20312
    5   alpha[1]    52.0        0.24318
    6   beta[1]     48.0        0.16630
    6   alpha[1]    52.0        0.25821
    1   kappa       44.0        0.93881
    2   kappa       40.0        1.19346
    3   kappa       56.0        4.29243
    4   kappa       52.0        3.58534
    5   kappa       40.0        3.88395
    6   kappa       16.0        3.51434
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     48.0        0.30914
    1   alpha[1]    44.0        0.35559
    2   beta[1]     36.0        0.26343
    2   alpha[1]    20.0        0.37758
    3   beta[1]     20.0        0.27418
    3   alpha[1]    60.0        0.34855
    4   beta[1]     32.0        0.15978
    4   alpha[1]    44.0        0.19910
    5   beta[1]     28.0        0.19129
    5   alpha[1]    44.0        0.24809
    6   beta[1]     48.0        0.16301
    6   alpha[1]    56.0        0.27972
    1   kappa       36.0        0.83265
    2   kappa       40.0        1.05850
    3   kappa       56.0        3.88395
    4   kappa       36.0        3.58534
    5   kappa       48.0        3.88395
    6   kappa       40.0        3.17991
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     28.0        0.34165
    1   alpha[1]    36.0        0.33488
    2   beta[1]     44.0        0.27418
    2   alpha[1]    64.0        0.34855
    3   beta[1]     60.0        0.26875
    3   alpha[1]    52.0        0.39299
    4   beta[1]     40.0        0.15047
    4   alpha[1]    32.0        0.21141
    5   beta[1]     36.0        0.18750
    5   alpha[1]    36.0        0.25310
    6   beta[1]     48.0        0.16966
    6   alpha[1]    56.0        0.26343
    1   kappa       52.0        0.95777
    2   kappa       36.0        1.07988
    3   kappa       28.0        3.24415
    4   kappa       60.0        3.65777
    5   kappa       48.0        3.88395
    6   kappa       40.0        3.58534
-------------------------------------------------
Batch: 800 of 800, 100.00%
----------------------------------------
    Chain 3
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     48.0        0.30302
    1   alpha[1]    48.0        0.35559
    2   beta[1]     48.0        0.26343
    2   alpha[1]    28.0        0.35559
    3   beta[1]     56.0        0.27972
    3   alpha[1]    20.0        0.37010
    4   beta[1]     48.0        0.17308
    4   alpha[1]    28.0        0.21141
    5   beta[1]     56.0        0.20722
    5   alpha[1]    52.0        0.26343
    6   beta[1]     48.0        0.17308
    6   alpha[1]    40.0        0.24318
    1   kappa       36.0        0.81616
    2   kappa       48.0        1.10170
    3   kappa       44.0        4.12412
    4   kappa       24.0        3.58534
    5   kappa       40.0        3.96241
    6   kappa       44.0        3.30968
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     40.0        0.30914
    1   alpha[1]    56.0        0.34165
    2   beta[1]     44.0        0.27418
    2   alpha[1]    56.0        0.34855
    3   beta[1]     40.0        0.27972
    3   alpha[1]    36.0        0.37758
    4   beta[1]     44.0        0.14749
    4   alpha[1]    36.0        0.20312
    5   beta[1]     52.0        0.18379
    5   alpha[1]    60.0        0.24809
    6   beta[1]     48.0        0.16966
    6   alpha[1]    48.0        0.26875
    1   kappa       68.0        0.88413
    2   kappa       44.0        1.10170
    3   kappa       40.0        4.04246
    4   kappa       44.0        3.30968
    5   kappa       32.0        3.88395
    6   kappa       52.0        3.44476
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     52.0        0.30302
    1   alpha[1]    48.0        0.33488
    2   beta[1]     40.0        0.27418
    2   alpha[1]    36.0        0.32825
    3   beta[1]     36.0        0.28537
    3   alpha[1]    20.0        0.33488
    4   beta[1]     52.0        0.16301
    4   alpha[1]    60.0        0.19515
    5   beta[1]     20.0        0.18379
    5   alpha[1]    24.0        0.25310
    6   beta[1]     24.0        0.16630
    6   alpha[1]    44.0        0.26875
    1   kappa       32.0        0.86663
    2   kappa       32.0        1.01700
    3   kappa       36.0        4.20743
    4   kappa       28.0        3.65777
    5   kappa       48.0        3.65777
    6   kappa       48.0        3.37654
-------------------------------------------------
Batch: 800 of 800, 100.00%</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true"></a><span class="co"># Negative binomial</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true"></a><span class="kw">waicAbund</span>(out.ms.nb, <span class="dt">by.sp =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>N.max not specified. Setting upper index of integration of N to 10 plus
the largest estimated abundance value at each site in object$N.samples</code></pre>
<pre><code>Currently on species 1 out of 6</code></pre>
<pre><code>Currently on species 2 out of 6</code></pre>
<pre><code>Currently on species 3 out of 6</code></pre>
<pre><code>Currently on species 4 out of 6</code></pre>
<pre><code>Currently on species 5 out of 6</code></pre>
<pre><code>Currently on species 6 out of 6</code></pre>
<pre><code>       elpd       pD     WAIC
1 -266.2738 11.17029 554.8882
2 -279.1029 16.44539 591.0966
3 -215.5083 13.52483 458.0662
4 -434.0815 10.31177 888.7865
5 -301.0079 11.23662 624.4890
6 -362.9549 10.64288 747.1956</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true"></a><span class="co"># Poisson</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true"></a><span class="kw">waicAbund</span>(out.ms, <span class="dt">by.sp =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>N.max not specified. Setting upper index of integration of N to 10 plus
the largest estimated abundance value at each site in object$N.samples</code></pre>
<pre><code>Currently on species 1 out of 6</code></pre>
<pre><code>Currently on species 2 out of 6</code></pre>
<pre><code>Currently on species 3 out of 6</code></pre>
<pre><code>Currently on species 4 out of 6</code></pre>
<pre><code>Currently on species 5 out of 6</code></pre>
<pre><code>Currently on species 6 out of 6</code></pre>
<pre><code>       elpd       pD     WAIC
1 -273.8085 16.23702 580.0911
2 -282.7745 20.90850 607.3660
3 -216.6119 13.34573 459.9153
4 -433.5625 10.35532 887.8356
5 -300.7362 11.48360 624.4396
6 -362.0260 10.38845 744.8290</code></pre>
<p>Here we see the negative binomial model provides pretty substantial improvements for the first two species in the data set, while the last four species all have WAIC values that are very similar across the two models.</p>
</div>
<div id="prediction-2" class="section level2">
<h2>Prediction</h2>
<p>Prediction proceeds exactly as we have seen previously with the single-species non-spatial N-mixture model. Below we generate a marginal effects plot for the effect of the covariate on each of the six species in the data set. Because we saw substantial improvements in WAIC for the first two species in the data set, we will use the negative binomial model</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true"></a>out.pred &lt;-<span class="st"> </span><span class="kw">predict</span>(out.ms.nb, X<span class="fl">.0</span>, <span class="dt">ignore.RE =</span> <span class="ot">TRUE</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true"></a><span class="co"># Look at the resulting object</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true"></a><span class="kw">str</span>(out.pred)</span></code></pre></div>
<pre><code>List of 3
 $ mu.0.samples: num [1:3000, 1:6, 1:100] 0.461 0.701 0.109 0.437 0.335 ...
 $ N.0.samples : num [1:3000, 1:6, 1:100] 0 0 0 0 0 0 0 0 1 0 ...
 $ call        : language predict.msNMix(object = out.ms.nb, X.0 = X.0, ignore.RE = TRUE)
 - attr(*, &quot;class&quot;)= chr &quot;predict.msNMix&quot;</code></pre>
<p>Notice that <code>mu.0.samples</code> (expected abundances) and <code>N.0.samples</code> (mean abundances) are now three-dimensional arrays, with dimensions corresponding to posterior sample, species, and site. Now, we make a marginal effect plot for each species.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true"></a>mu.<span class="fl">0.</span>quants &lt;-<span class="st"> </span><span class="kw">apply</span>(out.pred<span class="op">$</span>mu.<span class="fl">0.</span>samples, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), quantile,</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true"></a>                          <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true"></a><span class="co"># Put stuff together for plotting with ggplot2</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true"></a>mu.<span class="fl">0.</span>plot.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">mu.med =</span> <span class="kw">c</span>(mu.<span class="fl">0.</span>quants[<span class="dv">2</span>, , ]), </span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true"></a>               <span class="dt">mu.low =</span> <span class="kw">c</span>(mu.<span class="fl">0.</span>quants[<span class="dv">1</span>, , ]),</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true"></a>               <span class="dt">mu.high =</span> <span class="kw">c</span>(mu.<span class="fl">0.</span>quants[<span class="dv">3</span>, , ]),</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true"></a>                           <span class="dt">sp =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>n.sp, <span class="kw">nrow</span>(X<span class="fl">.0</span>)),</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true"></a>                           <span class="dt">abund.cov.1 =</span> <span class="kw">rep</span>(cov.pred.vals, <span class="dt">each =</span> n.sp))</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true"></a><span class="kw">ggplot</span>(mu.<span class="fl">0.</span>plot.df, <span class="kw">aes</span>(<span class="dt">x =</span> abund.cov<span class="fl">.1</span>, <span class="dt">y =</span> mu.med)) <span class="op">+</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> mu.low, <span class="dt">ymax =</span> mu.high), <span class="dt">fill =</span> <span class="st">&#39;grey70&#39;</span>) <span class="op">+</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(sp)) <span class="op">+</span></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Covariate&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;Expected abundance&#39;</span>) </span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
</div>
<div id="latent-factor-multi-species-n-mixture-models" class="section level1">
<h1>Latent factor multi-species N-mixture models</h1>
<div id="basic-model-description-3" class="section level2">
<h2>Basic model description</h2>
<p>The latent factor multi-species N-mixture model is identical to the previously described multi-species N-mixture model except we include an additional component in the model to accommodate residual correlations between species. This type of model is often referred to as an abundance-based joint species distribution model (JSDM) in the statistical ecology literature <span class="citation">(Warton et al. 2015)</span>. The previously described multi-species N-mixture model can be viewed as a simplified version of the latent factor multi-species N-mixture model, where we assume there are no residual correlations between species. This model was described in Section 8.5.4 of <span class="citation">Kéry and Royle (2021)</span>, which they implemented in JAGS.</p>
<p>The model is identical to the previously described multi-species N-mixture model, with the only addition being a species-specific random effect at each site added to the equation for expected abundance. More specifically, we model species-specific abundance as</p>
<p><span class="math display">\[\begin{equation}
\text{log}(\mu_{i, j}) = \textbf{x}_j^\top\boldsymbol{\beta}_i + \text{w}^\ast_{i, j}.
\end{equation}\]</span></p>
<p>The species-specific random effect <span class="math inline">\(\text{w}^\ast_{i, j}\)</span> is used to account for residual correlations between species by assuming that correlation amongst the species can be explained by species-specific effects of a set of <span class="math inline">\(q\)</span> latent variables. More specifically, we use a factor modeling approach <span class="citation">(Lopes and West 2004)</span> to account for species residual correlations in a computationally efficient manner <span class="citation">(Tobler et al. 2019)</span>. This approach is ideal for large groups of species, where estimating a full <span class="math inline">\(I \times I\)</span> covariance matrix as done in <span class="citation">Mimnagh et al. (2022)</span> would be computationally intractable (and/or require massive amounts of data). Specifically, we decompose <span class="math inline">\(\text{w}^\ast_{i, j}\)</span> into a linear combination of <span class="math inline">\(q\)</span> latent variables (i.e., factors) and their associated species-specific coefficients (i.e., factor loadings) according to</p>
<p><span class="math display">\[\begin{equation}\label{factorModel}
    \text{w}^\ast_{i, j} = \boldsymbol{\lambda}_i^\top\text{w}_j,
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{\lambda}_i^\top\)</span> is the <span class="math inline">\(i\)</span> row of factor loadings from an <span class="math inline">\(I \times q\)</span> loadings matrix <span class="math inline">\(\boldsymbol{\Lambda}\)</span>, and <span class="math inline">\(\text{w}_j\)</span> is a <span class="math inline">\(q \times 1\)</span> vector of independent latent factors at site <span class="math inline">\(j\)</span>. By settng <span class="math inline">\(q &lt;&lt; N\)</span>, we achieve dimension reduction to efficiently model communities with a large number of species <span class="citation">(Taylor-Rodriguez et al. 2019; Tobler et al. 2019; Doser, Finley, and Banerjee 2023)</span>. The approach accounts for residual species correlations via their species-specific responses to the <span class="math inline">\(q\)</span> factors. We model each latent factor as a standard normal random variable. To ensure identifiability of the latent factors from the latent factor loadings, we fix the upper triangle of the factor loadings matrix to 0 and the diagonal elements to 1. We assign standard normal priors to the lower triangular elements of the factor loadings matrix. All other priors are identical to the multi-species N-mixture model previously discussed.</p>
<p>The constraints on the factor loadings matrix ensures identifiability of the factor loadings from the latent factors, but this also results in important practical considerations when fitting these models (e.g., ordering of the species, initial values). <a href="https://www.jeffdoser.com/files/spoccupancy-web/articles/modelconsiderations">This vignette</a> on the <code>spOccupancy</code> website discusses these (and other) considerations. All the advice applied to factor models fit with detection-nondetection data in <code>spOccupancy</code> also apply to factor models fit in <code>spAbundance</code>.</p>
</div>
<div id="fitting-latent-factor-multi-species-n-mixture-models-with-lfmsnmix" class="section level2">
<h2>Fitting latent factor multi-species N-mixture models with <code>lfMsNMix()</code></h2>
<p>The function <code>lfMsNMix()</code> fits latent factor multi-species N-mixture models in <code>spAbundance</code>. The arguments are identical to those in <code>msNMix()</code> with one additional argument that specifies the number of factors we wish to use in the model (<code>n.factors</code>):</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true"></a><span class="kw">lfMsNMix</span>(abund.formula, det.formula, data, inits, priors,  </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true"></a>       tuning, n.factors, n.batch, batch.length, <span class="dt">accept.rate =</span> <span class="fl">0.43</span>, </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true"></a>       <span class="dt">family =</span> <span class="st">&#39;Poisson&#39;</span>, <span class="dt">n.omp.threads =</span> <span class="dv">1</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>, <span class="dt">n.report =</span> <span class="dv">100</span>, </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true"></a>       <span class="dt">n.burn =</span> <span class="kw">round</span>(.<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>n.samples), <span class="dt">n.thin =</span> <span class="dv">1</span>, </span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true"></a>       <span class="dt">n.chains =</span> <span class="dv">1</span>, ...)</span></code></pre></div>
<p>For guidance on choosing the number of latent factors, see <a href="https://www.jeffdoser.com/files/spoccupancy-web/articles/modelconsiderations">this vignette</a> on the <code>spOccupancy</code> website. Here we will fit a model with 3 latent factors.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true"></a>n.factors &lt;-<span class="st"> </span><span class="dv">3</span></span></code></pre></div>
<p>There are only a few slight differences in how we go about fitting a multi-species N-mixture model with latent factors compared to one without latent factors. The <code>data</code> format as well as <code>abund.formula</code> and <code>det.formula</code> remain the same as before.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true"></a>abund.ms.formula &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw">scale</span>(abund.cov<span class="fl">.1</span>) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>abund.factor<span class="fl">.1</span>) </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true"></a>det.ms.formula &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw">scale</span>(det.cov<span class="fl">.1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale</span>(det.cov<span class="fl">.2</span>) </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true"></a><span class="kw">str</span>(dataNMixSim)</span></code></pre></div>
<pre><code>List of 4
 $ y         : int [1:6, 1:225, 1:5] 0 0 1 0 0 0 0 0 0 0 ...
 $ abund.covs: num [1:225, 1:2] 0.2863 -0.0325 -0.9897 0.2118 -0.972 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : NULL
  .. ..$ : chr [1:2] &quot;abund.cov.1&quot; &quot;abund.factor.1&quot;
 $ det.covs  :List of 2
  ..$ det.cov.1: num [1:225, 1:5] 1.577 0.6956 -0.3031 0.107 0.0284 ...
  ..$ det.cov.2: num [1:225, 1:5] -1.235 -0.509 -2.012 -0.899 0.38 ...
 $ coords    : num [1:225, 1:2] 0 0.0714 0.1429 0.2143 0.2857 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : NULL
  .. ..$ : chr [1:2] &quot;X&quot; &quot;Y&quot;</code></pre>
<p>Initial values are specified as with <code>msNMix()</code>, with the exception that we can now specify initial values for the latent factor loadings matrix <code>lambda</code> and the latent factors <code>w</code>. Initial values for the species-specific factor loadings (<code>lambda</code>) are specified as a numeric matrix with <span class="math inline">\(I\)</span> rows and <span class="math inline">\(q\)</span> columns, where <span class="math inline">\(I\)</span> is the number of species and <span class="math inline">\(q\)</span> is the number of latent factors used in the model. The diagonal elements of the matrix must be 1, and values in the upper triangle must be set to 0 to ensure identifiability of the latent factors. Note that the default initial values for the lower triangle of the factor loadings matrix is 0. We can also specify the initial values for the latent factors. Below we set these to 0 (which is the default).</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true"></a><span class="co"># Number of species</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true"></a>n.sp &lt;-<span class="st"> </span><span class="kw">dim</span>(dataNMixSim<span class="op">$</span>y)[<span class="dv">1</span>]</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true"></a><span class="co"># Initiate all lambda initial values to 0. </span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true"></a>lambda.inits &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, n.sp, n.factors)</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true"></a><span class="co"># Set diagonal elements to 1</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true"></a><span class="kw">diag</span>(lambda.inits) &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true"></a><span class="co"># Set lower triangular elements to random values from a standard normal distribution</span></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true"></a>lambda.inits[<span class="kw">lower.tri</span>(lambda.inits)] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">sum</span>(<span class="kw">lower.tri</span>(lambda.inits)))</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true"></a><span class="co"># Check it out.</span></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true"></a>lambda.inits</span></code></pre></div>
<pre><code>           [,1]        [,2]       [,3]
[1,]  1.0000000  0.00000000  0.0000000
[2,] -0.5504132  1.00000000  0.0000000
[3,]  0.8339913 -0.02644856  1.0000000
[4,]  0.9135752 -0.09364475  1.5179254
[5,] -0.2603041 -1.11736789  0.9255597
[6,]  1.3494746  1.55313249 -0.3860510</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true"></a>w.inits &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, n.factors, <span class="kw">ncol</span>(dataNMixSim<span class="op">$</span>y))</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true"></a>ms.inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">alpha.comm =</span> <span class="dv">0</span>,</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true"></a>                 <span class="dt">beta.comm =</span> <span class="dv">0</span>,</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true"></a>                 <span class="dt">beta =</span> <span class="dv">0</span>,</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true"></a>                 <span class="dt">alpha =</span> <span class="dv">0</span>,</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true"></a>                 <span class="dt">tau.sq.beta =</span> <span class="dv">1</span>,</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true"></a>         <span class="dt">lambda =</span> lambda.inits,</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true"></a>         <span class="dt">kappa =</span> <span class="dv">1</span>,</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true"></a>         <span class="dt">w =</span> w.inits,</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true"></a>                 <span class="dt">tau.sq.alpha =</span> <span class="dv">1</span>,</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true"></a>         <span class="dt">sigma.sq.mu =</span> <span class="fl">0.5</span>,</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true"></a>                 <span class="dt">N =</span> <span class="kw">apply</span>(dataNMixSim<span class="op">$</span>y, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), max, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<p>Priors are specified exactly the same as we saw with <code>msNMix()</code>. We do not need to explicitly specify the prior for the factor loadings, as we require the prior for the lower-triangular values to be Normal(0, 1).</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true"></a>ms.priors &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">beta.comm.normal =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">var =</span> <span class="fl">2.72</span>),</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true"></a>                  <span class="dt">alpha.comm.normal =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">var =</span> <span class="fl">2.72</span>),</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true"></a>                  <span class="dt">tau.sq.beta.ig =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="fl">0.1</span>, <span class="dt">b =</span> <span class="fl">0.1</span>),</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true"></a>                  <span class="dt">tau.sq.alpha.ig =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="fl">0.1</span>, <span class="dt">b =</span> <span class="fl">0.1</span>), </span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true"></a>          <span class="dt">sigma.sq.mu.ig =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="fl">0.1</span>, <span class="dt">b =</span> <span class="fl">0.1</span>),</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true"></a>                  <span class="dt">kappa.unif =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">0</span>, <span class="dt">b =</span> <span class="dv">100</span>))</span></code></pre></div>
<p>We finish up by specifying the tuning values, where now we specify the initial tuning variance for the factor loadings <code>lambda</code> as well as the latent factors <code>w</code>. We then run the model for 20,000 iterations with a burn-in of 10,000 samples and a thinning rate of 10, for each of 3 chains, yielding a total of 3000 posterior samples. We will fit the model with a Poisson distribution for abundance.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true"></a><span class="co"># Specify initial tuning values</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true"></a>ms.tuning &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">beta =</span> <span class="fl">0.3</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">beta.star =</span> <span class="fl">0.5</span>, <span class="dt">kappa =</span> <span class="fl">0.5</span>, <span class="dt">w =</span> <span class="fl">0.5</span>, <span class="dt">lambda =</span> <span class="fl">0.5</span>)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true"></a><span class="co"># Approx. run time: ~4.3 min</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true"></a>out.lf.ms &lt;-<span class="st"> </span><span class="kw">lfMsNMix</span>(<span class="dt">abund.formula =</span> abund.ms.formula,</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true"></a>                   <span class="dt">det.formula =</span> det.ms.formula,</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true"></a>                   <span class="dt">data =</span> dataNMixSim,</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true"></a>                   <span class="dt">inits =</span> ms.inits,</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true"></a>           <span class="dt">n.batch =</span> <span class="dv">800</span>,</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true"></a>                   <span class="dt">n.factors =</span> n.factors,</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true"></a>           <span class="dt">tuning =</span> ms.tuning,</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true"></a>           <span class="dt">batch.length =</span> <span class="dv">25</span>,</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true"></a>                   <span class="dt">priors =</span> ms.priors,</span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true"></a>                   <span class="dt">n.omp.threads =</span> <span class="dv">1</span>,</span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true"></a>                   <span class="dt">verbose =</span> <span class="ot">TRUE</span>,</span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true"></a>                   <span class="dt">n.report =</span> <span class="dv">200</span>,</span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true"></a>                   <span class="dt">n.burn =</span> <span class="dv">10000</span>,</span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true"></a>                   <span class="dt">n.thin =</span> <span class="dv">10</span>,</span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true"></a>                   <span class="dt">n.chains =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>----------------------------------------
    Preparing to run the model
----------------------------------------
----------------------------------------
    Model description
----------------------------------------
Latent Factor Multi-species Poisson N-Mixture model fit with 225 sites and 6 species.

Samples per Chain: 20000 
Burn-in: 10000 
Thinning Rate: 10 
Number of Chains: 3 
Total Posterior Samples: 3000 

Using 3 latent factors.

Source compiled with OpenMP support and model fit using 1 thread(s).

Adaptive Metropolis with target acceptance rate: 43.0
----------------------------------------
    Chain 1
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     28.0        0.23364
    1   alpha[1]    36.0        0.33488
    2   beta[1]     28.0        0.21141
    2   alpha[1]    28.0        0.35559
    3   beta[1]     72.0        0.25310
    3   alpha[1]    36.0        0.34855
    4   beta[1]     56.0        0.15047
    4   alpha[1]    64.0        0.19515
    5   beta[1]     44.0        0.19129
    5   alpha[1]    40.0        0.28537
    6   beta[1]     60.0        0.15978
    6   alpha[1]    40.0        0.25821
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     40.0        0.24318
    1   alpha[1]    44.0        0.35559
    2   beta[1]     28.0        0.20312
    2   alpha[1]    40.0        0.33488
    3   beta[1]     44.0        0.23836
    3   alpha[1]    60.0        0.36277
    4   beta[1]     48.0        0.15661
    4   alpha[1]    20.0        0.20312
    5   beta[1]     48.0        0.18015
    5   alpha[1]    44.0        0.25310
    6   beta[1]     72.0        0.15661
    6   alpha[1]    48.0        0.28537
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     40.0        0.23836
    1   alpha[1]    44.0        0.34855
    2   beta[1]     32.0        0.22448
    2   alpha[1]    40.0        0.38521
    3   beta[1]     28.0        0.25310
    3   alpha[1]    60.0        0.32825
    4   beta[1]     40.0        0.15047
    4   alpha[1]    40.0        0.21141
    5   beta[1]     24.0        0.18379
    5   alpha[1]    40.0        0.25821
    6   beta[1]     56.0        0.17308
    6   alpha[1]    44.0        0.27418
-------------------------------------------------
Batch: 800 of 800, 100.00%
----------------------------------------
    Chain 2
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     52.0        0.22003
    1   alpha[1]    36.0        0.34165
    2   beta[1]     60.0        0.20722
    2   alpha[1]    28.0        0.34165
    3   beta[1]     56.0        0.25821
    3   alpha[1]    32.0        0.36277
    4   beta[1]     32.0        0.16301
    4   alpha[1]    32.0        0.20722
    5   beta[1]     44.0        0.19910
    5   alpha[1]    48.0        0.23836
    6   beta[1]     32.0        0.15661
    6   alpha[1]    28.0        0.25821
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     48.0        0.25310
    1   alpha[1]    32.0        0.34855
    2   beta[1]     40.0        0.21568
    2   alpha[1]    28.0        0.37758
    3   beta[1]     48.0        0.23836
    3   alpha[1]    44.0        0.33488
    4   beta[1]     60.0        0.16630
    4   alpha[1]    64.0        0.20312
    5   beta[1]     32.0        0.17658
    5   alpha[1]    44.0        0.26343
    6   beta[1]     52.0        0.16301
    6   alpha[1]    32.0        0.25821
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     40.0        0.25310
    1   alpha[1]    40.0        0.35559
    2   beta[1]     24.0        0.22901
    2   alpha[1]    52.0        0.40093
    3   beta[1]     40.0        0.25821
    3   alpha[1]    36.0        0.37010
    4   beta[1]     32.0        0.16630
    4   alpha[1]    56.0        0.19515
    5   beta[1]     36.0        0.18379
    5   alpha[1]    44.0        0.25821
    6   beta[1]     36.0        0.16301
    6   alpha[1]    40.0        0.26343
-------------------------------------------------
Batch: 800 of 800, 100.00%
----------------------------------------
    Chain 3
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     40.0        0.24318
    1   alpha[1]    32.0        0.36277
    2   beta[1]     36.0        0.22448
    2   alpha[1]    48.0        0.37010
    3   beta[1]     40.0        0.25821
    3   alpha[1]    44.0        0.34855
    4   beta[1]     20.0        0.15978
    4   alpha[1]    32.0        0.20722
    5   beta[1]     40.0        0.20312
    5   alpha[1]    44.0        0.25821
    6   beta[1]     32.0        0.15661
    6   alpha[1]    40.0        0.25821
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     56.0        0.26343
    1   alpha[1]    36.0        0.34855
    2   beta[1]     44.0        0.22901
    2   alpha[1]    48.0        0.35559
    3   beta[1]     52.0        0.25821
    3   alpha[1]    40.0        0.34165
    4   beta[1]     36.0        0.15661
    4   alpha[1]    32.0        0.21141
    5   beta[1]     52.0        0.17658
    5   alpha[1]    32.0        0.25310
    6   beta[1]     44.0        0.15661
    6   alpha[1]    40.0        0.25821
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     44.0        0.24318
    1   alpha[1]    20.0        0.34165
    2   beta[1]     40.0        0.21568
    2   alpha[1]    40.0        0.37758
    3   beta[1]     52.0        0.25821
    3   alpha[1]    36.0        0.34165
    4   beta[1]     56.0        0.15047
    4   alpha[1]    44.0        0.22901
    5   beta[1]     44.0        0.18379
    5   alpha[1]    40.0        0.26875
    6   beta[1]     44.0        0.16630
    6   alpha[1]    44.0        0.26343
-------------------------------------------------
Batch: 800 of 800, 100.00%</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true"></a><span class="kw">summary</span>(out.lf.ms)</span></code></pre></div>
<pre><code>
Call:
lfMsNMix(abund.formula = abund.ms.formula, det.formula = det.ms.formula, 
    data = dataNMixSim, inits = ms.inits, priors = ms.priors, 
    tuning = ms.tuning, n.factors = n.factors, n.batch = 800, 
    batch.length = 25, n.omp.threads = 1, verbose = TRUE, n.report = 200, 
    n.burn = 10000, n.thin = 10, n.chains = 3)

Samples per Chain: 20000
Burn-in: 10000
Thinning Rate: 10
Number of Chains: 3
Total Posterior Samples: 3000
Run Time (min): 4.1326

----------------------------------------
    Community Level
----------------------------------------
Abundance Means (log scale): 
                      Mean     SD    2.5%     50%   97.5%   Rhat  ESS
(Intercept)        -0.9475 0.2963 -1.5183 -0.9511 -0.3300 1.0011 1569
scale(abund.cov.1)  0.0051 0.3253 -0.6464  0.0063  0.6318 1.0066 3000

Abundance Variances (log scale): 
                     Mean     SD   2.5%    50%  97.5%   Rhat  ESS
(Intercept)        0.4884 0.5447 0.0790 0.3401 1.8051 1.0007 2031
scale(abund.cov.1) 0.6946 0.7575 0.1646 0.4925 2.4510 1.0276 2689

Abundance Random Effect Variances (log scale): 
                             Mean    SD   2.5%    50%  97.5%   Rhat  ESS
(Intercept)-abund.factor.1 0.4615 0.142 0.2454 0.4407 0.7889 1.0025 1068

                    Mean     SD    2.5%     50%  97.5%   Rhat  ESS
(Intercept)      -0.0774 0.3647 -0.8119 -0.0798 0.6553 1.0057 2768
scale(det.cov.1)  0.4458 0.4127 -0.3894  0.4461 1.2541 1.0018 2723
scale(det.cov.2)  1.1094 0.4752  0.1141  1.1340 2.0147 1.0020 3000
                   Mean     SD   2.5%    50%  97.5%   Rhat  ESS
(Intercept)      0.8923 0.9071 0.2037 0.6340 3.0703 0.9997 2156
scale(det.cov.1) 1.1480 1.5096 0.2581 0.8208 3.9095 1.0874 2743
scale(det.cov.2) 1.5273 1.7618 0.3317 1.0710 5.3009 1.0014 3484

----------------------------------------
    Species Level
----------------------------------------
Abundance (log scale): 
                          Mean     SD    2.5%     50%   97.5%   Rhat  ESS
(Intercept)-sp1        -1.3457 0.2482 -1.8767 -1.3344 -0.8825 1.0138  604
(Intercept)-sp2        -1.1727 0.2378 -1.6291 -1.1730 -0.7085 1.0052  539
(Intercept)-sp3        -1.5883 0.2851 -2.1821 -1.5814 -1.0535 1.0051  537
(Intercept)-sp4        -0.4551 0.2376 -0.9161 -0.4590  0.0294 1.0428  261
(Intercept)-sp5        -0.7243 0.2650 -1.2415 -0.7222 -0.1859 1.0397  271
(Intercept)-sp6        -0.5310 0.2289 -0.9809 -0.5348 -0.0722 1.0058  297
scale(abund.cov.1)-sp1  0.0279 0.1370 -0.2352  0.0294  0.2966 1.0018 1858
scale(abund.cov.1)-sp2  0.5321 0.1453  0.2593  0.5286  0.8158 1.0004 1357
scale(abund.cov.1)-sp3  0.2767 0.1731 -0.0597  0.2761  0.6218 1.0069 1272
scale(abund.cov.1)-sp4  0.6753 0.0936  0.4916  0.6730  0.8615 1.0189 1267
scale(abund.cov.1)-sp5 -0.5364 0.1217 -0.7793 -0.5345 -0.3089 1.0238  914
scale(abund.cov.1)-sp6 -0.9471 0.0732 -1.0916 -0.9464 -0.8028 1.0009 1278

                        Mean     SD    2.5%     50%   97.5%   Rhat  ESS
(Intercept)-sp1       0.7288 0.2022  0.3437  0.7280  1.1232 1.0124 1217
(Intercept)-sp2       0.1776 0.1817 -0.1967  0.1798  0.5336 1.0006 1404
(Intercept)-sp3      -0.6930 0.2287 -1.1469 -0.6925 -0.2561 1.0059  736
(Intercept)-sp4      -0.3522 0.1388 -0.6396 -0.3498 -0.0950 1.0212  708
(Intercept)-sp5      -1.0051 0.2072 -1.4485 -0.9943 -0.6212 1.0310  325
(Intercept)-sp6       0.6803 0.1375  0.4161  0.6786  0.9569 1.0065 1551
scale(det.cov.1)-sp1  1.8390 0.2490  1.3772  1.8297  2.3526 1.0102 1517
scale(det.cov.1)-sp2  0.2922 0.1775 -0.0593  0.2924  0.6539 1.0021 1902
scale(det.cov.1)-sp3  1.0907 0.2098  0.7004  1.0847  1.5115 1.0022 1704
scale(det.cov.1)-sp4 -0.0374 0.0865 -0.2083 -0.0370  0.1302 1.0006 2478
scale(det.cov.1)-sp5  0.1065 0.1152 -0.1136  0.1066  0.3308 1.0020 2287
scale(det.cov.1)-sp6 -0.4332 0.1210 -0.6766 -0.4350 -0.1918 1.0076 2201
scale(det.cov.2)-sp1  0.0102 0.1534 -0.2914  0.0124  0.3023 1.0006 2323
scale(det.cov.2)-sp2  2.5602 0.2955  2.0252  2.5432  3.1869 1.0013 2011
scale(det.cov.2)-sp3  0.6303 0.1764  0.2937  0.6244  0.9832 1.0055 2076
scale(det.cov.2)-sp4  0.9951 0.1108  0.7845  0.9934  1.2189 1.0153 1581
scale(det.cov.2)-sp5  0.8864 0.1345  0.6302  0.8836  1.1537 1.0006 1746
scale(det.cov.2)-sp6  2.1503 0.1816  1.8047  2.1477  2.5127 1.0020 1989</code></pre>
<p>We see adequate convergence of all model parameters shown in the summary output. Note that the factor loadings themselves are not shown in the <code>summary()</code> output, but are available in the <code>lambda.samples</code> portion of the model list object.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true"></a><span class="co"># Rhats for lambda (the factor loadings)</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true"></a>out.lf.ms<span class="op">$</span>rhat<span class="op">$</span>lambda.lower.tri</span></code></pre></div>
<pre><code> [1] 1.0150701 1.0257197 1.0233666 1.0285540 1.0027869 1.0206912 1.0025910
 [8] 1.0297890 0.9998667 1.0104303 1.0037024 1.0023988</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true"></a><span class="co"># ESS for lambda</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true"></a>out.lf.ms<span class="op">$</span>ESS<span class="op">$</span>lambda</span></code></pre></div>
<pre><code>   sp1-1    sp2-1    sp3-1    sp4-1    sp5-1    sp6-1    sp1-2    sp2-2 
  0.0000 403.1262 490.6230 826.8511 415.6916 976.5305   0.0000   0.0000 
   sp3-2    sp4-2    sp5-2    sp6-2    sp1-3    sp2-3    sp3-3    sp4-3 
422.9640 662.1460 467.4197 993.6749   0.0000   0.0000   0.0000 644.9572 
   sp5-3    sp6-3 
399.0487 692.8670 </code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true"></a><span class="co"># Posterior quantiles for the latent factor loadings</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true"></a><span class="kw">summary</span>(out.lf.ms<span class="op">$</span>lambda.samples)<span class="op">$</span>quantiles</span></code></pre></div>
<pre><code>             2.5%         25%         50%         75%     97.5%
sp1-1  1.00000000  1.00000000  1.00000000  1.00000000 1.0000000
sp2-1 -0.71437360 -0.39102029 -0.23687895 -0.05634686 0.2937989
sp3-1 -0.06459177  0.25908449  0.41216460  0.58446669 0.8859298
sp4-1 -0.03026532  0.13568854  0.21403569  0.29471706 0.4436571
sp5-1 -0.22778646  0.03005635  0.15519405  0.28542452 0.5250266
sp6-1 -0.26861082 -0.11279166 -0.03020994  0.05382746 0.2091002
sp1-2  0.00000000  0.00000000  0.00000000  0.00000000 0.0000000
sp2-2  1.00000000  1.00000000  1.00000000  1.00000000 1.0000000
sp3-2 -0.84010066 -0.47730885 -0.28312726 -0.07905391 0.3105970
sp4-2 -0.18886583 -0.01333374  0.07965109  0.16832014 0.3304890
sp5-2 -0.30163358 -0.04737131  0.08732705  0.22939457 0.4787959
sp6-2 -0.22319025 -0.06674148  0.01805601  0.09909552 0.2538844
sp1-3  0.00000000  0.00000000  0.00000000  0.00000000 0.0000000
sp2-3  0.00000000  0.00000000  0.00000000  0.00000000 0.0000000
sp3-3  1.00000000  1.00000000  1.00000000  1.00000000 1.0000000
sp4-3 -0.31138245 -0.13392179 -0.03774708  0.05272577 0.2455844
sp5-3 -0.11250550  0.18161727  0.33055258  0.47521488 0.7230319
sp6-3 -0.35750655 -0.18822062 -0.10027351 -0.01019933 0.1652917</code></pre>
<p>Notice the Rhat values are only reported for the elements of the factor loadings matrix that are estimated and not fixed at any specific value, while the ESS values are reported for all elements of the factor loadings matrix, and take value 0 for those parameters that are fixed for identifiability purposes. We can inspect the latent factor loadings as well as the latent factors (stored in <code>out.lf.ms$w.samples</code>) to provide information on any groupings that arise from the species in the modeled community. See Appendix S1 in <span class="citation">Doser, Finley, and Banerjee (2023)</span> for a discussion on using factor models as a model-based ordination technique.</p>
</div>
<div id="posterior-predictive-checks-3" class="section level2">
<h2>Posterior predictive checks</h2>
<p>We again use the <code>ppcAbund()</code> function perform a posterior predictive check of our model</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true"></a>ppc.out.lf.ms &lt;-<span class="st"> </span><span class="kw">ppcAbund</span>(out.lf.ms, <span class="dt">fit.stat =</span> <span class="st">&#39;chi-squared&#39;</span>, <span class="dt">group =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>Currently on species 1 out of 6</code></pre>
<pre><code>Currently on species 2 out of 6</code></pre>
<pre><code>Currently on species 3 out of 6</code></pre>
<pre><code>Currently on species 4 out of 6</code></pre>
<pre><code>Currently on species 5 out of 6</code></pre>
<pre><code>Currently on species 6 out of 6</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true"></a><span class="co"># Summarize with a Bayesian p-value</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true"></a><span class="kw">summary</span>(ppc.out.lf.ms)</span></code></pre></div>
<pre><code>
Call:
ppcAbund(object = out.lf.ms, fit.stat = &quot;chi-squared&quot;, group = 2)

Samples per Chain: 20000
Burn-in: 10000
Thinning Rate: 10
Number of Chains: 3
Total Posterior Samples: 3000

----------------------------------------
    Community Level
----------------------------------------
Bayesian p-value:  0.4972 

----------------------------------------
    Species Level
----------------------------------------
sp1 Bayesian p-value: 0.4457
sp2 Bayesian p-value: 0.6793
sp3 Bayesian p-value: 0.677
sp4 Bayesian p-value: 0.1627
sp5 Bayesian p-value: 0.449
sp6 Bayesian p-value: 0.5693
Fit statistic:  chi-squared </code></pre>
</div>
<div id="model-selection-using-waic-3" class="section level2">
<h2>Model selection using WAIC</h2>
<p>We can use <code>waicAbund()</code> to calculate the WAIC for comparison to other models. Below, we compare the regular multi-species N-mixture model to the latent factor multi-species N-mixture model.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true"></a><span class="co"># With latent factors</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true"></a><span class="kw">waicAbund</span>(out.lf.ms, <span class="dt">by.sp =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>N.max not specified. Setting upper index of integration of N to 10 plus
the largest estimated abundance value at each site in object$N.samples</code></pre>
<pre><code>Currently on species 1 out of 6</code></pre>
<pre><code>Currently on species 2 out of 6</code></pre>
<pre><code>Currently on species 3 out of 6</code></pre>
<pre><code>Currently on species 4 out of 6</code></pre>
<pre><code>Currently on species 5 out of 6</code></pre>
<pre><code>Currently on species 6 out of 6</code></pre>
<pre><code>       elpd       pD     WAIC
1 -222.1619 43.01056 530.3449
2 -231.4863 49.82123 562.6151
3 -179.1883 38.36880 435.1141
4 -425.4062 19.04354 888.8995
5 -287.7623 24.48453 624.4936
6 -357.9986 16.51411 749.0255</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true"></a><span class="co"># Without latent factors</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true"></a><span class="kw">waicAbund</span>(out.ms, <span class="dt">by.sp =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>N.max not specified. Setting upper index of integration of N to 10 plus
the largest estimated abundance value at each site in object$N.samples</code></pre>
<pre><code>Currently on species 1 out of 6</code></pre>
<pre><code>Currently on species 2 out of 6</code></pre>
<pre><code>Currently on species 3 out of 6</code></pre>
<pre><code>Currently on species 4 out of 6</code></pre>
<pre><code>Currently on species 5 out of 6</code></pre>
<pre><code>Currently on species 6 out of 6</code></pre>
<pre><code>       elpd       pD     WAIC
1 -273.8085 16.23702 580.0911
2 -282.7745 20.90850 607.3660
3 -216.6119 13.34573 459.9153
4 -433.5625 10.35532 887.8356
5 -300.7362 11.48360 624.4396
6 -362.0260 10.38845 744.8290</code></pre>
</div>
<div id="prediction-3" class="section level2">
<h2>Prediction</h2>
<p>Prediction proceeds exactly as before with the multi-species N-mixture model, so we can simply copy the code from above and re-run it with our latent factor model.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true"></a>out.pred &lt;-<span class="st"> </span><span class="kw">predict</span>(out.lf.ms, X<span class="fl">.0</span>, <span class="dt">ignore.RE =</span> <span class="ot">TRUE</span>)</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true"></a><span class="co"># Look at the resulting object</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true"></a><span class="kw">str</span>(out.pred)</span></code></pre></div>
<pre><code>List of 3
 $ mu.0.samples: num [1:3000, 1:6, 1:100] 0.0768 0.0203 0.0638 0.0397 0.2638 ...
 $ N.0.samples : int [1:3000, 1:6, 1:100] 0 0 0 0 0 2 1 0 0 0 ...
 $ call        : language predict.lfMsNMix(object = out.lf.ms, X.0 = X.0, ignore.RE = TRUE)
 - attr(*, &quot;class&quot;)= chr &quot;predict.lfMsNMix&quot;</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true"></a>mu.<span class="fl">0.</span>quants &lt;-<span class="st"> </span><span class="kw">apply</span>(out.pred<span class="op">$</span>mu.<span class="fl">0.</span>samples, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), quantile,</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true"></a>                          <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true"></a><span class="co"># Put stuff together for plotting with ggplot2</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true"></a>mu.<span class="fl">0.</span>plot.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">mu.med =</span> <span class="kw">c</span>(mu.<span class="fl">0.</span>quants[<span class="dv">2</span>, , ]),</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true"></a>               <span class="dt">mu.low =</span> <span class="kw">c</span>(mu.<span class="fl">0.</span>quants[<span class="dv">1</span>, , ]),</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true"></a>               <span class="dt">mu.high =</span> <span class="kw">c</span>(mu.<span class="fl">0.</span>quants[<span class="dv">3</span>, , ]),</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true"></a>                           <span class="dt">sp =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>n.sp, <span class="kw">nrow</span>(X<span class="fl">.0</span>)),</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true"></a>                           <span class="dt">abund.cov.1 =</span> <span class="kw">rep</span>(cov.pred.vals, <span class="dt">each =</span> n.sp))</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true"></a><span class="kw">ggplot</span>(mu.<span class="fl">0.</span>plot.df, <span class="kw">aes</span>(<span class="dt">x =</span> abund.cov<span class="fl">.1</span>, <span class="dt">y =</span> mu.med)) <span class="op">+</span></span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> mu.low, <span class="dt">ymax =</span> mu.high), <span class="dt">fill =</span> <span class="st">&#39;grey70&#39;</span>) <span class="op">+</span></span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(sp)) <span class="op">+</span></span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Covariate&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;Expected abundance&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAADAFBMVEUAAAABAQECAgIDAwMEBAQFBQUGBgYHBwcICAgJCQkKCgoLCwsMDAwNDQ0ODg4PDw8QEBARERESEhITExMUFBQVFRUWFhYXFxcYGBgZGRkaGhobGxscHBwdHR0eHh4fHx8gICAhISEiIiIjIyMkJCQlJSUmJiYnJycoKCgpKSkqKiorKyssLCwtLS0uLi4vLy8wMDAxMTEyMjIzMzM0NDQ1NTU2NjY3Nzc4ODg5OTk6Ojo7Ozs8PDw9PT0+Pj4/Pz9AQEBBQUFCQkJDQ0NERERFRUVGRkZHR0dISEhJSUlKSkpLS0tMTExNTU1OTk5PT09QUFBRUVFSUlJTU1NUVFRVVVVWVlZXV1dYWFhZWVlaWlpbW1tcXFxdXV1eXl5fX19gYGBhYWFiYmJjY2NkZGRlZWVmZmZnZ2doaGhpaWlqampra2tsbGxtbW1ubm5vb29wcHBxcXFycnJzc3N0dHR1dXV2dnZ3d3d4eHh5eXl6enp7e3t8fHx9fX1+fn5/f3+AgICBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmKioqLi4uMjIyNjY2Ojo6Pj4+QkJCRkZGSkpKTk5OUlJSVlZWWlpaXl5eYmJiZmZmampqbm5ucnJydnZ2enp6fn5+goKChoaGioqKjo6OkpKSlpaWmpqanp6eoqKipqamqqqqrq6usrKytra2urq6vr6+wsLCxsbGysrKzs7O0tLS1tbW2tra3t7e4uLi5ubm6urq7u7u8vLy9vb2+vr6/v7/AwMDBwcHCwsLDw8PExMTFxcXGxsbHx8fIyMjJycnKysrLy8vMzMzNzc3Ozs7Pz8/Q0NDR0dHS0tLT09PU1NTV1dXW1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/g4ODh4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7////isF19AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAaRklEQVR4nO2dCXwURb7HJxBYhIhyCBFEXV+QSyArZFklCwZXiEc4gyAEEwhHQiBEEGNwQTELuoogIcRACAQfGIFw9j51Re77FHcRzHo8HuJjZTJ3kslFavuorq6ZqenqSXomM0z/Pjr8+59//v3vb7o7narqKh3QJCtdUxfg79IAUaQBokgDRJEGiCINEEUeAjo8TyXlwoSvqJXwZyHfAbXyfdQwQEV7StXRTJgwWaV8y78V8hUw6uS7mqoBkpUGiCINEEUaIIo0QBRpgCjyKqD1l+kxygEVDu4x8ig1ygNAy/r3mnyJFuRNQAe6X6QHKQZ0pPueSzPHUPMpB/RZ/2MXnn2DFuVFQBMf6aImoLUvlpbu70HNpxzQhoXsSTSNFuXVS+xhNQF9c4GFNJKaz5N70JlPYopoMYEDiNVHfXdRYzwBtOnJPxyixQQQoHPxQ7+g5/Pst9hfRtEiAgfQ5acyrirYp3JAb68uLd01kBYVOIDynlOwR08A5T918EJiEi0qcABldGHVi5rPg0vsz4/3nnSOFqQ9SVOkAaJIA0SRBogiDRBFGiCKGgwoPlEdzYAJn1Yp37MioPEqJWwooIRUTjNSkWbgNtU9U7TnwoTD+a1Zs1BEyvQUZCtxQ3ukCGiKSyUzG1TgKw0EdIH/xyJ5zJiNm2ai22aCRrrDv5XVKKJGX4fsqipk1uprkF1tR2adHn7nOhHQNy4FWskFkuu2wgLrNEAaILFAnwLacNTMyWBGKiuTbLrbILrTYMLZgtuIIkx6KdqIuzGb4M75p5DvoxMuleC7x0w3bligQfwJamcQ0C4xcoEaILFADRCnJgF0as6kxbcAuDzn5YLb0KUBwvTrhFJ77lJQN/Ub+2uHoE8DhOnQMgB+ngQuLATg2JvQpwHCZLcBcHgx+DwHgGuzudKvXLmy5mwtJ3MtkgmzcdNEdFuM0BD/FpvLb5VXogi7vhrZFRXIrNLbkV0puav18Ds/uizkW3/RpUALuUBy3WKBVRl0QKyOJl4F2wvYqy2B3bg5YMCA5IN6dTQb7iFFpXyr/iHkyzuiTr5/iz9BOUDW7HnXAPhsDXsGpWhnkKtqMgrr2X8uvA7AyTehT7sHYTqSJYQm/nh7yQHo0wBhKoxjNRmAq+mz+FOJkwaIIg0QRRogijRAFGmAKCo8ZuVksCIZcJvqNpZBA7Uo8lsmM4ow6y2Sjbsx24RMi+heI7YonnKpxOhJgQZYoElrUdQuMbFADRAnDZB/AjrBVbWAfaDOhw4NkINuTKhgPxOsNTVi0RogXO/Gx7GA7AmYSwPkqHEsoP9NmDsp2wgdGiBHcYC+W26o++AdduPXmJiYWYfKOOnLkPS4TXUjW2xRTHUb4SRyQuT9UGxRPOpSCTm3Oze0f1XSoigA4lQ6gYObk5Pz5olyToZyJIMRszHTQHSbRHsO3EMav2W2oAir3oZsC+62Sm4z5oYhufBJOv+0wgKNbtzQtsxTDKi0FIAfxfuQdok5igN0fOqvt1eLEyVogBzFX2I7pyeugpeaBogmDRBFGiCKghuQaUM2+KYOyCmoAV3v3VkHBvW5BmS08ZSdk8mOZDRKNt1tNkBDfA6aw29ZbCiiXF+BbJvkrtCXS24r5oYha+Fz0LpzLpVgNm66ccMCywnPQc9PrgsFN4aOkQV0poaTuQbJZJJsuttihAbqeua3bBUoolJfhewKyW3XV0oh5cis0sMQset53QWXSjAbN924YYF2Qtfz3WdBKABf3SsHKKgvsQeOcoA+6wZkFNSAZsaYQsGV7mlARkENyBzTQhceMrYCyCioAQFwetOuf+HbQpOrNohTrGH+NACiXpX2LjS5aoM4RWV1LgJgfddXkENoctUGcYr67Vbus7iL5OH/mkeDOE2ZrIK567njSe7zbAcnQGgQZ1lCQsK8IyZOZSakMtymug2iLQJKFdxGFGHUS9FG3I3ZBic3YzKtRm/7uFRiwGx63XD3ZQRAL45gTy9r3FgnQGgQJye/vMQYxjeX2K3+bQY92bbHL5KHB+T3gzgZXwECt//n3eydtZiDB+T3gzh9B8j+Ay/Mwze5+vkgTsZngHa00vECMgpqQI9MLOX7zICM/A8Q4ztArb4FVAU1oN47AVWbztVxMtchmTAbN01Et9UIDdRgxm+V21FElb4G2ZWVyKzWVyHbXoG5eUB1dfniuxpfuxRoIRdIrtsCC6wmNJjt6rr874dZyQEqFLqe8W5bzMbdBqJb5a5nBsql65leoNGNW6brORRKDpCfXWIiIK3bx48A6aOcPbj8CRAjyTeALkV1ZNW6N5CRHwFifA5oyNCP7y3a8tB3wEl+OojT94DCDoFxfwMl44GT/HQQp+8B3XcALHoPXMfbgzj56SBOxveA4mJ+2hZlKrgfOAoN4rTv37///dNVnExVSEbMxk0j0W0W3eKD4hx+y1qOIir0lci22TB3BbLLObcDoKqqPLFn9bxLgWZygW7qNsD9EZ6Dvu+1wt6/pW6ZEyA0iNOPXgtnnOSr18LrgW3fCUAQP4jztsViKThfz8lSj2TGbNw0E902EzTQJcZvVVahiGp9LbLtdmTW6KuRXeXMh6mvz4eX2PpLLgVayQWS67bCAmudL7GvJDnD8btBnC581LwHwXwu96AwViE6XXNd68eAo/xtEKcrHjUBMe4AsdrbbW9F7eHuu4CT/GsQJ4mPeoAYOUD9eDRMPyCjpgZExKMSIId8JED3HOU+j/v1+CCvAXLORwI0/Bk2lXX4CCCjJgXkho7PAH1/f7sRI9p1+R7IqAkBucfTWECkfMTmjoqCjAUbKoGcmmyiSTk8DNOgiSa5b3ObjzjRpGu/mIsafAZxPxX2w2YSfkAenkHyeBp4Bsnma0y/mJRFOGgGHoTwH74Xxs3BeQSIBsdDQErSuQGktF9M0S4o+1cMSGlCBYA8KrAx/WINYuK0fwWAlKfbu9kNIHgGewZHKNCTfjHnMYoe7oy4fwoghXn2rc6cFftghxb3OQJSo0ASIDf9Yi5jFNXYvxtAir57X9Gm9z/ImjjwkXvYG2ZIl6fHJ7/lG0Bu+sVcxiiiQsnJd5SUcP/sLt67Y2dxSTGrTwqLeW3d9PGWgq2bigoqHQBRy939yeb897IXz5s6KW5Q5KPt7+J/lbR6/OlxM97eJB5QgwFtLy7evqmgIO/DVcvfWrIoa+HcpPFjnzvvSb8YGqMI24O+D/tNy9CwFlyRobqGaZ1De9AabuxjZkYaq9mJiYkvxsfHxj4THf37yL7dI7qGt28lfV9Y177RQ8cmZP555arNu/GjdGgPKuMypU3j1zZ4aUJ8fPyY+FFxscOHxw6NZhUVGdkzIuLhbhFdOod14FswnNSqw73hO13bg1iJj1BOgJwnmvyR3e90buezuSJmpU1LmzY9MWX6tLS0GWm4FqSlpc9Pz0x/bf78rMzCwszMha+xHN7KzMrMvOjQojgEq655WNi9bTt0i4joF/l4ZHT003Hx4xNnpmUuyv7q4MXrci2AWIviSSHVXWGC2rUPDw+/P4JTz16PRUY+ER39zFMjYmNHxr8UPzlxRtqCzIzM17Ozl61aXVCw+ePiTzng5BZFsUgnQGiMorfapH+++sv1Gzdv3rR61CYtqFIPW7OxNunKSi+1SX/H6p9bHlznBMjvxygKYHzW9fxVqNXR4fdjFHn5DtDlZlVOHnyM4t/h+iXYUia4TXXPEm2xDXeu4JaWXUmZgdlu3LMIbvii5GdqFfiRK6DLnI4/38sZWXDL5Sbd6YumK8YfhQEShlY1XSn+KfweVLYiOTVPI+QoDNDXbTuNHhceLttgFnzCAP3xefZvpMoXhjddMf4o/LVwvtvnxD1NVYp/CgP0ON8etKePXPgnSWnqSHxQHKlSvvFwYNzHU9XJN3u+K6DDEXvM5j1dc4GMgncRSOkP6i5ARsEL6LQkDVCp3DKilHHSwQxI0TjpYAbkbpy0BgjK3ThpjwFdepceoxzQsC5duqRRozwAdPiFnnEXaEEkQG7GSXsOaHoUPUY5oN7nLl++Qo1SDujqoKJvUzOpUQRAbsZJewyocIiagC71oScr9QTQ1mdLSy+fokWRALkZJ+0poFN/3K4moM97R/eMpx6PB4DenzgpKuk8LYr8a97tOGkPAH03eusXagLaPeHklZdfouZTDmhx180Xk6bQory33vxf55aqCojTnu7UEOWA/vpMaeleakLvAUp69NGIBx49TQtTDGjv3tLSv9HvQ8oBFbGA/taDFuU9QKxUPYPWRx65kjyLmk85oMs9d11NTqJFBQ6g0qUD+k69SI3y4Dlo2+DHXvL8Ju3+XQ3PASlRwD1Ju39XQwMkyt27GhogKEXvagQzIEXvagQzIEXvagQzIEXvagQzICXvanz6skpaChNOVSvhVSHfVrXy/YUASMmU7cuKOK0rQsrHbNzMJ7rXfwQNcQjeeH6roBBFFK7diOwNG5C5cS0WQnCnimfQu0oLdOOGBW4kDKBSMmV7UI8wUzJle1ADUjJle1DPaa9kyvaNJys5GSuRjLhNdZsN0EBTdPFbFhuKsOkrkG21IrNcj4UQ3OKqCPlnXSoxeVKgCRZoIwwD1qZsB9qU7ZjZkGHALlO2uyioAcXyn6ZxQEYBAYjxBiDbihW6FZxmSx2Hp+ZMWnwrACf99wqgW9HROu5toeghG8TYXyeU2nOXBuCk/14BxGogcNShZQD8PCkAJ/1nGO8Acl42wm4D4PBi6YW6cvZPlGzhOchEfp6gu33yHMQwDpVgNr1Auecgl2UjADiaeFV6oS5g1lllGO+ss+qybIQ1e961QJj0n5MvLjHnZSNqMvi3oALvhTpvAXJeNuJIlhAacC/UeQuQ87IRhXGsJvv9pP+C4fRauHf+1HBdNsJFwQ3oTlkl01uA7pgmV28BumOaXL0FSEmTa5NN0WXSYzbBjU/RxQJSMkWXbIGkKbrumFUyvXUG3TFNrt4CdMc0uQoT5qACtSZXTj4BZMlJmb7ShDmEZUT9dNJ/4Th8CejbDp1Gj7u//WXJwy8j6q+T/gvH4UtAMdxr4faRMcghLCPqp5P+w+NwB0gipOKyEce4z5NtJQ+/Qh2a9L/mypUra87WcjLXIpkwGzdNRLfFCA3U9cxvlVeiCLu+GtkVFcis0tuRXSm5q/XwO8Wu5/UXa2t5QFKBFnKB5LrFAqsIXc/hJdzn7v5OgPxx0n9X4ZP+M8IsW40SaYqu9V1KyspKun1WV1eHA+LET/pffebMmVVeGryAjUxo/OAFYeI3VIlqgxc6NhPfDH8YB+R/k/4rugehm5B69yDpxfCvRRcHyN8m/W86QFl8OcZkySNcYv416T9oOkD9+pwFoCQ8YNYX4+RTQLXL2ywcc3fObSCjoAYEwGKdrhjIKoAAiYTUA/TjnzptXxM2y3mqUgcFNaC7phgA+GGI7OwvhceULmxPdhvhevdW1KLIb5nMKMKst0g27sZsEzItonuN2KJ4ymqFgMS9Gz0p0AALNBFaFD/nP+tXywEK6jNIiQIJECSkEqDYqwD8/1uscT6QFqL1ISDdaZYNt3E+0JZTFwwM0LKJvgPEtygG2hjF1PscTiFvAuJbFANujOJOXb6PAAktigE3RtHSIslXZxD/xyoao8gpEACBqO74NaYWoJj4+GG6eO5DiuYBBd4YxVdC1kNAcoMR3bjdjVEcLckJEBqjaM3JyXnzhLDIPXm9e9xtILpNoo1GuZaXM+XlZguKsOptyLbgbqvkNmNuGJIrjnI9XV6+reUUCEimQKMbN7QthFGuBHGAvD5GkVH9OWjwA+pfYmRxgLw+RlF9QH/WfSAR8jogr49RZA9DZUB72j3nI0Au8g4gRu0/NUa32aUB4uUG0Ie6RegU0gDxcvpj9cGBdxYgrCtdHUBpIWubBtDGU3ZOJjuS0SjZdLfZwH4w7P/ic9AcdpMTiijXVyDbZkNmhb5cclsxNwwR3/ZZd45PuLPDYHgK2Y3Y7nHTjdsAy1D2HOQKSI3VoRjH1aH448CWgZJWhypv0OpQfMLUkDxISL3VoZRIjUvMeQk/b1xizM57YiGgwLsHEQEhRmq1KI5tvQPmDTRAjG8A5TebEJiAGB8BYsY3z3NI7FygeoBUHcTJuAckHIlqgHbe97iPAKk6iNN3gJiFuixnQl4BpOogTkYWEPcF9QDt+127T30BCA3itCxbtuyN4zZOBhuSAbdpblg6a4ldz2nICb9i0VtRuNmMTIveItmS2yq616AGM2k3G1qOknboUqCRWLexDO5a+XMQGsRZlpCQMO+IiVOZCakMt2luWC9riYBSkRN+yaiXvtFolEw9Zhtc3avR2z7SbpjJIdnSHhXWDXdfRuiblxE/iJNToy4x/Epyt5SxOrO/wGR7+t69weEi88olpt4gTiWAGEaV6XFgrq0d/2snTsgrgFQbxMkoA4TdUxsxfxBMtbLl4N1YUu/8mldnEKcTATlAiFBjJliCqRY2H4wl9eMnafz4F1ygLacOv9ioGahgqld0CVJSvwWEH/yW2JDZ9PXm+S+qAYgZrxu+R8zpr4CwA9+d2qbVtNt0QDyiRs5hBhPNbj5oG0zpfUCbztVxMtchmTAbN02SjR11eseQIf/NsD70rgZrJn5KRlRXWYlyVOurkG2vwNx2wcgX3/b5GqsE5lnUqutqwcILJNdtMcLEhHc1lKhQeJLGn0Lxx1CSGzt75nfTPfkh4/wkPapFu5jX9hERNfBJGlUC0+R1C00WfpmRn6Rx0/MnaQd5fIlJB1s0oZ1uwBLx6sEvsYJnH9a1/VPKJndXGqeGThMoJNkZG9J5kUM+/7gHSYe5PT0q9Dd/WikdtNM96N1RnZs16z4th3Qi8XENn0dRSLK6n67HchxR0wNCB7hvbeqTrUJ6JH2CH7LrTbo4LSpU1zV69po9JEiNmWhSSLHoEV2f13YgQk0MCB3ZurRnOupCIiYWOJ0SxN9i2xcPi2imaxkxan7OJwxB8Hs8n4lT+EHNj9C1evqt3UImFQF5OogTHs221fPi+t+rC3kwdsl26RjddRwiFWcnRnfU6UI6DoxLWbJ5O+OiBk5Vyn9v3ov36VpHTV/JQVINkAeDOPkituYuzZgyom97nU7XKWrsGw4XlvueVUcV/XXemP7hzdkUYd0HvfDitCXv5zs/CngKCNa3b+XE3qG6lj2eS12+eR/hj/wGAKIN4vy38Vr+yuysjJmTxwyL6nl/S+6dzlYP/iF+3jLIhtb1DPjxQQRMu/KyMibF9Hvgbj5ns7AufQZEPzNmYlLawiXZq1at31S8Q2LlwWS3TMnyqYPDQ3S6Fl37DYuf8ernZy7dQje4BgBCgzjt+/fvf/901fUXx0U/GRkZGRHxQPh9YS3REsghYZ0iBgyJS1rwTt4t+Z7VKseeVVbWcmLPqkhqb+HKNxdMnxL3x6jHfhveVtolqzZh94SHRzr2rDru0k3P6s0jW6c+PyiifXMhT2hY524RvYbFjh41JTk55aQnPatoECd8Lfwf/aOHDn165MgxLyemp2cufmdlYVHJFycu/ejZa9eNeS382r/OH/mypGRj4YcfvL34jfT0aRmOr4V7ptLTn20r+GBpZvrLk0eOHDo0qn//Rx/aTHwt3I3QIM7bFoul4Hw9J0s9khmzcdNMdNtM0ECXGL9VWYUiqvW1yLbbkVmjr0Z2leSu1cPvzIeX2PpLLgVayQWS67bCAms9uAcF3ESTQP4eBE31fos5DOLccobToTNIBzEbNw8S3YcPQEM8g5P4raMnUMSJL08h+/hxZJ78Egs5hsxTonuxCKhYaYFu3LDAkx48B+GDOP8Jl0yRljJZkCnZmPu1+UT3onnQ+BIm/FhYB0VajWV1cp607orkzk3OIbnzkz+All7I943LLl95nVjJq68S3a9nQEM8JTx8knZV6qtE98IUontpAtGN6fyAH0ju7wZcIrl/GXCMlnB6FtGdMZfoXpzk5NAAOUoDJMpngPQGotugJ7qNv9LyVd2oIbmrb1ST3HU37CQ3rlvkAsvKiG6Dc4GNBnSnSwNEUaMBwcU3nIQ3kVCDFcSonU95wsYCgotvOMmhiYQWrCBG7XweJGwsILj4hpMcmkhowQpi1M7nQcLGAoKLbzjJ4T1XWrCCGLXzeZBQhZs0t/iGk1ATiZJgBTFq5/MgYWMAfZGaehEuvuEkh7U4MBGDFSRUO58HCRt7BsHFN5zk0ERCC1YQo3Y+DxI2FtAR4oO8QxMJLVhBjNr5PEjYWEDi4htOwptIqMEKYtTOpzyh9iRNkQaIIg0QRRogijRAFGmAKNIAUeQvgOxZv2v925R/ywdV6aSG6Vs2L1cE5SeAKvs+kvtVQc++squegNpX0epwIHqFt2sS5CeA3nyIa1q/FVYgF+RAL7gA1YcJb8vs+Dv3Wlr4/ZP1YGQ8u53bseb7UZ3uHnqJm2Rt+EjuEoPbA3W6WGCZ9WDbF372bmn+Aegn3UXRrI/6/aFDv48CW9vYARiaDnrFHDg4JIot9IktP3OAxG3uDBr21JGzk3qb5DI3Wv4B6KDupmgeav5/AFxrfsTaai+42exC/YqfAPi4I1vocv4mjbZZQKdbsGzqOm+Qy9xo+QegH+AZpP8e5EVwxiP5YGwSyO3D/nrb9sa4dhygL4TfYuI2C2iTLpSV7m2vluYfgG7ftYb/d/RgsJYHFJELPu1QO+Q9YIsc+B5TxAE6zgNC2yygXeE+KM0/AIEFXbmu6p/avA0OhrJ33euhh0B56y0tfgH7WhoB2CIBQtssoNKQKwDcGPSNVyvzE0C2iG65B3MfiigH9QOfOH7siYH1AIzvOAKAE7oN13c+1FovAkLbQ9JMYOyjnx8Y2kd+4dPGyk8AAeu83ndFpHCnkX5S5/DJnFGi41bnXhbePv67XlEiILS9ocNYUJH6wL2jZZc9bbz8BZDfSgNEkQaIIg0QRRogijRAFGmAKNIAUaQBokgDRJEGiKL/AOBTCznHwStoAAAAAElFTkSuQmCC" /><!-- --></p>
</div>
</div>
<div id="spatial-factor-multi-species-n-mixture-models" class="section level1">
<h1>Spatial factor multi-species N-mixture models</h1>
<div id="basic-model-description-4" class="section level2">
<h2>Basic model description</h2>
<p>Our final, and most complex, N-mixture model that we fit in <code>spAbundance</code> is a multi-species spatially-explicit N-mixture model. This model is nearly identical to the latent factor multi-species N-mixture model, except we give a spatial structure to the latent factors instead of assuming they are independent from each other. By modeling the latent factors with a spatial structure, we will often see such a model have improved predictive performance relative to a latent factor multi-species N-mixture model <span class="citation">(Doser, Finley, and Banerjee 2023)</span>. This model again is an abundance-based JSDM, but now it simultaneously accounts for imperfect detection, residual correlations between species, and spatial autocorrelation. This is a direct extension of the spatial factor multi-species occupancy model presented in <span class="citation">Doser, Finley, and Banerjee (2023)</span>.</p>
<p>The model is identical to the previously described latent factor multi-species N-mixture model with the exception that the latent factors are assumed to have a spatial structure to them. More specifically, our model for species-specific abundance is again</p>
<p><span class="math display">\[\begin{equation}
\text{log}(\mu_{i}(\boldsymbol{s}_j)) = \textbf{x}(\boldsymbol{s}_j)^\top\boldsymbol{\beta}_i + \text{w}^\ast_{i}(\boldsymbol{s}_j).
\end{equation}\]</span></p>
<p>Note again that for spatial models we use the notation <span class="math inline">\(\boldsymbol{s}_j\)</span> to make it clear that the model is spatially-explicit and relies upon the coordinates (<span class="math inline">\(\boldsymbol{s}_j\)</span>) at each site <span class="math inline">\(j\)</span> to estimate this spatial pattern. As with the latent factor model, we decompose <span class="math inline">\(\text{w}^\ast_i(\boldsymbol{s}_j)\)</span> into a linear combination of <span class="math inline">\(q\)</span> latent variables (i.e., factors) and their associated species-specific coefficients (i.e., factor loadings) according to</p>
<p><span class="math display">\[\begin{equation}
    \text{w}^\ast_{i}(\boldsymbol{s}_j) = \boldsymbol{\lambda}_i^\top\textbf{w}(\boldsymbol{s}_j).
\end{equation}\]</span></p>
<p>Now, instead of modeling <span class="math inline">\(\textbf{w}(\boldsymbol{s}_j)\)</span> as independent normal latent variables, we assume <span class="math inline">\(\textbf{w}(\boldsymbol{s}_j)\)</span> arise from spatial processes, allowing us to account for residual correlation in species-specific abundance. More specifically, each spatial factor <span class="math inline">\(\textbf{w}_r\)</span> for each <span class="math inline">\(r = 1, \dots, q\)</span> is modeled using a Nearest Neighbor Gaussian Process <span class="citation">(Datta et al. 2016)</span>, i.e.,</p>
<p><span class="math display">\[\begin{equation}
    \textbf{w}_r \sim \text{Normal}(\boldsymbol{0}, \tilde{\boldsymbol{C}}_r(\boldsymbol{\theta}_r)),
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\tilde{\boldsymbol{C}}_r(\boldsymbol{\theta}_r)\)</span> is the NNGP-derived correlation matrix for the <span class="math inline">\(r^{\text{th}}\)</span> spatial factor. Note that the spatial variance parameter for each spatial factor is assumed to be 1 for identifiability purposes. The vector <span class="math inline">\(\boldsymbol{\theta}_r\)</span> consists of parameters governing the spatial process for each spatial factor according to some spatial correlation function, as we saw with the single-species N-mixture model. Thus, for the exponential, spherical, and Gaussian correlation functions, <span class="math inline">\(\boldsymbol{\theta}_r\)</span> includes a spatial decay parameter <span class="math inline">\(\phi_r\)</span>, while the Matern correlation function includes an additional spatial smoothness parameter, <span class="math inline">\(\nu_r\)</span>.</p>
<p>We assume the same priors and identifiability constraints as the latent factor multi-species N-mixture model. We assign a uniform prior for the spatial decay parameter, <span class="math inline">\(\phi_r\)</span>, and the spatial smoothness parameters, <span class="math inline">\(\nu_r\)</span>, if using a Matern correlation function.</p>
<p>Notice that this spatial factor modeling approach is the only approach we implement in <code>spAbundance</code> for modeling multi-species datasets while accounting for spatial autocorrelation. While we could envision fitting a separate spatial random effect for each species in our multi-species data set (as we implemented in <code>spOccupancy</code> in the <code>spMsPGOcc</code> function), we prefer (and recommend) using the spatial factor modeling approach as (1) it is far more computationally efficient than fitting a separate spatial effect for each species; (2) it explicitly acknowledges dependence between species; (3) estimatinga separate spatial effect for each species would be very difficult to do with multiple rare species in the data set; and (4) even if the species are independent (i.e., there are no residual correlations), the spatial factor modeling approach provides extremely similarly to a model with a separate spatial process for each species <span class="citation">(Doser, Finley, and Banerjee 2023)</span>, while still being substantially faster.</p>
</div>
<div id="fitting-spatial-factor-multi-species-n-mixture-models-with-sfmsnmix" class="section level2">
<h2>Fitting spatial factor multi-species N-mixture models with <code>sfMsNMix()</code></h2>
<p>The function <code>sfMsNMix()</code> fits spatial factor multi-species N-mixture models in <code>spAbundance</code>. The arguments are very similar to <code>lfMsNMix()</code> and <code>spNMix()</code>.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true"></a><span class="kw">sfMsNMix</span>(abund.formula, det.formula, data, inits, priors,  </span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true"></a>       tuning, <span class="dt">cov.model =</span> <span class="st">&#39;exponential&#39;</span>, <span class="dt">NNGP =</span> <span class="ot">TRUE</span>, <span class="dt">n.neighbors =</span> <span class="dv">15</span>, </span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true"></a>       <span class="dt">search.type =</span> <span class="st">&#39;cb&#39;</span>, n.factors, n.batch, batch.length, <span class="dt">accept.rate =</span> <span class="fl">0.43</span>, </span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true"></a>       <span class="dt">family =</span> <span class="st">&#39;Poisson&#39;</span>, <span class="dt">n.omp.threads =</span> <span class="dv">1</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>, <span class="dt">n.report =</span> <span class="dv">100</span>, </span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true"></a>       <span class="dt">n.burn =</span> <span class="kw">round</span>(.<span class="dv">10</span> <span class="op">*</span><span class="st"> </span>n.batch <span class="op">*</span><span class="st"> </span>batch.length), <span class="dt">n.thin =</span> <span class="dv">1</span>, </span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true"></a>       <span class="dt">n.chains =</span> <span class="dv">1</span>, ...)</span></code></pre></div>
<p>We will again fit the model with three spatial factors, and will use the same covariates/random effects on abundance and detection as we have done throughout the vignette</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true"></a>n.factors &lt;-<span class="st"> </span><span class="dv">3</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true"></a>abund.ms.formula &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw">scale</span>(abund.cov<span class="fl">.1</span>) <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>abund.factor<span class="fl">.1</span>)</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true"></a>det.ms.formula &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span><span class="kw">scale</span>(det.cov<span class="fl">.1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale</span>(det.cov<span class="fl">.2</span>)</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true"></a><span class="co"># Just a reminder of the data format for fitting multi-species N-mixture models.</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true"></a><span class="kw">str</span>(dataNMixSim)</span></code></pre></div>
<pre><code>List of 4
 $ y         : int [1:6, 1:225, 1:5] 0 0 1 0 0 0 0 0 0 0 ...
 $ abund.covs: num [1:225, 1:2] 0.2863 -0.0325 -0.9897 0.2118 -0.972 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : NULL
  .. ..$ : chr [1:2] &quot;abund.cov.1&quot; &quot;abund.factor.1&quot;
 $ det.covs  :List of 2
  ..$ det.cov.1: num [1:225, 1:5] 1.577 0.6956 -0.3031 0.107 0.0284 ...
  ..$ det.cov.2: num [1:225, 1:5] -1.235 -0.509 -2.012 -0.899 0.38 ...
 $ coords    : num [1:225, 1:2] 0 0.0714 0.1429 0.2143 0.2857 ...
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : NULL
  .. ..$ : chr [1:2] &quot;X&quot; &quot;Y&quot;</code></pre>
<p>Initial values are identical to what we saw with <code>lfMsNMix()</code>, but we will also specify the initial values for the spatial decay parameters for each spatial factor (we use an exponential correlation model so we do not need to specify any initial values for the <code>nu</code>, the spatial smoothness parameter used when <code>cov.model = &#39;matern&#39;</code>.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true"></a><span class="co"># Number of species</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true"></a>n.sp &lt;-<span class="st"> </span><span class="kw">dim</span>(dataNMixSim<span class="op">$</span>y)[<span class="dv">1</span>]</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true"></a><span class="co"># Initiate all lambda initial values to 0. </span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true"></a>lambda.inits &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, n.sp, n.factors)</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true"></a><span class="co"># Set diagonal elements to 1</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true"></a><span class="kw">diag</span>(lambda.inits) &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true"></a><span class="co"># Set lower triangular elements to random values from a standard normal distribution</span></span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true"></a>lambda.inits[<span class="kw">lower.tri</span>(lambda.inits)] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">sum</span>(<span class="kw">lower.tri</span>(lambda.inits)))</span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true"></a><span class="co"># Check it out.</span></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true"></a>lambda.inits</span></code></pre></div>
<pre><code>           [,1]       [,2]       [,3]
[1,]  1.0000000  0.0000000  0.0000000
[2,]  0.8485111  1.0000000  0.0000000
[3,] -1.4815045 -0.9902427  1.0000000
[4,] -0.4653827 -0.8855075 -0.4770615
[5,]  0.4225126  0.7458621  0.8979869
[6,]  1.0317890  1.6780548  1.4109998</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true"></a>w.inits &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, n.factors, <span class="kw">ncol</span>(dataNMixSim<span class="op">$</span>y))</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true"></a><span class="co"># Pair-wise distances between all sites</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true"></a>dist.mat &lt;-<span class="st"> </span><span class="kw">dist</span>(dataNMixSim<span class="op">$</span>coords)</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true"></a><span class="co"># Exponential covariance model</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true"></a>cov.model &lt;-<span class="st"> &#39;exponential&#39;</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true"></a>ms.inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">alpha.comm =</span> <span class="dv">0</span>,</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true"></a>                 <span class="dt">beta.comm =</span> <span class="dv">0</span>,</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true"></a>                 <span class="dt">beta =</span> <span class="dv">0</span>,</span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true"></a>                 <span class="dt">alpha =</span> <span class="dv">0</span>,</span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true"></a>                 <span class="dt">tau.sq.beta =</span> <span class="dv">1</span>,</span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true"></a>                 <span class="dt">lambda =</span> lambda.inits,</span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true"></a>                 <span class="dt">kappa =</span> <span class="dv">1</span>,</span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true"></a>         <span class="dt">phi =</span> <span class="dv">3</span> <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(dist.mat),</span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true"></a>                 <span class="dt">w =</span> w.inits,</span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true"></a>                 <span class="dt">tau.sq.alpha =</span> <span class="dv">1</span>,</span>
<span id="cb174-16"><a href="#cb174-16" aria-hidden="true"></a>                 <span class="dt">sigma.sq.mu =</span> <span class="fl">0.5</span>,</span>
<span id="cb174-17"><a href="#cb174-17" aria-hidden="true"></a>                 <span class="dt">N =</span> <span class="kw">apply</span>(dataNMixSim<span class="op">$</span>y, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), max, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<p>Priors are the same as with the latent factor multi-species N-mixture model, where we also add in our default prior for the spatial decay parameters, which allows the effective spatial range of each spatial factor to range from the maximum intersite distance to the minimum intersite distance. Notice the prior for <code>phi</code> is now specified as a list as opposed to an atomic vector as we did for the single-species case. If desired, the list format allows you to easily specify a different prior for each of the spatial factors. See <code>?sfMsNMix</code> for more details.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true"></a>max.dist &lt;-<span class="st"> </span><span class="kw">max</span>(dist.mat)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true"></a>min.dist &lt;-<span class="st"> </span><span class="kw">min</span>(dist.mat)</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true"></a>ms.priors &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">beta.comm.normal =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">var =</span> <span class="fl">2.72</span>),</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true"></a>                  <span class="dt">alpha.comm.normal =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">var =</span> <span class="fl">2.72</span>),</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true"></a>                  <span class="dt">tau.sq.beta.ig =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="fl">0.1</span>, <span class="dt">b =</span> <span class="fl">0.1</span>),</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true"></a>                  <span class="dt">tau.sq.alpha.ig =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="fl">0.1</span>, <span class="dt">b =</span> <span class="fl">0.1</span>), </span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true"></a>                  <span class="dt">sigma.sq.mu.ig =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="fl">0.1</span>, <span class="dt">b =</span> <span class="fl">0.1</span>),</span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true"></a>                  <span class="dt">kappa.unif =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">0</span>, <span class="dt">b =</span> <span class="dv">100</span>),</span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true"></a>              <span class="dt">phi.unif =</span> <span class="kw">list</span>(<span class="dv">3</span> <span class="op">/</span><span class="st"> </span>max.dist, <span class="dv">3</span> <span class="op">/</span><span class="st"> </span>min.dist))</span></code></pre></div>
<p>We lastly specify the tuning values and run the model for 20,000 iterations with a burn-in of 10,000 samples and a thinning rate of 10, for each of 3 chains, yielding a total of 3000 posterior samples. As before, we will use a Poisson distribution and 15 nearest neighbors.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true"></a><span class="co"># Specify initial tuning values</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true"></a>ms.tuning &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">beta =</span> <span class="fl">0.3</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>, <span class="dt">beta.star =</span> <span class="fl">0.5</span>, <span class="dt">kappa =</span> <span class="fl">0.5</span>, </span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true"></a>          <span class="dt">w =</span> <span class="fl">0.5</span>, <span class="dt">lambda =</span> <span class="fl">0.5</span>, <span class="dt">phi =</span> <span class="fl">0.5</span>)</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true"></a><span class="co"># Approx. run time: ~10 min</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true"></a>out.sf.ms &lt;-<span class="st"> </span><span class="kw">sfMsNMix</span>(<span class="dt">abund.formula =</span> abund.ms.formula,</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true"></a>                      <span class="dt">det.formula =</span> det.ms.formula,</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true"></a>                      <span class="dt">data =</span> dataNMixSim,</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true"></a>                      <span class="dt">inits =</span> ms.inits,</span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true"></a>                      <span class="dt">n.batch =</span> <span class="dv">800</span>,</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true"></a>                      <span class="dt">n.factors =</span> n.factors,</span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true"></a>                      <span class="dt">tuning =</span> ms.tuning,</span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true"></a>                      <span class="dt">batch.length =</span> <span class="dv">25</span>,</span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true"></a>                      <span class="dt">priors =</span> ms.priors,</span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true"></a>              <span class="dt">n.neighbors =</span> <span class="dv">15</span>,</span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true"></a>                      <span class="dt">n.omp.threads =</span> <span class="dv">1</span>,</span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true"></a>                      <span class="dt">verbose =</span> <span class="ot">TRUE</span>,</span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true"></a>                      <span class="dt">n.report =</span> <span class="dv">200</span>,</span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true"></a>                      <span class="dt">n.burn =</span> <span class="dv">10000</span>,</span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true"></a>                      <span class="dt">n.thin =</span> <span class="dv">10</span>,</span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true"></a>                      <span class="dt">n.chains =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>----------------------------------------
    Preparing to run the model
----------------------------------------
----------------------------------------
    Building the neighbor list
----------------------------------------
----------------------------------------
Building the neighbors of neighbors list
----------------------------------------
----------------------------------------
    Model description
----------------------------------------
Spatial Factor NNGP Multi-species Poisson N-Mixture model fit with 225 sites and 6 species.

Samples per Chain: 20000 
Burn-in: 10000 
Thinning Rate: 10 
Number of Chains: 3 
Total Posterior Samples: 3000 

Using the exponential spatial correlation model.

Using 3 latent spatial factors.
Using 15 nearest neighbors.

Source compiled with OpenMP support and model fit using 1 thread(s).

Adaptive Metropolis with target acceptance rate: 43.0
----------------------------------------
    Chain 1
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     48.0        0.24318
    1   alpha[1]    36.0        0.36277
    2   beta[1]     40.0        0.22003
    2   alpha[1]    44.0        0.39299
    3   beta[1]     36.0        0.24809
    3   alpha[1]    44.0        0.36277
    4   beta[1]     44.0        0.16301
    4   alpha[1]    36.0        0.21141
    5   beta[1]     48.0        0.18750
    5   alpha[1]    40.0        0.23836
    6   beta[1]     40.0        0.15351
    6   alpha[1]    32.0        0.24809
    1   phi     48.0        0.53625
    2   phi     48.0        0.56941
    3   phi     56.0        0.81616
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     28.0        0.24809
    1   alpha[1]    48.0        0.35559
    2   beta[1]     44.0        0.21568
    2   alpha[1]    48.0        0.36277
    3   beta[1]     28.0        0.25821
    3   alpha[1]    48.0        0.33488
    4   beta[1]     32.0        0.14457
    4   alpha[1]    28.0        0.18750
    5   beta[1]     28.0        0.19910
    5   alpha[1]    60.0        0.25821
    6   beta[1]     28.0        0.16630
    6   alpha[1]    36.0        0.26343
    1   phi     36.0        0.59265
    2   phi     32.0        0.62930
    3   phi     28.0        0.80000
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     56.0        0.23364
    1   alpha[1]    36.0        0.33488
    2   beta[1]     52.0        0.22448
    2   alpha[1]    48.0        0.33488
    3   beta[1]     28.0        0.25310
    3   alpha[1]    56.0        0.36277
    4   beta[1]     36.0        0.16301
    4   alpha[1]    36.0        0.22003
    5   beta[1]     40.0        0.18750
    5   alpha[1]    32.0        0.27418
    6   beta[1]     56.0        0.15978
    6   alpha[1]    56.0        0.25310
    1   phi     32.0        0.47561
    2   phi     64.0        0.70953
    3   phi     40.0        0.66821
-------------------------------------------------
Batch: 800 of 800, 100.00%
----------------------------------------
    Chain 2
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     52.0        0.24809
    1   alpha[1]    28.0        0.34855
    2   beta[1]     48.0        0.23364
    2   alpha[1]    24.0        0.35559
    3   beta[1]     40.0        0.24318
    3   alpha[1]    44.0        0.35559
    4   beta[1]     36.0        0.15351
    4   alpha[1]    28.0        0.20722
    5   beta[1]     36.0        0.20312
    5   alpha[1]    28.0        0.25821
    6   beta[1]     40.0        0.15661
    6   alpha[1]    28.0        0.26343
    1   phi     56.0        0.52564
    2   phi     32.0        0.73849
    3   phi     40.0        0.81616
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     40.0        0.26343
    1   alpha[1]    40.0        0.32175
    2   beta[1]     20.0        0.22003
    2   alpha[1]    52.0        0.39299
    3   beta[1]     40.0        0.29113
    3   alpha[1]    28.0        0.38521
    4   beta[1]     60.0        0.15661
    4   alpha[1]    48.0        0.20312
    5   beta[1]     40.0        0.18750
    5   alpha[1]    48.0        0.25821
    6   beta[1]     32.0        0.15978
    6   alpha[1]    48.0        0.25310
    1   phi     48.0        0.59265
    2   phi     36.0        0.60462
    3   phi     32.0        0.58092
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     36.0        0.24318
    1   alpha[1]    44.0        0.34855
    2   beta[1]     36.0        0.22901
    2   alpha[1]    36.0        0.39299
    3   beta[1]     60.0        0.27418
    3   alpha[1]    36.0        0.34165
    4   beta[1]     44.0        0.16301
    4   alpha[1]    24.0        0.20722
    5   beta[1]     40.0        0.18750
    5   alpha[1]    48.0        0.25310
    6   beta[1]     44.0        0.15351
    6   alpha[1]    48.0        0.25310
    1   phi     56.0        0.53625
    2   phi     80.0        0.59265
    3   phi     44.0        0.62930
-------------------------------------------------
Batch: 800 of 800, 100.00%
----------------------------------------
    Chain 3
----------------------------------------
Sampling ... 
Batch: 200 of 800, 25.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     64.0        0.21568
    1   alpha[1]    40.0        0.33488
    2   beta[1]     32.0        0.21141
    2   alpha[1]    36.0        0.34855
    3   beta[1]     28.0        0.26343
    3   alpha[1]    60.0        0.38521
    4   beta[1]     40.0        0.15351
    4   alpha[1]    24.0        0.20722
    5   beta[1]     56.0        0.18379
    5   alpha[1]    40.0        0.25821
    6   beta[1]     32.0        0.16301
    6   alpha[1]    40.0        0.25310
    1   phi     40.0        0.51523
    2   phi     32.0        0.59265
    3   phi     28.0        0.93881
-------------------------------------------------
Batch: 400 of 800, 50.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     40.0        0.25310
    1   alpha[1]    32.0        0.37010
    2   beta[1]     32.0        0.21568
    2   alpha[1]    36.0        0.37010
    3   beta[1]     44.0        0.26875
    3   alpha[1]    40.0        0.34855
    4   beta[1]     20.0        0.16966
    4   alpha[1]    36.0        0.20722
    5   beta[1]     48.0        0.20312
    5   alpha[1]    44.0        0.25821
    6   beta[1]     44.0        0.16966
    6   alpha[1]    32.0        0.26875
    1   phi     76.0        0.56941
    2   phi     48.0        0.62930
    3   phi     52.0        0.80000
-------------------------------------------------
Batch: 600 of 800, 75.00%
    Species Parameter   Acceptance  Tuning
    1   beta[1]     48.0        0.25310
    1   alpha[1]    28.0        0.31538
    2   beta[1]     24.0        0.22003
    2   alpha[1]    36.0        0.37010
    3   beta[1]     28.0        0.24318
    3   alpha[1]    48.0        0.37758
    4   beta[1]     32.0        0.16966
    4   alpha[1]    36.0        0.20312
    5   beta[1]     48.0        0.18750
    5   alpha[1]    40.0        0.26875
    6   beta[1]     36.0        0.15978
    6   alpha[1]    52.0        0.26343
    1   phi     48.0        0.52564
    2   phi     48.0        0.55814
    3   phi     36.0        0.81616
-------------------------------------------------
Batch: 800 of 800, 100.00%</code></pre>
<p>summary(out)</p>
</div>
<div id="posterior-predictive-checks-4" class="section level2">
<h2>Posterior predictive checks</h2>
<p>As before, we can use the <code>ppcAbund()</code> function to perform a posterior predictive check of our model</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true"></a>ppc.out.sf.ms &lt;-<span class="st"> </span><span class="kw">ppcAbund</span>(out.sf.ms, <span class="dt">fit.stat =</span> <span class="st">&#39;freeman-tukey&#39;</span>, <span class="dt">group =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>Currently on species 1 out of 6</code></pre>
<pre><code>Currently on species 2 out of 6</code></pre>
<pre><code>Currently on species 3 out of 6</code></pre>
<pre><code>Currently on species 4 out of 6</code></pre>
<pre><code>Currently on species 5 out of 6</code></pre>
<pre><code>Currently on species 6 out of 6</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true"></a><span class="co"># Summarize with a Bayesian p-value</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true"></a><span class="kw">summary</span>(ppc.out.sf.ms)</span></code></pre></div>
<pre><code>
Call:
ppcAbund(object = out.sf.ms, fit.stat = &quot;freeman-tukey&quot;, group = 1)

Samples per Chain: 20000
Burn-in: 10000
Thinning Rate: 10
Number of Chains: 3
Total Posterior Samples: 3000

----------------------------------------
    Community Level
----------------------------------------
Bayesian p-value:  0.6379 

----------------------------------------
    Species Level
----------------------------------------
sp1 Bayesian p-value: 0.434
sp2 Bayesian p-value: 0.546
sp3 Bayesian p-value: 0.4427
sp4 Bayesian p-value: 0.7867
sp5 Bayesian p-value: 0.7297
sp6 Bayesian p-value: 0.8883
Fit statistic:  freeman-tukey </code></pre>
</div>
<div id="model-selection-using-waic-4" class="section level2">
<h2>Model selection using WAIC</h2>
<p>We use <code>waicAbund()</code> to calculate the WAIC for all species in the data set, and compare the WAIC to that obtained using the non-spatial latent factor multi-species N-mixture model.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true"></a><span class="co"># Non-spatial latent factor model</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true"></a><span class="kw">waicAbund</span>(out.lf.ms, <span class="dt">by.sp =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>N.max not specified. Setting upper index of integration of N to 10 plus
the largest estimated abundance value at each site in object$N.samples</code></pre>
<pre><code>Currently on species 1 out of 6</code></pre>
<pre><code>Currently on species 2 out of 6</code></pre>
<pre><code>Currently on species 3 out of 6</code></pre>
<pre><code>Currently on species 4 out of 6</code></pre>
<pre><code>Currently on species 5 out of 6</code></pre>
<pre><code>Currently on species 6 out of 6</code></pre>
<pre><code>      elpd         pD       WAIC 
-1704.0036   191.2428  3790.4928 </code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true"></a><span class="co"># Spatial factor model</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true"></a><span class="kw">waicAbund</span>(out.sf.ms, <span class="dt">by.sp =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>N.max not specified. Setting upper index of integration of N to 10 plus
the largest estimated abundance value at each site in object$N.samples</code></pre>
<pre><code>Currently on species 1 out of 6</code></pre>
<pre><code>Currently on species 2 out of 6</code></pre>
<pre><code>Currently on species 3 out of 6</code></pre>
<pre><code>Currently on species 4 out of 6</code></pre>
<pre><code>Currently on species 5 out of 6</code></pre>
<pre><code>Currently on species 6 out of 6</code></pre>
<pre><code>     elpd        pD      WAIC 
-1716.774   172.300  3778.147 </code></pre>
</div>
<div id="prediction-4" class="section level2">
<h2>Prediction</h2>
<p>We can again use the <code>predict()</code> function to predict abundance at a set of new locations to generate a species distribution map or to generate a marginal effects plot. Here, we again predict abundance for the purpose of generating a marginal effects plot, and so we set the argument <code>include.sp = FALSE</code> to ignore the spatial random effects. See the distance sampling vignette for an example of how to generate a map of abundance across some region of interest.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true"></a><span class="co"># Recall what the prediction design matrix looks like</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true"></a><span class="kw">str</span>(X<span class="fl">.0</span>)</span></code></pre></div>
<pre><code> num [1:100, 1:2] 1 1 1 1 1 1 1 1 1 1 ...
 - attr(*, &quot;dimnames&quot;)=List of 2
  ..$ : NULL
  ..$ : chr [1:2] &quot;intercept&quot; &quot;abund.cov.1&quot;</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true"></a>out.pred &lt;-<span class="st"> </span><span class="kw">predict</span>(out.sf.ms, X<span class="fl">.0</span>, <span class="dt">ignore.RE =</span> <span class="ot">TRUE</span>, <span class="dt">include.sp =</span> <span class="ot">FALSE</span>)</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true"></a><span class="kw">str</span>(out.pred)</span></code></pre></div>
<pre><code>List of 4
 $ mu.0.samples: num [1:3000, 1:6, 1:100] 0.1261 0.56 0.3538 0.1288 0.0819 ...
 $ N.0.samples : int [1:3000, 1:6, 1:100] 0 0 0 0 0 0 0 1 0 2 ...
 $ call        : language predict.sfMsNMix(object = out.sf.ms, X.0 = X.0, ignore.RE = TRUE, include.sp = FALSE)
 $ object.class: chr &quot;sfMsNMix&quot;
 - attr(*, &quot;class&quot;)= chr &quot;predict.sfMsNMix&quot;</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true"></a>mu.<span class="fl">0.</span>quants &lt;-<span class="st"> </span><span class="kw">apply</span>(out.pred<span class="op">$</span>mu.<span class="fl">0.</span>samples, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), quantile,</span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true"></a>                     <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true"></a><span class="co"># Put stuff together for plotting with ggplot2</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true"></a>mu.<span class="fl">0.</span>plot.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">mu.med =</span> <span class="kw">c</span>(mu.<span class="fl">0.</span>quants[<span class="dv">2</span>, , ]),</span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true"></a>                           <span class="dt">mu.low =</span> <span class="kw">c</span>(mu.<span class="fl">0.</span>quants[<span class="dv">1</span>, , ]),</span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true"></a>                           <span class="dt">mu.high =</span> <span class="kw">c</span>(mu.<span class="fl">0.</span>quants[<span class="dv">3</span>, , ]),</span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true"></a>                           <span class="dt">sp =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>n.sp, <span class="kw">nrow</span>(X<span class="fl">.0</span>)),</span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true"></a>                           <span class="dt">abund.cov.1 =</span> <span class="kw">rep</span>(cov.pred.vals, <span class="dt">each =</span> n.sp))</span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true"></a><span class="kw">ggplot</span>(mu.<span class="fl">0.</span>plot.df, <span class="kw">aes</span>(<span class="dt">x =</span> abund.cov<span class="fl">.1</span>, <span class="dt">y =</span> mu.med)) <span class="op">+</span></span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> mu.low, <span class="dt">ymax =</span> mu.high), <span class="dt">fill =</span> <span class="st">&#39;grey70&#39;</span>) <span class="op">+</span></span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb209-12"><a href="#cb209-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb209-13"><a href="#cb209-13" aria-hidden="true"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(sp)) <span class="op">+</span></span>
<span id="cb209-14"><a href="#cb209-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Covariate&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;Expected abundance&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references hanging-indent">
<div id="ref-banerjee2003">
<p>Banerjee, Sudipto, Bradley P Carlin, and Alan E Gelfand. 2003. <em>Hierarchical Modeling and Analysis for Spatial Data</em>. Chapman; Hall/CRC.</p>
</div>
<div id="ref-bates2015">
<p>Bates, Douglas, Martin Mächler, Ben Bolker, and Steve Walker. 2015. “Fitting Linear Mixed-Effects Models Using lme4.” <em>Journal of Statistical Software</em> 67 (1): 1–48. <a href="https://doi.org/10.18637/jss.v067.i01">https://doi.org/10.18637/jss.v067.i01</a>.</p>
</div>
<div id="ref-broms2016model">
<p>Broms, Kristin M, Mevin B Hooten, and Ryan M Fitzpatrick. 2016. “Model Selection and Assessment for Multi-Species Occupancy Models.” <em>Ecology</em> 97 (7): 1759–70.</p>
</div>
<div id="ref-brooks1998">
<p>Brooks, Stephen P., and Andrew Gelman. 1998. “General Methods for Monitoring Convergence of Iterative Simulations.” <em>Journal of Computational and Graphical Statistics</em> 7 (4): 434–55.</p>
</div>
<div id="ref-datta2016hierarchical">
<p>Datta, Abhirup, Sudipto Banerjee, Andrew O Finley, and Alan E Gelfand. 2016. “Hierarchical Nearest-Neighbor Gaussian Process Models for Large Geostatistical Datasets.” <em>Journal of the American Statistical Association</em> 111 (514): 800–812.</p>
</div>
<div id="ref-doser2023joint">
<p>Doser, Jeffrey W, Andrew O Finley, and Sudipto Banerjee. 2023. “Joint Species Distribution Models with Imperfect Detection for High-Dimensional Spatial Data.” <em>Ecology</em> 104 (9): e4137.</p>
</div>
<div id="ref-doser2022spoccupancy">
<p>Doser, Jeffrey W, Andrew O Finley, Marc Kéry, and Elise F Zipkin. 2022. “spOccupancy: An R package for single-species, multi-species, and integrated spatial occupancy models.” <em>Methods in Ecology and Evolution</em> 13 (8): 1670–8.</p>
</div>
<div id="ref-finley2020spnngp">
<p>Finley, Andrew O, Abhirup Datta, and Sudipto Banerjee. 2020. “SpNNGP R Package for Nearest Neighbor Gaussian Process Models.” <em>arXiv Preprint arXiv:2001.09111</em>.</p>
</div>
<div id="ref-finley2019efficient">
<p>Finley, Andrew O, Abhirup Datta, Bruce D Cook, Douglas C Morton, Hans E Andersen, and Sudipto Banerjee. 2019. “Efficient Algorithms for Bayesian Nearest Neighbor Gaussian Processes.” <em>Journal of Computational and Graphical Statistics</em> 28 (2): 401–14.</p>
</div>
<div id="ref-gelman2006prior">
<p>Gelman, Andrew. 2006. “Prior Distributions for Variance Parameters in Hierarchical Models (Comment on Article by Browne and Draper).” <em>Bayesian Analysis</em> 1 (3): 515–34.</p>
</div>
<div id="ref-guelat2018">
<p>Guélat, Jérôme, and Marc Kéry. 2018. “Effects of Spatial Autocorrelation and Imperfect Detection on Species Distribution Models.” <em>Methods in Ecology and Evolution</em> 9 (6): 1614–25.</p>
</div>
<div id="ref-hobbs2015">
<p>Hobbs, N Thompson, and Mevin B Hooten. 2015. <em>Bayesian Models</em>. Princeton University Press.</p>
</div>
<div id="ref-hooten2015guide">
<p>Hooten, Mevin B, and N Thompson Hobbs. 2015. “A Guide to Bayesian Model Selection for Ecologists.” <em>Ecological Monographs</em> 85 (1): 3–28.</p>
</div>
<div id="ref-kery2015applied">
<p>Kéry, Marc, and J Andrew Royle. 2016. <em>Applied Hierarchical Modeling in Ecology: Volume 1: Prelude and Static Models</em>. Elsevier Science.</p>
</div>
<div id="ref-keryRoyle2021">
<p>———. 2021. <em>Applied Hierarchical Modeling in Ecology: Analysis of Distribution, Abundance, and Species Richness in R and Bugs: Volume 2: Dynamic and Advanced Models.</em> London, UK: Academic Press.</p>
</div>
<div id="ref-knape2015estimates">
<p>Knape, J., and F. Korner-Nievergelt. 2015. “Estimates from Non-Replicated Population Surveys Rely on Critical Assumptions.” <em>Methods in Ecology and Evolution</em> 6: 298–306.</p>
</div>
<div id="ref-lopes2004bayesian">
<p>Lopes, Hedibert Freitas, and Mike West. 2004. “Bayesian Model Assessment in Factor Analysis.” <em>Statistica Sinica</em>, 41–67.</p>
</div>
<div id="ref-lunn2013bugs">
<p>Lunn, David, Christopher Jackson, Nicky Best, Andrew Thomas, and David Spiegelhalter. 2013. “The Bugs Book: A Practical Introduction to Bayesian Analysis.”</p>
</div>
<div id="ref-mimnagh2022bayesian">
<p>Mimnagh, Niamh, Andrew Parnell, Estevao Prado, and Rafael de Andrade Moral. 2022. “Bayesian Multi-Species N-Mixture Models for Unmarked Animal Communities.” <em>Environmental and Ecological Statistics</em> 29 (4): 755–78.</p>
</div>
<div id="ref-roberts2009examples">
<p>Roberts, Gareth O, and Jeffrey S Rosenthal. 2009. “Examples of Adaptive Mcmc.” <em>Journal of Computational and Graphical Statistics</em> 18 (2): 349–67.</p>
</div>
<div id="ref-royle2004n">
<p>Royle, J Andrew. 2004. “N-mixture models for estimating population size from spatially replicated counts.” <em>Biometrics</em> 60 (1): 108–15.</p>
</div>
<div id="ref-taylor2019spatial">
<p>Taylor-Rodriguez, Daniel, Andrew O Finley, Abhirup Datta, Chad Babcock, Hans-Erik Andersen, Bruce D Cook, Douglas C Morton, and Sudipto Banerjee. 2019. “Spatial Factor Models for High-Dimensional and Large Spatial Data: An Application in Forest Variable Mapping.” <em>Statistica Sinica</em> 29: 1155.</p>
</div>
<div id="ref-tobler2019joint">
<p>Tobler, Mathias W, Marc Kéry, Francis KC Hui, Gurutzeta Guillera-Arroita, Peter Knaus, and Thomas Sattler. 2019. “Joint Species Distribution Models with Species Correlations and Imperfect Detection.” <em>Ecology</em> 100 (8): e02754.</p>
</div>
<div id="ref-warton2015so">
<p>Warton, David I, F Guillaume Blanchet, Robert B O’Hara, Otso Ovaskainen, Sara Taskinen, Steven C Walker, and Francis KC Hui. 2015. “So Many Variables: Joint Modeling in Community Ecology.” <em>Trends in Ecology &amp; Evolution</em> 30 (12): 766–79.</p>
</div>
<div id="ref-watanabe2010">
<p>Watanabe, Sumio. 2010. “Asymptotic Equivalence of Bayes Cross Validation and Widely Applicable Information Criterion in Singular Learning Theory.” <em>Journal of Machine Learning Research</em> 11 (12).</p>
</div>
<div id="ref-yamaura2012biodiversity">
<p>Yamaura, Yuichi, J Andrew Royle, Naoaki Shimada, Seigo Asanuma, Tamotsu Sato, Hisatomo Taki, and Shun’ichi Makino. 2012. “Biodiversity of Man-Made Open Habitats in an Underused Country: A Class of Multispecies Abundance Models for Count Data.” <em>Biodiversity and Conservation</em> 21: 1365–80.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
